DEBUG:celery.utils.functional:
def chain(*args, **kwargs):
    return 1

DEBUG:celery.utils.functional:
def xstarmap(task, it):
    return 1

DEBUG:celery.utils.functional:
def accumulate(self, *args, **kwargs):
    return 1

DEBUG:celery.utils.functional:
def process_asset_in_background(self, owner_id, asset_name):
    return 1

DEBUG:celery.utils.functional:
def chord(self, header, body, partial_args=0, interval=1, countdown=2, max_retries=3, eager=4, **kwargs):
    return 1

DEBUG:celery.utils.functional:
def chunks(task, it, n):
    return 1

DEBUG:celery.utils.functional:
def process_trade_ids_in_background(self, owner_id):
    return 1

DEBUG:celery.utils.functional:
def unlock_chord(self, group_id, callback, interval=0, max_retries=1, result=2, Result=3, GroupResult=4, result_from_tuple=5, **kwargs):
    return 1

DEBUG:celery.utils.functional:
def process_csv_file_async(owner_id, file_name_entry_id, csv_content, exchange):
    return 1

DEBUG:celery.utils.functional:
def group(self, tasks, result, group_id, partial_args, add_to_parent=0):
    return 1

DEBUG:celery.utils.functional:
def xmap(task, it):
    return 1

DEBUG:celery.utils.functional:
def backend_cleanup():
    return 1

 
 -------------- celery@ryf3-dojiliteapiv2-guxcl9a7ol1 v5.4.0 (opalescent)
--- ***** ----- 
-- ******* ---- Linux-6.1.91-060191-generic-x86_64-with-glibc2.35 2024-10-06 13:23:43
- *** --- * --- 
- ** ---------- [config]
- ** ---------- .> app:         doji_lite_api_v2:0x7fe55cf4cda0
- ** ---------- .> transport:   redis://:**@redis-17439.c1.eu-west-1-3.ec2.redns.redis-cloud.com:17439/0
- ** ---------- .> results:     disabled://
- *** --- * --- .> concurrency: 16 (prefork)
-- ******* ---- .> task events: ON
--- ***** ----- 
 -------------- [queues]
                .> celery           exchange=celery(direct) key=celery
                

[tasks]
  . upload_csv.tasks.process_asset_in_background
  . upload_csv.tasks.process_csv_file_async
  . upload_csv.tasks.process_trade_ids_in_background

[2024-10-06 13:23:45,325: INFO/MainProcess] Connected to redis://:**@redis-17439.c1.eu-west-1-3.ec2.redns.redis-cloud.com:17439/0
[2024-10-06 13:23:45,429: INFO/MainProcess] mingle: searching for neighbors
[2024-10-06 13:23:46,765: INFO/MainProcess] mingle: sync with 1 nodes
[2024-10-06 13:23:46,766: INFO/MainProcess] mingle: sync complete
[2024-10-06 13:23:47,370: INFO/MainProcess] celery@ryf3-dojiliteapiv2-guxcl9a7ol1 ready.
[2024-10-06 13:32:57,436: INFO/MainProcess] sync with celery@f0cf57ae-8c02-45cf-98c6-181cff402aae
[2024-10-06 13:39:57,110: INFO/MainProcess] sync with celery@b112d040-cec5-4bf3-8743-065a03606949
[2024-10-06 13:40:11,543: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[394c6612-36e7-4c37-b128-d6a414763748] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:11,565: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x1"; args=None; alias=default
[2024-10-06 13:40:11,565: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x1"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT') LIMIT 1; args=(1, 1, 'RUNEUSDT'); alias=default
[2024-10-06 13:40:11,570: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT') LIMIT 1; args=(1, 1, 'RUNEUSDT'); alias=default
[2024-10-06 13:40:11,570: WARNING/ForkPoolWorker-15] No trades found for asset RUNEUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x1"; args=None; alias=default
[2024-10-06 13:40:11,570: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x1"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Buy'); alias=default
[2024-10-06 13:40:11,572: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Sell'); alias=default
[2024-10-06 13:40:11,572: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:11,573: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:11,573: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[394c6612-36e7-4c37-b128-d6a414763748] succeeded in 0.009708939003758132s: None
[2024-10-06 13:40:38,253: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[fa6c1338-5ecf-4500-a3a6-b9ae3c23d16f] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:38,273: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x2"; args=None; alias=default
[2024-10-06 13:40:38,273: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x2"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT') LIMIT 1; args=(1, 1, 'BLURUSDT'); alias=default
[2024-10-06 13:40:38,275: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT') LIMIT 1; args=(1, 1, 'BLURUSDT'); alias=default
[2024-10-06 13:40:38,275: WARNING/ForkPoolWorker-15] No trades found for asset BLURUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x2"; args=None; alias=default
[2024-10-06 13:40:38,275: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x2"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Buy'); alias=default
[2024-10-06 13:40:38,276: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Sell'); alias=default
[2024-10-06 13:40:38,276: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:38,277: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:38,277: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[fa6c1338-5ecf-4500-a3a6-b9ae3c23d16f] succeeded in 0.004589259006024804s: None
[2024-10-06 13:40:38,331: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[c294e2cd-90fd-4c12-a1bf-0f249f80489f] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:38,351: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x3"; args=None; alias=default
[2024-10-06 13:40:38,352: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x3"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT') LIMIT 1; args=(1, 1, 'ETHUSDT'); alias=default
[2024-10-06 13:40:38,353: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT') LIMIT 1; args=(1, 1, 'ETHUSDT'); alias=default
[2024-10-06 13:40:38,353: WARNING/ForkPoolWorker-15] No trades found for asset ETHUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x3"; args=None; alias=default
[2024-10-06 13:40:38,353: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x3"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Buy'); alias=default
[2024-10-06 13:40:38,355: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Sell'); alias=default
[2024-10-06 13:40:38,356: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:38,356: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:38,356: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[c294e2cd-90fd-4c12-a1bf-0f249f80489f] succeeded in 0.005836989999806974s: None
[2024-10-06 13:40:38,408: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[0fb7d985-134a-48ae-8b0f-72fd53f9b879] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:38,429: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x4"; args=None; alias=default
[2024-10-06 13:40:38,429: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x4"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT') LIMIT 1; args=(1, 1, 'ETHUSDT'); alias=default
[2024-10-06 13:40:38,430: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT') LIMIT 1; args=(1, 1, 'ETHUSDT'); alias=default
[2024-10-06 13:40:38,430: WARNING/ForkPoolWorker-15] No trades found for asset ETHUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x4"; args=None; alias=default
[2024-10-06 13:40:38,431: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x4"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Buy'); alias=default
[2024-10-06 13:40:38,432: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Sell'); alias=default
[2024-10-06 13:40:38,433: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:38,433: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:38,433: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[0fb7d985-134a-48ae-8b0f-72fd53f9b879] succeeded in 0.005286999003146775s: None
[2024-10-06 13:40:38,486: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[9dbb1ef8-94f0-40e8-bd15-cb30ba89f81a] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:38,507: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:38,511: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:38,512: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:38,519: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[9dbb1ef8-94f0-40e8-bd15-cb30ba89f81a] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:38,566: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[7f6627de-7ea4-4c72-a9db-c5d88589cdb6] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:38,587: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:38,589: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:38,589: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:38,595: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[7f6627de-7ea4-4c72-a9db-c5d88589cdb6] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:38,644: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[837b9a6f-7375-449f-b665-31e405b8fe16] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:38,665: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x5"; args=None; alias=default
[2024-10-06 13:40:38,665: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x5"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 13:40:38,667: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 13:40:38,667: WARNING/ForkPoolWorker-15] No trades found for asset LDOUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x5"; args=None; alias=default
[2024-10-06 13:40:38,667: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x5"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
[2024-10-06 13:40:38,668: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
[2024-10-06 13:40:38,669: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:38,670: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:38,670: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[837b9a6f-7375-449f-b665-31e405b8fe16] succeeded in 0.005551508998905774s: None
[2024-10-06 13:40:38,722: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[af86afe1-e57d-4297-877f-6546607120bd] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:38,742: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:38,744: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:38,744: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:38,750: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[af86afe1-e57d-4297-877f-6546607120bd] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:38,800: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[e8b357ed-6b03-403b-8393-f1275531d8ea] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:38,821: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x6"; args=None; alias=default
[2024-10-06 13:40:38,821: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x6"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT') LIMIT 1; args=(1, 1, 'RUNEUSDT'); alias=default
[2024-10-06 13:40:38,823: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT') LIMIT 1; args=(1, 1, 'RUNEUSDT'); alias=default
[2024-10-06 13:40:38,824: WARNING/ForkPoolWorker-15] No trades found for asset RUNEUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x6"; args=None; alias=default
[2024-10-06 13:40:38,824: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x6"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Buy'); alias=default
[2024-10-06 13:40:38,825: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Sell'); alias=default
[2024-10-06 13:40:38,825: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:38,826: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:38,826: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[e8b357ed-6b03-403b-8393-f1275531d8ea] succeeded in 0.005683368995960336s: None
[2024-10-06 13:40:38,879: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[9c365dd8-fd18-4914-95fb-2071952cc60b] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:38,900: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:38,901: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:38,902: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:38,907: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[9c365dd8-fd18-4914-95fb-2071952cc60b] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:38,957: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[fee1724b-b610-4fd5-bc9f-7c3fc9420aa9] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:38,978: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x7"; args=None; alias=default
[2024-10-06 13:40:38,978: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x7"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'NEARUSDT') LIMIT 1; args=(1, 1, 'NEARUSDT'); alias=default
[2024-10-06 13:40:38,980: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'NEARUSDT') LIMIT 1; args=(1, 1, 'NEARUSDT'); alias=default
[2024-10-06 13:40:38,980: WARNING/ForkPoolWorker-15] No trades found for asset NEARUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x7"; args=None; alias=default
[2024-10-06 13:40:38,980: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x7"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'NEARUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'NEARUSDT', 'Buy'); alias=default
[2024-10-06 13:40:38,981: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'NEARUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'NEARUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'NEARUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'NEARUSDT', 'Sell'); alias=default
[2024-10-06 13:40:38,982: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'NEARUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'NEARUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:38,982: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:38,982: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[fee1724b-b610-4fd5-bc9f-7c3fc9420aa9] succeeded in 0.005244329004199244s: None
[2024-10-06 13:40:39,035: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[84d9e361-9d1c-40c3-a353-988ae12d2005] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:39,055: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:39,057: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:39,057: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:39,062: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[84d9e361-9d1c-40c3-a353-988ae12d2005] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:39,113: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[5a9d53ca-7bf1-4f23-ab47-9f4b555c3ad0] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:39,133: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x8"; args=None; alias=default
[2024-10-06 13:40:39,133: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x8"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'NEARUSDT') LIMIT 1; args=(1, 1, 'NEARUSDT'); alias=default
[2024-10-06 13:40:39,135: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'NEARUSDT') LIMIT 1; args=(1, 1, 'NEARUSDT'); alias=default
[2024-10-06 13:40:39,135: WARNING/ForkPoolWorker-15] No trades found for asset NEARUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x8"; args=None; alias=default
[2024-10-06 13:40:39,135: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x8"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'NEARUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'NEARUSDT', 'Buy'); alias=default
[2024-10-06 13:40:39,136: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'NEARUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'NEARUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'NEARUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'NEARUSDT', 'Sell'); alias=default
[2024-10-06 13:40:39,137: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'NEARUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'NEARUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:39,137: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:39,138: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[5a9d53ca-7bf1-4f23-ab47-9f4b555c3ad0] succeeded in 0.005387419005273841s: None
[2024-10-06 13:40:39,190: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[cc18104d-b89c-4c87-a8d5-425a941f8410] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:39,211: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:39,213: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:39,213: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:39,218: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[cc18104d-b89c-4c87-a8d5-425a941f8410] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:39,269: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[c57c81ab-760e-4d13-bb11-a7a77279707d] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:39,290: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x9"; args=None; alias=default
[2024-10-06 13:40:39,290: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x9"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT') LIMIT 1; args=(1, 1, 'RUNEUSDT'); alias=default
[2024-10-06 13:40:39,292: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT') LIMIT 1; args=(1, 1, 'RUNEUSDT'); alias=default
[2024-10-06 13:40:39,292: WARNING/ForkPoolWorker-15] No trades found for asset RUNEUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x9"; args=None; alias=default
[2024-10-06 13:40:39,292: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x9"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Buy'); alias=default
[2024-10-06 13:40:39,293: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Sell'); alias=default
[2024-10-06 13:40:39,294: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:39,295: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:39,295: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[c57c81ab-760e-4d13-bb11-a7a77279707d] succeeded in 0.005726579001930077s: None
[2024-10-06 13:40:39,348: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[73969dde-a58d-4c9c-aedf-468d4c90fe55] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:39,368: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:39,370: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:39,371: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:39,376: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[73969dde-a58d-4c9c-aedf-468d4c90fe55] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:39,426: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[48158706-a5af-4278-8045-4cbfa6dc98f6] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:39,447: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x10"; args=None; alias=default
[2024-10-06 13:40:39,447: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x10"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 13:40:39,449: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 13:40:39,449: WARNING/ForkPoolWorker-15] No trades found for asset LDOUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x10"; args=None; alias=default
[2024-10-06 13:40:39,449: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x10"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
[2024-10-06 13:40:39,450: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
[2024-10-06 13:40:39,451: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:39,451: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:39,451: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[48158706-a5af-4278-8045-4cbfa6dc98f6] succeeded in 0.00536651899892604s: None
[2024-10-06 13:40:39,504: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[db7c9a6a-b94d-4adb-9e78-bda668e9433a] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:39,544: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:39,546: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:39,547: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:39,552: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[db7c9a6a-b94d-4adb-9e78-bda668e9433a] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:39,602: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[5e582ab9-268b-46ed-9175-8d27d40ec57e] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:39,623: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x11"; args=None; alias=default
[2024-10-06 13:40:39,624: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x11"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'INJUSDT') LIMIT 1; args=(1, 1, 'INJUSDT'); alias=default
[2024-10-06 13:40:39,625: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'INJUSDT') LIMIT 1; args=(1, 1, 'INJUSDT'); alias=default
[2024-10-06 13:40:39,625: WARNING/ForkPoolWorker-15] No trades found for asset INJUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x11"; args=None; alias=default
[2024-10-06 13:40:39,625: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x11"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'INJUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'INJUSDT', 'Buy'); alias=default
[2024-10-06 13:40:39,626: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'INJUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'INJUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'INJUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'INJUSDT', 'Sell'); alias=default
[2024-10-06 13:40:39,627: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'INJUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'INJUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:39,627: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:39,628: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[5e582ab9-268b-46ed-9175-8d27d40ec57e] succeeded in 0.005114779996802099s: None
[2024-10-06 13:40:39,680: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[5394b8b1-94d9-4c4e-a032-bf358303b90d] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:39,701: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:39,703: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:39,704: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:39,708: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[5394b8b1-94d9-4c4e-a032-bf358303b90d] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:39,759: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[f9488472-05cb-427f-98e4-8d6011a3b7c6] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:39,780: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x12"; args=None; alias=default
[2024-10-06 13:40:39,780: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x12"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT') LIMIT 1; args=(1, 1, 'RUNEUSDT'); alias=default
[2024-10-06 13:40:39,782: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT') LIMIT 1; args=(1, 1, 'RUNEUSDT'); alias=default
[2024-10-06 13:40:39,782: WARNING/ForkPoolWorker-15] No trades found for asset RUNEUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x12"; args=None; alias=default
[2024-10-06 13:40:39,782: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x12"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Buy'); alias=default
[2024-10-06 13:40:39,783: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Sell'); alias=default
[2024-10-06 13:40:39,784: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:39,784: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:39,784: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[f9488472-05cb-427f-98e4-8d6011a3b7c6] succeeded in 0.00519740999880014s: None
[2024-10-06 13:40:39,837: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[67381d35-fe60-4806-aa59-0129c23cc07c] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:39,858: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:39,860: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:39,861: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:39,865: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[67381d35-fe60-4806-aa59-0129c23cc07c] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:39,915: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[fa496972-ee72-4869-b35e-3a54c29697a1] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:39,936: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x13"; args=None; alias=default
[2024-10-06 13:40:39,937: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x13"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 13:40:39,938: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 13:40:39,938: WARNING/ForkPoolWorker-15] No trades found for asset LDOUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x13"; args=None; alias=default
[2024-10-06 13:40:39,938: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x13"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
[2024-10-06 13:40:39,939: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
[2024-10-06 13:40:39,940: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:39,940: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:39,941: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[fa496972-ee72-4869-b35e-3a54c29697a1] succeeded in 0.005079279995698016s: None
[2024-10-06 13:40:39,996: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[24fdd21c-56aa-430f-9964-ca19be7280a7] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:40,016: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:40,019: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:40,019: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:40,027: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[24fdd21c-56aa-430f-9964-ca19be7280a7] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:40,075: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[1a9398fb-d7b9-43d7-875b-53b6f2979f1f] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:40,096: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x14"; args=None; alias=default
[2024-10-06 13:40:40,096: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x14"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'WIFUSDT') LIMIT 1; args=(1, 1, 'WIFUSDT'); alias=default
[2024-10-06 13:40:40,098: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'WIFUSDT') LIMIT 1; args=(1, 1, 'WIFUSDT'); alias=default
[2024-10-06 13:40:40,098: WARNING/ForkPoolWorker-15] No trades found for asset WIFUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x14"; args=None; alias=default
[2024-10-06 13:40:40,098: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x14"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'WIFUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'WIFUSDT', 'Buy'); alias=default
[2024-10-06 13:40:40,099: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'WIFUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'WIFUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'WIFUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'WIFUSDT', 'Sell'); alias=default
[2024-10-06 13:40:40,100: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'WIFUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'WIFUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:40,101: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:40,101: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[1a9398fb-d7b9-43d7-875b-53b6f2979f1f] succeeded in 0.00580171900219284s: None
[2024-10-06 13:40:40,153: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[1d431a9d-04bf-493c-9a7b-8d4d701a5c99] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:40,173: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:40,176: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:40,177: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:40,182: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[1d431a9d-04bf-493c-9a7b-8d4d701a5c99] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:40,232: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[2346e618-a9e8-4da3-9022-65aed3bd0595] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:40,253: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x15"; args=None; alias=default
[2024-10-06 13:40:40,253: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x15"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'WIFUSDT') LIMIT 1; args=(1, 1, 'WIFUSDT'); alias=default
[2024-10-06 13:40:40,255: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'WIFUSDT') LIMIT 1; args=(1, 1, 'WIFUSDT'); alias=default
[2024-10-06 13:40:40,255: WARNING/ForkPoolWorker-15] No trades found for asset WIFUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x15"; args=None; alias=default
[2024-10-06 13:40:40,255: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x15"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'WIFUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'WIFUSDT', 'Buy'); alias=default
[2024-10-06 13:40:40,256: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'WIFUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'WIFUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'WIFUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'WIFUSDT', 'Sell'); alias=default
[2024-10-06 13:40:40,257: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'WIFUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'WIFUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:40,257: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:40,257: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[2346e618-a9e8-4da3-9022-65aed3bd0595] succeeded in 0.005205439003475476s: None
[2024-10-06 13:40:40,310: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[b207cdc5-132d-467d-b880-1d9ec084e7c0] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:40,330: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:40,332: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:40,332: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:40,338: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[b207cdc5-132d-467d-b880-1d9ec084e7c0] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:40,388: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[1d74a699-351b-44de-84d3-23449de589aa] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:40,409: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x16"; args=None; alias=default
[2024-10-06 13:40:40,409: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x16"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT') LIMIT 1; args=(1, 1, 'ARBUSDT'); alias=default
[2024-10-06 13:40:40,410: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT') LIMIT 1; args=(1, 1, 'ARBUSDT'); alias=default
[2024-10-06 13:40:40,411: WARNING/ForkPoolWorker-15] No trades found for asset ARBUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x16"; args=None; alias=default
[2024-10-06 13:40:40,411: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x16"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ARBUSDT', 'Buy'); alias=default
[2024-10-06 13:40:40,411: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ARBUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ARBUSDT', 'Sell'); alias=default
[2024-10-06 13:40:40,412: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ARBUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:40,413: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:40,413: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[1d74a699-351b-44de-84d3-23449de589aa] succeeded in 0.004607689996191766s: None
[2024-10-06 13:40:40,466: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[4c5d857d-dfff-4557-baa5-94543a7e3e51] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:40,489: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:40,491: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:40,491: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:40,497: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[4c5d857d-dfff-4557-baa5-94543a7e3e51] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:40,547: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[703b602a-a145-476d-a554-23ea6084e588] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:40,568: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x17"; args=None; alias=default
[2024-10-06 13:40:40,568: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x17"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SEIUSDT') LIMIT 1; args=(1, 1, 'SEIUSDT'); alias=default
[2024-10-06 13:40:40,569: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SEIUSDT') LIMIT 1; args=(1, 1, 'SEIUSDT'); alias=default
[2024-10-06 13:40:40,570: WARNING/ForkPoolWorker-15] No trades found for asset SEIUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x17"; args=None; alias=default
[2024-10-06 13:40:40,570: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x17"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SEIUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'SEIUSDT', 'Buy'); alias=default
[2024-10-06 13:40:40,571: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SEIUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'SEIUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SEIUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'SEIUSDT', 'Sell'); alias=default
[2024-10-06 13:40:40,572: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SEIUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'SEIUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:40,572: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:40,572: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[703b602a-a145-476d-a554-23ea6084e588] succeeded in 0.004860080000071321s: None
[2024-10-06 13:40:40,626: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[686380a2-1a86-4423-9f83-6a4dc76f1152] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:40,647: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:40,649: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:40,649: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:40,654: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[686380a2-1a86-4423-9f83-6a4dc76f1152] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:40,705: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[61127f0b-0a05-4656-9111-6b30c7c857e5] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:40,726: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x18"; args=None; alias=default
[2024-10-06 13:40:40,726: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x18"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'INJUSDT') LIMIT 1; args=(1, 1, 'INJUSDT'); alias=default
[2024-10-06 13:40:40,728: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'INJUSDT') LIMIT 1; args=(1, 1, 'INJUSDT'); alias=default
[2024-10-06 13:40:40,728: WARNING/ForkPoolWorker-15] No trades found for asset INJUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x18"; args=None; alias=default
[2024-10-06 13:40:40,728: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x18"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'INJUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'INJUSDT', 'Buy'); alias=default
[2024-10-06 13:40:40,729: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'INJUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'INJUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'INJUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'INJUSDT', 'Sell'); alias=default
[2024-10-06 13:40:40,730: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'INJUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'INJUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:40,730: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:40,730: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[61127f0b-0a05-4656-9111-6b30c7c857e5] succeeded in 0.005117350003274623s: None
[2024-10-06 13:40:40,783: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[19c1b1bb-13e3-4821-ad23-32d0f3b48a72] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:40,803: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:40,805: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:40,806: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:40,810: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[19c1b1bb-13e3-4821-ad23-32d0f3b48a72] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:40,863: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[1ce436b8-7971-439a-89f5-ebe5eeb7971a] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:40,883: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x19"; args=None; alias=default
[2024-10-06 13:40:40,883: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x19"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'INJUSDT') LIMIT 1; args=(1, 1, 'INJUSDT'); alias=default
[2024-10-06 13:40:40,885: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'INJUSDT') LIMIT 1; args=(1, 1, 'INJUSDT'); alias=default
[2024-10-06 13:40:40,885: WARNING/ForkPoolWorker-15] No trades found for asset INJUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x19"; args=None; alias=default
[2024-10-06 13:40:40,886: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x19"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'INJUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'INJUSDT', 'Buy'); alias=default
[2024-10-06 13:40:40,887: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'INJUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'INJUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'INJUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'INJUSDT', 'Sell'); alias=default
[2024-10-06 13:40:40,888: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'INJUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'INJUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:40,888: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:40,888: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[1ce436b8-7971-439a-89f5-ebe5eeb7971a] succeeded in 0.0055832590005593374s: None
[2024-10-06 13:40:40,941: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[02ae3227-60ab-4cb4-afe1-ce9ae18fc962] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:40,962: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:40,965: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:40,965: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:40,970: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[02ae3227-60ab-4cb4-afe1-ce9ae18fc962] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:41,021: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[6439be19-fab6-45b4-a934-30080481873e] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:41,042: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x20"; args=None; alias=default
[2024-10-06 13:40:41,042: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x20"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 13:40:41,043: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 13:40:41,043: WARNING/ForkPoolWorker-15] No trades found for asset LDOUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x20"; args=None; alias=default
[2024-10-06 13:40:41,043: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x20"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
[2024-10-06 13:40:41,044: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
[2024-10-06 13:40:41,045: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:41,045: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:41,046: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[6439be19-fab6-45b4-a934-30080481873e] succeeded in 0.004523009003605694s: None
[2024-10-06 13:40:41,100: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[68d6ff4d-cd4c-40c4-b5c6-793eb4f2b49d] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:41,121: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:41,122: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:41,123: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:41,129: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[68d6ff4d-cd4c-40c4-b5c6-793eb4f2b49d] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:41,179: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[ee8e9db4-f5bf-4a83-8705-7cb131e20da3] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:41,199: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x21"; args=None; alias=default
[2024-10-06 13:40:41,199: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x21"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 13:40:41,201: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 13:40:41,201: WARNING/ForkPoolWorker-15] No trades found for asset LDOUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x21"; args=None; alias=default
[2024-10-06 13:40:41,201: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x21"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
[2024-10-06 13:40:41,203: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
[2024-10-06 13:40:41,204: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:41,204: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:41,204: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[ee8e9db4-f5bf-4a83-8705-7cb131e20da3] succeeded in 0.005812048999359831s: None
[2024-10-06 13:40:41,256: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[17779f3e-227b-4637-b680-5636b7cf6807] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:41,276: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:41,278: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:41,279: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:41,285: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[17779f3e-227b-4637-b680-5636b7cf6807] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:41,334: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[8d2c0670-2493-4731-920c-be9cbf308436] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:41,355: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x22"; args=None; alias=default
[2024-10-06 13:40:41,355: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x22"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 13:40:41,357: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 13:40:41,357: WARNING/ForkPoolWorker-15] No trades found for asset LDOUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x22"; args=None; alias=default
[2024-10-06 13:40:41,357: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x22"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
[2024-10-06 13:40:41,358: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
[2024-10-06 13:40:41,359: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:41,359: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:41,359: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[8d2c0670-2493-4731-920c-be9cbf308436] succeeded in 0.004775089997565374s: None
[2024-10-06 13:40:41,412: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[4d3ed82c-6b47-47c3-906f-979bff6589a0] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:41,433: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:41,435: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:41,435: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:41,440: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[4d3ed82c-6b47-47c3-906f-979bff6589a0] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:41,490: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[f523b116-9df2-4247-bfc4-f96792b80283] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:41,510: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x23"; args=None; alias=default
[2024-10-06 13:40:41,510: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x23"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SEIUSDT') LIMIT 1; args=(1, 1, 'SEIUSDT'); alias=default
[2024-10-06 13:40:41,512: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SEIUSDT') LIMIT 1; args=(1, 1, 'SEIUSDT'); alias=default
[2024-10-06 13:40:41,512: WARNING/ForkPoolWorker-15] No trades found for asset SEIUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x23"; args=None; alias=default
[2024-10-06 13:40:41,512: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x23"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SEIUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'SEIUSDT', 'Buy'); alias=default
[2024-10-06 13:40:41,513: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SEIUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'SEIUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SEIUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'SEIUSDT', 'Sell'); alias=default
[2024-10-06 13:40:41,514: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SEIUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'SEIUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:41,515: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:41,515: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[f523b116-9df2-4247-bfc4-f96792b80283] succeeded in 0.005172568999114446s: None
[2024-10-06 13:40:41,586: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[35e0ae6c-760e-488b-9aba-b50b47ab4351] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:41,607: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:41,609: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:41,610: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:41,615: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[35e0ae6c-760e-488b-9aba-b50b47ab4351] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:41,665: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[15f1af36-fafd-400e-b307-19a780a1c809] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:41,685: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x24"; args=None; alias=default
[2024-10-06 13:40:41,685: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x24"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT') LIMIT 1; args=(1, 1, 'BLURUSDT'); alias=default
[2024-10-06 13:40:41,687: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT') LIMIT 1; args=(1, 1, 'BLURUSDT'); alias=default
[2024-10-06 13:40:41,687: WARNING/ForkPoolWorker-15] No trades found for asset BLURUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x24"; args=None; alias=default
[2024-10-06 13:40:41,687: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x24"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Buy'); alias=default
[2024-10-06 13:40:41,688: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Sell'); alias=default
[2024-10-06 13:40:41,689: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:41,689: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:41,689: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[15f1af36-fafd-400e-b307-19a780a1c809] succeeded in 0.004576309002004564s: None
[2024-10-06 13:40:41,743: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[c5802570-8217-4186-8b61-d74eca4f4c94] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:41,763: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:41,766: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:41,767: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:41,771: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[c5802570-8217-4186-8b61-d74eca4f4c94] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:41,821: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[a2883c81-2b08-44ff-83d3-f26224313d9f] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:41,842: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x25"; args=None; alias=default
[2024-10-06 13:40:41,842: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x25"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 13:40:41,844: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 13:40:41,844: WARNING/ForkPoolWorker-15] No trades found for asset LDOUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x25"; args=None; alias=default
[2024-10-06 13:40:41,844: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x25"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
[2024-10-06 13:40:41,845: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
[2024-10-06 13:40:41,845: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:41,846: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:41,846: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[a2883c81-2b08-44ff-83d3-f26224313d9f] succeeded in 0.004709519002062734s: None
[2024-10-06 13:40:41,900: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[06de3cad-7d02-4bca-9a64-5bed923240c5] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:41,921: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:41,922: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:41,923: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:41,929: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[06de3cad-7d02-4bca-9a64-5bed923240c5] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:41,979: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[93c25183-c914-4aa5-9389-c0bb4ace184d] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:41,999: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x26"; args=None; alias=default
[2024-10-06 13:40:42,000: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x26"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT') LIMIT 1; args=(1, 1, 'RUNEUSDT'); alias=default
[2024-10-06 13:40:42,002: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT') LIMIT 1; args=(1, 1, 'RUNEUSDT'); alias=default
[2024-10-06 13:40:42,002: WARNING/ForkPoolWorker-15] No trades found for asset RUNEUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x26"; args=None; alias=default
[2024-10-06 13:40:42,002: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x26"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Buy'); alias=default
[2024-10-06 13:40:42,003: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Sell'); alias=default
[2024-10-06 13:40:42,004: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:42,004: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:42,004: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[93c25183-c914-4aa5-9389-c0bb4ace184d] succeeded in 0.005564919003518298s: None
[2024-10-06 13:40:42,057: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[6a76d507-b338-42d1-b839-55666e4a6171] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:42,078: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:42,079: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:42,080: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:42,084: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[6a76d507-b338-42d1-b839-55666e4a6171] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:42,135: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[8451404a-24c2-4ce9-992d-166c99a3285b] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:42,156: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x27"; args=None; alias=default
[2024-10-06 13:40:42,156: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x27"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT') LIMIT 1; args=(1, 1, 'RUNEUSDT'); alias=default
[2024-10-06 13:40:42,158: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT') LIMIT 1; args=(1, 1, 'RUNEUSDT'); alias=default
[2024-10-06 13:40:42,158: WARNING/ForkPoolWorker-15] No trades found for asset RUNEUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x27"; args=None; alias=default
[2024-10-06 13:40:42,158: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x27"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Buy'); alias=default
[2024-10-06 13:40:42,159: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Sell'); alias=default
[2024-10-06 13:40:42,160: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:42,160: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:42,160: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[8451404a-24c2-4ce9-992d-166c99a3285b] succeeded in 0.005118280001624953s: None
[2024-10-06 13:40:42,214: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[96852f6f-a576-4116-ba20-b70b37b80c9a] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:42,234: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:42,236: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:42,237: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:42,242: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[96852f6f-a576-4116-ba20-b70b37b80c9a] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:42,293: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[f40416ac-22a6-4b6a-93cf-5417dec06754] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:42,314: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x28"; args=None; alias=default
[2024-10-06 13:40:42,315: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x28"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 13:40:42,316: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 13:40:42,316: WARNING/ForkPoolWorker-15] No trades found for asset LDOUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x28"; args=None; alias=default
[2024-10-06 13:40:42,316: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x28"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
[2024-10-06 13:40:42,317: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
[2024-10-06 13:40:42,318: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:42,318: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:42,318: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[f40416ac-22a6-4b6a-93cf-5417dec06754] succeeded in 0.004854040002101101s: None
[2024-10-06 13:40:42,372: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[3c2cfe6c-4099-4fc4-b94a-94abc031d636] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:42,393: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:42,395: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:42,395: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:42,400: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[3c2cfe6c-4099-4fc4-b94a-94abc031d636] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:42,451: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[f0b9b50f-270d-4b82-875c-74e6c477f171] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:42,472: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x29"; args=None; alias=default
[2024-10-06 13:40:42,472: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x29"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'NEARUSDT') LIMIT 1; args=(1, 1, 'NEARUSDT'); alias=default
[2024-10-06 13:40:42,474: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'NEARUSDT') LIMIT 1; args=(1, 1, 'NEARUSDT'); alias=default
[2024-10-06 13:40:42,474: WARNING/ForkPoolWorker-15] No trades found for asset NEARUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x29"; args=None; alias=default
[2024-10-06 13:40:42,475: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x29"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'NEARUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'NEARUSDT', 'Buy'); alias=default
[2024-10-06 13:40:42,476: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'NEARUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'NEARUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'NEARUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'NEARUSDT', 'Sell'); alias=default
[2024-10-06 13:40:42,477: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'NEARUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'NEARUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:42,477: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:42,477: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[f0b9b50f-270d-4b82-875c-74e6c477f171] succeeded in 0.005766529000538867s: None
[2024-10-06 13:40:42,529: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[a14861d3-2990-4bad-b663-1e924f2519d3] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:42,550: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:42,552: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:42,552: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:42,557: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[a14861d3-2990-4bad-b663-1e924f2519d3] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:42,608: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[a497578e-516a-47d5-9df7-dac94f77e7dd] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:42,629: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x30"; args=None; alias=default
[2024-10-06 13:40:42,629: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x30"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SEIUSDT') LIMIT 1; args=(1, 1, 'SEIUSDT'); alias=default
[2024-10-06 13:40:42,630: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SEIUSDT') LIMIT 1; args=(1, 1, 'SEIUSDT'); alias=default
[2024-10-06 13:40:42,631: WARNING/ForkPoolWorker-15] No trades found for asset SEIUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x30"; args=None; alias=default
[2024-10-06 13:40:42,631: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x30"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SEIUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'SEIUSDT', 'Buy'); alias=default
[2024-10-06 13:40:42,631: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SEIUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'SEIUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SEIUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'SEIUSDT', 'Sell'); alias=default
[2024-10-06 13:40:42,632: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SEIUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'SEIUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:42,633: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:42,633: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[a497578e-516a-47d5-9df7-dac94f77e7dd] succeeded in 0.004978550001396798s: None
[2024-10-06 13:40:42,686: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[77d30bc1-5058-4783-8db1-6f39d6db5a7a] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:42,706: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:42,709: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:42,709: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:42,714: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[77d30bc1-5058-4783-8db1-6f39d6db5a7a] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:42,764: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[bdd808f1-7765-484b-b2ab-3d6dd18bf7d1] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:42,785: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x31"; args=None; alias=default
[2024-10-06 13:40:42,786: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x31"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:40:42,787: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:40:42,787: WARNING/ForkPoolWorker-15] No trades found for asset BTCUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x31"; args=None; alias=default
[2024-10-06 13:40:42,787: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x31"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
[2024-10-06 13:40:42,789: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
[2024-10-06 13:40:42,790: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:42,791: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:42,791: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[bdd808f1-7765-484b-b2ab-3d6dd18bf7d1] succeeded in 0.00640911899972707s: None
[2024-10-06 13:40:42,843: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[75977efe-8a21-4d50-9a55-37a11c0dae9f] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:42,863: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:42,865: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:42,866: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:42,871: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[75977efe-8a21-4d50-9a55-37a11c0dae9f] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:42,922: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[1b312e4c-99e5-409d-a8cc-978652db5480] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:42,942: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x32"; args=None; alias=default
[2024-10-06 13:40:42,942: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x32"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'WIFUSDT') LIMIT 1; args=(1, 1, 'WIFUSDT'); alias=default
[2024-10-06 13:40:42,943: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'WIFUSDT') LIMIT 1; args=(1, 1, 'WIFUSDT'); alias=default
[2024-10-06 13:40:42,943: WARNING/ForkPoolWorker-15] No trades found for asset WIFUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x32"; args=None; alias=default
[2024-10-06 13:40:42,944: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x32"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'WIFUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'WIFUSDT', 'Buy'); alias=default
[2024-10-06 13:40:42,945: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'WIFUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'WIFUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'WIFUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'WIFUSDT', 'Sell'); alias=default
[2024-10-06 13:40:42,945: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'WIFUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'WIFUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:42,946: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:42,946: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[1b312e4c-99e5-409d-a8cc-978652db5480] succeeded in 0.004488939004659187s: None
[2024-10-06 13:40:43,000: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[4e434f0b-49e3-4351-b6db-2c48f5ac693e] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:43,020: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:43,022: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:43,023: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:43,029: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[4e434f0b-49e3-4351-b6db-2c48f5ac693e] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:43,079: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[4d731855-10e9-4c1d-81f0-1bbe5978e084] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:43,100: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x33"; args=None; alias=default
[2024-10-06 13:40:43,100: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x33"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:40:43,102: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:40:43,102: WARNING/ForkPoolWorker-15] No trades found for asset BTCUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x33"; args=None; alias=default
[2024-10-06 13:40:43,102: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x33"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
[2024-10-06 13:40:43,104: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
[2024-10-06 13:40:43,105: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:43,105: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:43,105: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[4d731855-10e9-4c1d-81f0-1bbe5978e084] succeeded in 0.005705759998818394s: None
[2024-10-06 13:40:43,157: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[7616cf43-1afd-44bf-b2fe-8ffdbbfa9dfd] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:43,178: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:43,181: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:43,181: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:43,188: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[7616cf43-1afd-44bf-b2fe-8ffdbbfa9dfd] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:43,236: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[a466fa74-9a38-41b9-93d4-6319fe61cce6] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:43,257: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x34"; args=None; alias=default
[2024-10-06 13:40:43,257: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x34"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:40:43,259: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:40:43,259: WARNING/ForkPoolWorker-15] No trades found for asset BTCUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x34"; args=None; alias=default
[2024-10-06 13:40:43,259: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x34"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
[2024-10-06 13:40:43,260: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
[2024-10-06 13:40:43,261: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:43,261: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:43,261: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[a466fa74-9a38-41b9-93d4-6319fe61cce6] succeeded in 0.005429729004390538s: None
[2024-10-06 13:40:43,313: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[26802f60-d46c-4975-b663-0a528a557700] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:43,335: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:43,337: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:43,338: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:43,343: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[26802f60-d46c-4975-b663-0a528a557700] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:43,393: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[22d8feb4-c7f8-4c9f-806e-f8b800d3fc13] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:43,414: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x35"; args=None; alias=default
[2024-10-06 13:40:43,414: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x35"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'MATICUSDT') LIMIT 1; args=(1, 1, 'MATICUSDT'); alias=default
[2024-10-06 13:40:43,415: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'MATICUSDT') LIMIT 1; args=(1, 1, 'MATICUSDT'); alias=default
[2024-10-06 13:40:43,415: WARNING/ForkPoolWorker-15] No trades found for asset MATICUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x35"; args=None; alias=default
[2024-10-06 13:40:43,416: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x35"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'MATICUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'MATICUSDT', 'Buy'); alias=default
[2024-10-06 13:40:43,417: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'MATICUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'MATICUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'MATICUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'MATICUSDT', 'Sell'); alias=default
[2024-10-06 13:40:43,417: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'MATICUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'MATICUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:43,418: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:43,418: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[22d8feb4-c7f8-4c9f-806e-f8b800d3fc13] succeeded in 0.004536649998044595s: None
[2024-10-06 13:40:43,471: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[b25b9981-ce39-4ad2-9cf2-26204d3e3063] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:43,492: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:43,494: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:43,495: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:43,500: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[b25b9981-ce39-4ad2-9cf2-26204d3e3063] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:43,550: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[a048622a-c431-4133-a5d2-cbe23aaf64ec] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:43,590: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x36"; args=None; alias=default
[2024-10-06 13:40:43,590: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x36"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'MATICUSDT') LIMIT 1; args=(1, 1, 'MATICUSDT'); alias=default
[2024-10-06 13:40:43,592: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'MATICUSDT') LIMIT 1; args=(1, 1, 'MATICUSDT'); alias=default
[2024-10-06 13:40:43,592: WARNING/ForkPoolWorker-15] No trades found for asset MATICUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x36"; args=None; alias=default
[2024-10-06 13:40:43,592: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x36"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'MATICUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'MATICUSDT', 'Buy'); alias=default
[2024-10-06 13:40:43,593: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'MATICUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'MATICUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'MATICUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'MATICUSDT', 'Sell'); alias=default
[2024-10-06 13:40:43,594: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'MATICUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'MATICUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:43,594: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:43,594: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[a048622a-c431-4133-a5d2-cbe23aaf64ec] succeeded in 0.004987110005458817s: None
[2024-10-06 13:40:43,648: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[e6c3e1fd-d32a-4690-8895-64924c0eb18b] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:43,668: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:43,670: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:43,670: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:43,676: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[e6c3e1fd-d32a-4690-8895-64924c0eb18b] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:43,726: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[d454abdc-64aa-4e78-ae28-421e33827e6f] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:43,746: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x37"; args=None; alias=default
[2024-10-06 13:40:43,746: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x37"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'WIFUSDT') LIMIT 1; args=(1, 1, 'WIFUSDT'); alias=default
[2024-10-06 13:40:43,748: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'WIFUSDT') LIMIT 1; args=(1, 1, 'WIFUSDT'); alias=default
[2024-10-06 13:40:43,748: WARNING/ForkPoolWorker-15] No trades found for asset WIFUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x37"; args=None; alias=default
[2024-10-06 13:40:43,748: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x37"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'WIFUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'WIFUSDT', 'Buy'); alias=default
[2024-10-06 13:40:43,749: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'WIFUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'WIFUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'WIFUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'WIFUSDT', 'Sell'); alias=default
[2024-10-06 13:40:43,750: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'WIFUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'WIFUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:43,751: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:43,751: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[d454abdc-64aa-4e78-ae28-421e33827e6f] succeeded in 0.0052109989992459305s: None
[2024-10-06 13:40:43,803: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[d500f045-da1a-4581-8f7b-34f829be8848] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:43,824: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:43,826: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:43,827: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:43,835: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[d500f045-da1a-4581-8f7b-34f829be8848] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:43,882: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[d820e781-1ef0-4d2c-b604-36bff148ba62] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:43,902: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x38"; args=None; alias=default
[2024-10-06 13:40:43,902: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x38"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:40:43,904: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:40:43,904: WARNING/ForkPoolWorker-15] No trades found for asset BTCUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x38"; args=None; alias=default
[2024-10-06 13:40:43,904: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x38"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
[2024-10-06 13:40:43,905: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
[2024-10-06 13:40:43,906: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:43,906: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:43,906: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[d820e781-1ef0-4d2c-b604-36bff148ba62] succeeded in 0.004906470006972086s: None
[2024-10-06 13:40:43,960: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[495906ee-2799-4959-9f3b-1bdb64565229] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:43,980: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:43,982: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:43,982: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:43,987: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[495906ee-2799-4959-9f3b-1bdb64565229] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:44,039: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[2427aa85-905a-46ee-a518-b8786623a81d] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:44,059: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x39"; args=None; alias=default
[2024-10-06 13:40:44,059: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x39"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT') LIMIT 1; args=(1, 1, 'ARBUSDT'); alias=default
[2024-10-06 13:40:44,061: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT') LIMIT 1; args=(1, 1, 'ARBUSDT'); alias=default
[2024-10-06 13:40:44,061: WARNING/ForkPoolWorker-15] No trades found for asset ARBUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x39"; args=None; alias=default
[2024-10-06 13:40:44,061: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x39"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ARBUSDT', 'Buy'); alias=default
[2024-10-06 13:40:44,063: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ARBUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ARBUSDT', 'Sell'); alias=default
[2024-10-06 13:40:44,063: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ARBUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:44,064: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:44,064: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[2427aa85-905a-46ee-a518-b8786623a81d] succeeded in 0.0054623489995719865s: None
[2024-10-06 13:40:44,116: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[5424e060-c0ce-4c34-85c7-9ccb0e9fd61e] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:44,137: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:44,139: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:44,139: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:44,146: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[5424e060-c0ce-4c34-85c7-9ccb0e9fd61e] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:44,194: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[e3ee9ee7-a094-49dc-be9b-fcaa5a178cfd] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:44,215: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x40"; args=None; alias=default
[2024-10-06 13:40:44,215: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x40"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT') LIMIT 1; args=(1, 1, 'RUNEUSDT'); alias=default
[2024-10-06 13:40:44,217: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT') LIMIT 1; args=(1, 1, 'RUNEUSDT'); alias=default
[2024-10-06 13:40:44,217: WARNING/ForkPoolWorker-15] No trades found for asset RUNEUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x40"; args=None; alias=default
[2024-10-06 13:40:44,217: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x40"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Buy'); alias=default
[2024-10-06 13:40:44,218: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Sell'); alias=default
[2024-10-06 13:40:44,219: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:44,219: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:44,219: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[e3ee9ee7-a094-49dc-be9b-fcaa5a178cfd] succeeded in 0.004917269994621165s: None
[2024-10-06 13:40:44,272: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[defa170d-56e0-4d78-ba53-36389f697c18] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:44,293: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:44,295: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:44,296: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:44,300: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[defa170d-56e0-4d78-ba53-36389f697c18] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:44,352: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[e7924f59-941e-4fdd-b27f-0e4231270e0f] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:44,372: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x41"; args=None; alias=default
[2024-10-06 13:40:44,373: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x41"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT') LIMIT 1; args=(1, 1, 'ETHUSDT'); alias=default
[2024-10-06 13:40:44,375: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT') LIMIT 1; args=(1, 1, 'ETHUSDT'); alias=default
[2024-10-06 13:40:44,375: WARNING/ForkPoolWorker-15] No trades found for asset ETHUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x41"; args=None; alias=default
[2024-10-06 13:40:44,375: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x41"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Buy'); alias=default
[2024-10-06 13:40:44,376: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Sell'); alias=default
[2024-10-06 13:40:44,377: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:44,377: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:44,377: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[e7924f59-941e-4fdd-b27f-0e4231270e0f] succeeded in 0.005291269000736065s: None
[2024-10-06 13:40:44,430: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[ba298f8a-339a-4c4b-8e19-013db4829f64] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:44,450: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:44,452: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:44,453: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:44,458: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[ba298f8a-339a-4c4b-8e19-013db4829f64] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:44,508: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[4dac8f29-49b8-4581-832c-bc7923a2300a] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:44,528: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x42"; args=None; alias=default
[2024-10-06 13:40:44,529: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x42"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:40:44,530: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:40:44,530: WARNING/ForkPoolWorker-15] No trades found for asset BTCUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x42"; args=None; alias=default
[2024-10-06 13:40:44,530: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x42"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
[2024-10-06 13:40:44,531: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
[2024-10-06 13:40:44,532: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:44,533: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:44,533: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[4dac8f29-49b8-4581-832c-bc7923a2300a] succeeded in 0.004896539001492783s: None
[2024-10-06 13:40:44,586: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[1b3a99da-4733-445d-87ff-bcbcd176df82] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:44,606: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:44,608: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:44,608: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:44,613: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[1b3a99da-4733-445d-87ff-bcbcd176df82] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:44,664: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[f8ee8916-9472-49bb-9ed3-795cd3daaaaa] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:44,685: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x43"; args=None; alias=default
[2024-10-06 13:40:44,685: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x43"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 13:40:44,686: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 13:40:44,687: WARNING/ForkPoolWorker-15] No trades found for asset LDOUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x43"; args=None; alias=default
[2024-10-06 13:40:44,687: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x43"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
[2024-10-06 13:40:44,688: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
[2024-10-06 13:40:44,689: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:44,689: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:44,689: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[f8ee8916-9472-49bb-9ed3-795cd3daaaaa] succeeded in 0.0049630389985395595s: None
[2024-10-06 13:40:44,743: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[55e9c4a9-1e48-4d0a-9688-9a9842d1ad9a] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:44,763: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:44,765: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:44,766: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:44,771: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[55e9c4a9-1e48-4d0a-9688-9a9842d1ad9a] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:44,821: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[d2c9090d-16c7-48e7-b0ad-c3320acf1023] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:44,842: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x44"; args=None; alias=default
[2024-10-06 13:40:44,842: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x44"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT') LIMIT 1; args=(1, 1, 'BLURUSDT'); alias=default
[2024-10-06 13:40:44,844: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT') LIMIT 1; args=(1, 1, 'BLURUSDT'); alias=default
[2024-10-06 13:40:44,844: WARNING/ForkPoolWorker-15] No trades found for asset BLURUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x44"; args=None; alias=default
[2024-10-06 13:40:44,844: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x44"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Buy'); alias=default
[2024-10-06 13:40:44,845: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Sell'); alias=default
[2024-10-06 13:40:44,846: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:44,846: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:44,847: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[d2c9090d-16c7-48e7-b0ad-c3320acf1023] succeeded in 0.005565719002333935s: None
[2024-10-06 13:40:44,899: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[757aaf6a-853f-4436-b187-b2d5fa1758c0] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:44,920: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:44,922: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:44,923: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:44,928: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[757aaf6a-853f-4436-b187-b2d5fa1758c0] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:44,978: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[c67dfc69-af26-4ff1-81a3-81f81d68b993] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:44,998: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x45"; args=None; alias=default
[2024-10-06 13:40:44,998: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x45"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT') LIMIT 1; args=(1, 1, 'ETHUSDT'); alias=default
[2024-10-06 13:40:45,000: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT') LIMIT 1; args=(1, 1, 'ETHUSDT'); alias=default
[2024-10-06 13:40:45,001: WARNING/ForkPoolWorker-15] No trades found for asset ETHUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x45"; args=None; alias=default
[2024-10-06 13:40:45,001: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x45"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Buy'); alias=default
[2024-10-06 13:40:45,002: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Sell'); alias=default
[2024-10-06 13:40:45,002: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:45,003: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:45,003: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[c67dfc69-af26-4ff1-81a3-81f81d68b993] succeeded in 0.005419469001935795s: None
[2024-10-06 13:40:45,056: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[da82b730-dbbf-4dbe-9589-16e88d9db96b] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:45,076: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:45,078: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:45,079: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:45,084: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[da82b730-dbbf-4dbe-9589-16e88d9db96b] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:45,137: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[1db35ebb-5faf-4cdd-8326-c6469ee11336] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:45,157: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x46"; args=None; alias=default
[2024-10-06 13:40:45,158: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x46"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:40:45,159: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:40:45,159: WARNING/ForkPoolWorker-15] No trades found for asset BTCUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x46"; args=None; alias=default
[2024-10-06 13:40:45,159: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x46"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
[2024-10-06 13:40:45,160: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
[2024-10-06 13:40:45,160: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:45,161: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:45,161: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[1db35ebb-5faf-4cdd-8326-c6469ee11336] succeeded in 0.0038926599954720587s: None
[2024-10-06 13:40:45,215: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[c2419ac4-24cd-493b-9a57-37b3f071846e] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:45,235: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:45,237: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:45,238: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:45,242: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[c2419ac4-24cd-493b-9a57-37b3f071846e] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:45,293: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[43fec33b-f58d-4bef-8597-36f152d058ff] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:45,313: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x47"; args=None; alias=default
[2024-10-06 13:40:45,314: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x47"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT') LIMIT 1; args=(1, 1, 'ETHUSDT'); alias=default
[2024-10-06 13:40:45,315: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT') LIMIT 1; args=(1, 1, 'ETHUSDT'); alias=default
[2024-10-06 13:40:45,315: WARNING/ForkPoolWorker-15] No trades found for asset ETHUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x47"; args=None; alias=default
[2024-10-06 13:40:45,315: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x47"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Buy'); alias=default
[2024-10-06 13:40:45,316: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Sell'); alias=default
[2024-10-06 13:40:45,317: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:45,318: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:45,318: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[43fec33b-f58d-4bef-8597-36f152d058ff] succeeded in 0.0050511599984019995s: None
[2024-10-06 13:40:45,371: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[ae18d22b-5665-44a4-99f7-3f363233e675] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:45,391: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:45,393: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:45,394: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:45,398: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[ae18d22b-5665-44a4-99f7-3f363233e675] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:45,450: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[e2b7ab96-2039-463f-bd3a-edffe6122db9] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:45,470: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x48"; args=None; alias=default
[2024-10-06 13:40:45,470: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x48"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:40:45,472: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:40:45,472: WARNING/ForkPoolWorker-15] No trades found for asset BTCUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x48"; args=None; alias=default
[2024-10-06 13:40:45,472: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x48"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
[2024-10-06 13:40:45,474: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
[2024-10-06 13:40:45,474: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:45,474: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:45,475: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[e2b7ab96-2039-463f-bd3a-edffe6122db9] succeeded in 0.004966369997418951s: None
[2024-10-06 13:40:45,527: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[f9c53bcc-dfad-4e0f-8846-72eb6d01d735] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:45,548: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:45,549: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:45,550: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:45,554: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[f9c53bcc-dfad-4e0f-8846-72eb6d01d735] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:45,606: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[d2df1e71-8bb3-4a08-8529-f5a4b739494a] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:45,645: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x49"; args=None; alias=default
[2024-10-06 13:40:45,646: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x49"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:40:45,647: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:40:45,647: WARNING/ForkPoolWorker-15] No trades found for asset BTCUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x49"; args=None; alias=default
[2024-10-06 13:40:45,647: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x49"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
[2024-10-06 13:40:45,648: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
[2024-10-06 13:40:45,649: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:45,649: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:45,649: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[d2df1e71-8bb3-4a08-8529-f5a4b739494a] succeeded in 0.004527810000581667s: None
[2024-10-06 13:40:45,703: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[82c95dad-639c-4250-a40a-5b5c6a4829ae] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:45,725: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:45,727: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:45,728: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:45,734: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[82c95dad-639c-4250-a40a-5b5c6a4829ae] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:45,784: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[3fc2ad65-5645-4101-a04a-3b1c704193d3] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:45,804: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x50"; args=None; alias=default
[2024-10-06 13:40:45,804: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x50"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT') LIMIT 1; args=(1, 1, 'BLURUSDT'); alias=default
[2024-10-06 13:40:45,806: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT') LIMIT 1; args=(1, 1, 'BLURUSDT'); alias=default
[2024-10-06 13:40:45,806: WARNING/ForkPoolWorker-15] No trades found for asset BLURUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x50"; args=None; alias=default
[2024-10-06 13:40:45,806: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x50"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Buy'); alias=default
[2024-10-06 13:40:45,807: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Sell'); alias=default
[2024-10-06 13:40:45,808: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:45,808: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:45,808: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[3fc2ad65-5645-4101-a04a-3b1c704193d3] succeeded in 0.004766129000927322s: None
[2024-10-06 13:40:45,861: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[31b8f62f-a0dc-433b-ade0-6603845e7139] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:45,882: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:45,884: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:45,884: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:45,888: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[31b8f62f-a0dc-433b-ade0-6603845e7139] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:45,939: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[55888af2-daaa-4798-92ce-c909ebb80e52] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:45,959: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x51"; args=None; alias=default
[2024-10-06 13:40:45,959: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x51"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT') LIMIT 1; args=(1, 1, 'BLURUSDT'); alias=default
[2024-10-06 13:40:45,960: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT') LIMIT 1; args=(1, 1, 'BLURUSDT'); alias=default
[2024-10-06 13:40:45,960: WARNING/ForkPoolWorker-15] No trades found for asset BLURUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x51"; args=None; alias=default
[2024-10-06 13:40:45,960: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x51"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Buy'); alias=default
[2024-10-06 13:40:45,961: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Sell'); alias=default
[2024-10-06 13:40:45,962: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:45,962: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:45,962: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[55888af2-daaa-4798-92ce-c909ebb80e52] succeeded in 0.0038457190021290444s: None
[2024-10-06 13:40:46,022: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[04e3f1dc-b6b2-476a-94f3-26ba86fd4882] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:46,043: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:46,045: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:46,046: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:46,052: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[04e3f1dc-b6b2-476a-94f3-26ba86fd4882] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:46,102: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[8231a2d5-fb78-4015-8a77-bea07c3aeaf5] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:46,125: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x52"; args=None; alias=default
[2024-10-06 13:40:46,125: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x52"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:40:46,127: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:40:46,127: WARNING/ForkPoolWorker-15] No trades found for asset BTCUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x52"; args=None; alias=default
[2024-10-06 13:40:46,127: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x52"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
[2024-10-06 13:40:46,128: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
[2024-10-06 13:40:46,129: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:46,129: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:46,129: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[8231a2d5-fb78-4015-8a77-bea07c3aeaf5] succeeded in 0.004634578996046912s: None
[2024-10-06 13:40:46,183: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[d3830625-e283-46fe-bab8-de41510ced9a] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:46,204: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:46,206: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:46,207: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:46,212: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[d3830625-e283-46fe-bab8-de41510ced9a] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:46,262: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[2553aa99-0d7b-4238-8e4e-3ea376ec93dd] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:46,282: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x53"; args=None; alias=default
[2024-10-06 13:40:46,283: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x53"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:40:46,284: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:40:46,285: WARNING/ForkPoolWorker-15] No trades found for asset BTCUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x53"; args=None; alias=default
[2024-10-06 13:40:46,285: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x53"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
[2024-10-06 13:40:46,286: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
[2024-10-06 13:40:46,287: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:46,287: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:46,287: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[2553aa99-0d7b-4238-8e4e-3ea376ec93dd] succeeded in 0.005285249004373327s: None
[2024-10-06 13:40:46,340: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[6fa9dc06-f35d-45a8-bddc-f2583437d0f7] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:46,360: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:46,362: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:46,363: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:46,368: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[6fa9dc06-f35d-45a8-bddc-f2583437d0f7] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:46,418: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[9c1d3c1d-9263-4089-adba-ff0dce3062ce] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:46,438: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x54"; args=None; alias=default
[2024-10-06 13:40:46,438: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x54"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:40:46,440: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:40:46,440: WARNING/ForkPoolWorker-15] No trades found for asset BTCUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x54"; args=None; alias=default
[2024-10-06 13:40:46,440: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x54"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
[2024-10-06 13:40:46,441: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
[2024-10-06 13:40:46,442: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:46,442: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:46,442: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[9c1d3c1d-9263-4089-adba-ff0dce3062ce] succeeded in 0.004482629003177863s: None
[2024-10-06 13:40:46,495: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[c88c5d81-78d8-42fc-9950-50002e6a8f72] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:46,516: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:46,518: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:46,518: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:46,523: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[c88c5d81-78d8-42fc-9950-50002e6a8f72] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:46,574: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[624170d6-1861-48c9-ac69-49b4ab079614] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:46,594: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x55"; args=None; alias=default
[2024-10-06 13:40:46,595: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x55"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:40:46,596: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:40:46,596: WARNING/ForkPoolWorker-15] No trades found for asset BTCUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x55"; args=None; alias=default
[2024-10-06 13:40:46,597: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x55"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
[2024-10-06 13:40:46,598: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
[2024-10-06 13:40:46,599: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:46,599: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:46,599: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[624170d6-1861-48c9-ac69-49b4ab079614] succeeded in 0.005443360001663677s: None
[2024-10-06 13:40:46,651: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[7b816586-a454-4d38-8817-7311f672b4ec] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:46,671: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:46,673: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:46,674: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:46,679: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[7b816586-a454-4d38-8817-7311f672b4ec] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:46,729: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[96c4dd8e-f41e-4d07-8544-0462fb306fcb] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:46,749: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x56"; args=None; alias=default
[2024-10-06 13:40:46,749: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x56"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 13:40:46,751: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 13:40:46,751: WARNING/ForkPoolWorker-15] No trades found for asset LDOUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x56"; args=None; alias=default
[2024-10-06 13:40:46,751: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x56"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
[2024-10-06 13:40:46,752: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
[2024-10-06 13:40:46,752: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:46,753: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:46,753: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[96c4dd8e-f41e-4d07-8544-0462fb306fcb] succeeded in 0.004329178998887073s: None
[2024-10-06 13:40:46,806: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[5a49ab6c-f8bd-4fc2-a595-6e6f0c745e36] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:46,826: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:46,829: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:46,829: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:46,834: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[5a49ab6c-f8bd-4fc2-a595-6e6f0c745e36] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:46,884: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[2684f8a2-24ae-4431-82df-5f915119a99a] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:46,904: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x57"; args=None; alias=default
[2024-10-06 13:40:46,905: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x57"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT') LIMIT 1; args=(1, 1, 'BLURUSDT'); alias=default
[2024-10-06 13:40:46,906: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT') LIMIT 1; args=(1, 1, 'BLURUSDT'); alias=default
[2024-10-06 13:40:46,906: WARNING/ForkPoolWorker-15] No trades found for asset BLURUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x57"; args=None; alias=default
[2024-10-06 13:40:46,907: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x57"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Buy'); alias=default
[2024-10-06 13:40:46,907: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Sell'); alias=default
[2024-10-06 13:40:46,908: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:46,908: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:46,908: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[2684f8a2-24ae-4431-82df-5f915119a99a] succeeded in 0.004592338998918422s: None
[2024-10-06 13:40:46,962: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[e06c97c6-a607-42ac-b9c7-27d1dc6c030a] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:46,982: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:46,984: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:46,985: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:46,990: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[e06c97c6-a607-42ac-b9c7-27d1dc6c030a] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:47,040: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[76ab4076-8760-4717-8d2e-1fbf7121ae00] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:47,061: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x58"; args=None; alias=default
[2024-10-06 13:40:47,061: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x58"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT') LIMIT 1; args=(1, 1, 'ARBUSDT'); alias=default
[2024-10-06 13:40:47,063: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT') LIMIT 1; args=(1, 1, 'ARBUSDT'); alias=default
[2024-10-06 13:40:47,063: WARNING/ForkPoolWorker-15] No trades found for asset ARBUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x58"; args=None; alias=default
[2024-10-06 13:40:47,063: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x58"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ARBUSDT', 'Buy'); alias=default
[2024-10-06 13:40:47,064: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ARBUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ARBUSDT', 'Sell'); alias=default
[2024-10-06 13:40:47,065: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ARBUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:47,065: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:47,066: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[76ab4076-8760-4717-8d2e-1fbf7121ae00] succeeded in 0.005164428999705706s: None
[2024-10-06 13:40:47,118: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[8b6eed09-c86a-45b2-8cd3-23be4d9de4b1] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:47,138: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:47,140: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:47,140: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:47,145: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[8b6eed09-c86a-45b2-8cd3-23be4d9de4b1] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:47,196: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[fc2698c8-08c1-4d9f-8263-ee1b9dda4783] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:47,217: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x59"; args=None; alias=default
[2024-10-06 13:40:47,217: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x59"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT') LIMIT 1; args=(1, 1, 'ETHUSDT'); alias=default
[2024-10-06 13:40:47,218: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT') LIMIT 1; args=(1, 1, 'ETHUSDT'); alias=default
[2024-10-06 13:40:47,218: WARNING/ForkPoolWorker-15] No trades found for asset ETHUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x59"; args=None; alias=default
[2024-10-06 13:40:47,219: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x59"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Buy'); alias=default
[2024-10-06 13:40:47,219: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Sell'); alias=default
[2024-10-06 13:40:47,220: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:47,220: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:47,220: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[fc2698c8-08c1-4d9f-8263-ee1b9dda4783] succeeded in 0.004414369999722112s: None
[2024-10-06 13:40:47,274: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[bc1590f9-2abd-4475-882d-06d811b858ae] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:47,294: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:47,295: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:47,296: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:47,301: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[bc1590f9-2abd-4475-882d-06d811b858ae] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:47,351: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[5c81c206-2add-4eef-888f-206312fe2f5a] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:47,371: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x60"; args=None; alias=default
[2024-10-06 13:40:47,372: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x60"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT') LIMIT 1; args=(1, 1, 'ETHUSDT'); alias=default
[2024-10-06 13:40:47,373: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT') LIMIT 1; args=(1, 1, 'ETHUSDT'); alias=default
[2024-10-06 13:40:47,373: WARNING/ForkPoolWorker-15] No trades found for asset ETHUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x60"; args=None; alias=default
[2024-10-06 13:40:47,373: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x60"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Buy'); alias=default
[2024-10-06 13:40:47,374: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Sell'); alias=default
[2024-10-06 13:40:47,375: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:47,375: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:47,376: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[5c81c206-2add-4eef-888f-206312fe2f5a] succeeded in 0.004648520000046119s: None
[2024-10-06 13:40:47,428: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[0e0ecdb7-3c86-4977-b37f-163c0351b19f] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:47,449: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:47,451: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:47,451: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:47,456: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[0e0ecdb7-3c86-4977-b37f-163c0351b19f] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:47,506: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[d073fb0b-bb7e-4998-ad6f-21d20ff2c61f] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:47,526: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x61"; args=None; alias=default
[2024-10-06 13:40:47,526: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x61"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:40:47,527: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:40:47,527: WARNING/ForkPoolWorker-15] No trades found for asset BTCUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x61"; args=None; alias=default
[2024-10-06 13:40:47,528: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x61"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
[2024-10-06 13:40:47,529: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
[2024-10-06 13:40:47,529: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:47,529: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:47,530: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[d073fb0b-bb7e-4998-ad6f-21d20ff2c61f] succeeded in 0.004230860002280679s: None
[2024-10-06 13:40:47,583: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[4bc1c30d-ef89-4ae5-b395-d78281eef436] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:47,602: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:47,604: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:47,605: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:47,610: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[4bc1c30d-ef89-4ae5-b395-d78281eef436] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:47,660: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[6b588272-251e-4e1f-b164-1376b5810f8e] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:47,699: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x62"; args=None; alias=default
[2024-10-06 13:40:47,699: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x62"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:40:47,701: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:40:47,701: WARNING/ForkPoolWorker-15] No trades found for asset BTCUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x62"; args=None; alias=default
[2024-10-06 13:40:47,701: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x62"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
[2024-10-06 13:40:47,702: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
[2024-10-06 13:40:47,703: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:47,703: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:47,703: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[6b588272-251e-4e1f-b164-1376b5810f8e] succeeded in 0.0046257099966169335s: None
[2024-10-06 13:40:47,756: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[32208802-fa57-4865-9412-b460045d9a67] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:47,776: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:47,778: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:47,778: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:47,782: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[32208802-fa57-4865-9412-b460045d9a67] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:47,834: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[a2b71d1a-c71b-4d2f-ae37-ed87d30279b8] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:47,854: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x63"; args=None; alias=default
[2024-10-06 13:40:47,854: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x63"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT') LIMIT 1; args=(1, 1, 'RUNEUSDT'); alias=default
[2024-10-06 13:40:47,856: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT') LIMIT 1; args=(1, 1, 'RUNEUSDT'); alias=default
[2024-10-06 13:40:47,856: WARNING/ForkPoolWorker-15] No trades found for asset RUNEUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x63"; args=None; alias=default
[2024-10-06 13:40:47,856: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x63"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Buy'); alias=default
[2024-10-06 13:40:47,857: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Sell'); alias=default
[2024-10-06 13:40:47,858: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:47,858: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:47,858: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[a2b71d1a-c71b-4d2f-ae37-ed87d30279b8] succeeded in 0.004764590004924685s: None
[2024-10-06 13:40:47,911: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[006414f2-da10-42e0-a5c5-8e35f8d034c5] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:47,931: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:47,933: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:47,933: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:47,938: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[006414f2-da10-42e0-a5c5-8e35f8d034c5] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:47,989: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[1cf94c48-f930-4361-88d9-71d948dc553d] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:48,009: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x64"; args=None; alias=default
[2024-10-06 13:40:48,010: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x64"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SOLUSDT') LIMIT 1; args=(1, 1, 'SOLUSDT'); alias=default
[2024-10-06 13:40:48,011: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SOLUSDT') LIMIT 1; args=(1, 1, 'SOLUSDT'); alias=default
[2024-10-06 13:40:48,011: WARNING/ForkPoolWorker-15] No trades found for asset SOLUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x64"; args=None; alias=default
[2024-10-06 13:40:48,011: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x64"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SOLUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'SOLUSDT', 'Buy'); alias=default
[2024-10-06 13:40:48,012: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SOLUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'SOLUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SOLUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'SOLUSDT', 'Sell'); alias=default
[2024-10-06 13:40:48,013: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SOLUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'SOLUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:48,013: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:48,013: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[1cf94c48-f930-4361-88d9-71d948dc553d] succeeded in 0.004540770001767669s: None
[2024-10-06 13:40:48,067: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[2e9ef6d9-c99e-41f5-815b-e732fc857976] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:48,087: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:48,089: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:48,090: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:48,093: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[2e9ef6d9-c99e-41f5-815b-e732fc857976] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:48,146: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[5614833e-ab66-4b73-a10b-14e18184dde5] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:48,166: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x65"; args=None; alias=default
[2024-10-06 13:40:48,166: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x65"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT') LIMIT 1; args=(1, 1, 'RUNEUSDT'); alias=default
[2024-10-06 13:40:48,167: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT') LIMIT 1; args=(1, 1, 'RUNEUSDT'); alias=default
[2024-10-06 13:40:48,168: WARNING/ForkPoolWorker-15] No trades found for asset RUNEUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x65"; args=None; alias=default
[2024-10-06 13:40:48,168: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x65"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Buy'); alias=default
[2024-10-06 13:40:48,169: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Sell'); alias=default
[2024-10-06 13:40:48,169: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:48,169: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:48,170: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[5614833e-ab66-4b73-a10b-14e18184dde5] succeeded in 0.0042570200021145865s: None
[2024-10-06 13:40:48,223: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[b26bf30d-74fa-439c-b825-5b169df7439e] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:48,244: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:48,245: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:48,246: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:48,250: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[b26bf30d-74fa-439c-b825-5b169df7439e] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:48,301: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[81e5b77e-0e13-4edb-9c7a-a377bd3ffb26] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:48,321: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x66"; args=None; alias=default
[2024-10-06 13:40:48,321: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x66"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:40:48,323: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:40:48,323: WARNING/ForkPoolWorker-15] No trades found for asset BTCUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x66"; args=None; alias=default
[2024-10-06 13:40:48,323: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x66"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
[2024-10-06 13:40:48,324: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
[2024-10-06 13:40:48,324: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:48,325: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:48,325: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[81e5b77e-0e13-4edb-9c7a-a377bd3ffb26] succeeded in 0.004262138994818088s: None
[2024-10-06 13:40:48,377: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[05606dcc-a534-4647-a8aa-776a7e4aba41] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:48,398: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:48,399: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:48,400: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:48,403: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[05606dcc-a534-4647-a8aa-776a7e4aba41] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:48,455: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[5f5e63ef-b068-40f0-8490-b216a14b4cd4] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:48,475: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x67"; args=None; alias=default
[2024-10-06 13:40:48,475: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x67"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:40:48,477: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:40:48,477: WARNING/ForkPoolWorker-15] No trades found for asset BTCUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x67"; args=None; alias=default
[2024-10-06 13:40:48,477: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x67"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
[2024-10-06 13:40:48,478: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
[2024-10-06 13:40:48,479: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:48,479: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:48,479: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[5f5e63ef-b068-40f0-8490-b216a14b4cd4] succeeded in 0.004357919002359267s: None
[2024-10-06 13:40:48,532: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[edebd982-90f7-4333-b1dc-33fcf478daf8] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:48,553: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x68"; args=None; alias=default
[2024-10-06 13:40:48,553: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x68"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT') LIMIT 1; args=(1, 1, 'ARBUSDT'); alias=default
[2024-10-06 13:40:48,555: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT') LIMIT 1; args=(1, 1, 'ARBUSDT'); alias=default
[2024-10-06 13:40:48,555: WARNING/ForkPoolWorker-15] No trades found for asset ARBUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x68"; args=None; alias=default
[2024-10-06 13:40:48,555: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x68"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ARBUSDT', 'Buy'); alias=default
[2024-10-06 13:40:48,556: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ARBUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ARBUSDT', 'Sell'); alias=default
[2024-10-06 13:40:48,556: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ARBUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:48,557: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:48,557: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[edebd982-90f7-4333-b1dc-33fcf478daf8] succeeded in 0.0043030400047427975s: None
[2024-10-06 13:40:48,610: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[ae262be5-2e7f-49da-ad06-55ce1197d321] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:48,630: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:48,631: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:48,632: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:48,636: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[ae262be5-2e7f-49da-ad06-55ce1197d321] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:48,687: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[62d0a155-f1d5-4fcd-ad54-946ab510afdb] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:48,707: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x69"; args=None; alias=default
[2024-10-06 13:40:48,707: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x69"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT') LIMIT 1; args=(1, 1, 'BLURUSDT'); alias=default
[2024-10-06 13:40:48,708: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT') LIMIT 1; args=(1, 1, 'BLURUSDT'); alias=default
[2024-10-06 13:40:48,708: WARNING/ForkPoolWorker-15] No trades found for asset BLURUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x69"; args=None; alias=default
[2024-10-06 13:40:48,708: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x69"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Buy'); alias=default
[2024-10-06 13:40:48,709: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Sell'); alias=default
[2024-10-06 13:40:48,710: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:48,710: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:48,710: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[62d0a155-f1d5-4fcd-ad54-946ab510afdb] succeeded in 0.0037653000035788864s: None
[2024-10-06 13:40:48,763: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[183a692d-97eb-41b8-b074-f2056b92376d] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:48,783: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:48,784: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:48,785: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:48,788: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[183a692d-97eb-41b8-b074-f2056b92376d] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:48,840: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[82176fd8-fcb3-44b3-84c8-392d09066dfa] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:48,859: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x70"; args=None; alias=default
[2024-10-06 13:40:48,859: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x70"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT') LIMIT 1; args=(1, 1, 'BLURUSDT'); alias=default
[2024-10-06 13:40:48,860: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT') LIMIT 1; args=(1, 1, 'BLURUSDT'); alias=default
[2024-10-06 13:40:48,860: WARNING/ForkPoolWorker-15] No trades found for asset BLURUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x70"; args=None; alias=default
[2024-10-06 13:40:48,860: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x70"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Buy'); alias=default
[2024-10-06 13:40:48,861: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Sell'); alias=default
[2024-10-06 13:40:48,862: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:48,862: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:48,862: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[82176fd8-fcb3-44b3-84c8-392d09066dfa] succeeded in 0.003492349998850841s: None
[2024-10-06 13:40:48,916: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[3433487b-9612-4ada-a7fe-74ece33ab988] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:48,935: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:48,937: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:48,937: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:48,941: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[3433487b-9612-4ada-a7fe-74ece33ab988] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:48,992: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[556f70f4-341d-4719-b8b3-97c653736906] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:49,012: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x71"; args=None; alias=default
[2024-10-06 13:40:49,013: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x71"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SOLUSDT') LIMIT 1; args=(1, 1, 'SOLUSDT'); alias=default
[2024-10-06 13:40:49,014: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SOLUSDT') LIMIT 1; args=(1, 1, 'SOLUSDT'); alias=default
[2024-10-06 13:40:49,014: WARNING/ForkPoolWorker-15] No trades found for asset SOLUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x71"; args=None; alias=default
[2024-10-06 13:40:49,014: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x71"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SOLUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'SOLUSDT', 'Buy'); alias=default
[2024-10-06 13:40:49,015: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SOLUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'SOLUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SOLUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'SOLUSDT', 'Sell'); alias=default
[2024-10-06 13:40:49,015: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SOLUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'SOLUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:49,016: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:49,016: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[556f70f4-341d-4719-b8b3-97c653736906] succeeded in 0.003950970000005327s: None
[2024-10-06 13:40:49,068: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[c8d4727a-94a7-4388-a9c9-4ea9f204f567] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:49,088: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:49,089: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:49,089: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:49,093: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[c8d4727a-94a7-4388-a9c9-4ea9f204f567] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:49,145: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[7562a718-02be-44d9-acf2-231048c3147a] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:49,164: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x72"; args=None; alias=default
[2024-10-06 13:40:49,165: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x72"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT') LIMIT 1; args=(1, 1, 'BLURUSDT'); alias=default
[2024-10-06 13:40:49,166: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT') LIMIT 1; args=(1, 1, 'BLURUSDT'); alias=default
[2024-10-06 13:40:49,166: WARNING/ForkPoolWorker-15] No trades found for asset BLURUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x72"; args=None; alias=default
[2024-10-06 13:40:49,166: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x72"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Buy'); alias=default
[2024-10-06 13:40:49,167: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Sell'); alias=default
[2024-10-06 13:40:49,168: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:49,168: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:49,168: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[7562a718-02be-44d9-acf2-231048c3147a] succeeded in 0.004252359998645261s: None
[2024-10-06 13:40:49,221: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[11794511-bb44-4ad5-929d-6066159fc981] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:49,241: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:49,242: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:49,243: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:49,247: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[11794511-bb44-4ad5-929d-6066159fc981] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:49,297: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[e229cc9f-c424-4d3b-bb54-729f59574848] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:49,318: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x73"; args=None; alias=default
[2024-10-06 13:40:49,318: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x73"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT') LIMIT 1; args=(1, 1, 'RUNEUSDT'); alias=default
[2024-10-06 13:40:49,319: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT') LIMIT 1; args=(1, 1, 'RUNEUSDT'); alias=default
[2024-10-06 13:40:49,319: WARNING/ForkPoolWorker-15] No trades found for asset RUNEUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x73"; args=None; alias=default
[2024-10-06 13:40:49,319: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x73"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Buy'); alias=default
[2024-10-06 13:40:49,320: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Sell'); alias=default
[2024-10-06 13:40:49,321: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:49,321: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:49,321: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[e229cc9f-c424-4d3b-bb54-729f59574848] succeeded in 0.004078138998011127s: None
[2024-10-06 13:40:49,380: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[0c1f3dc4-c1ee-4d6c-87dc-734e2f4bc332] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:49,400: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:49,401: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:49,402: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:49,405: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[0c1f3dc4-c1ee-4d6c-87dc-734e2f4bc332] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:49,457: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[da9ffcdd-b790-4bfd-909f-4e83ced98a7c] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:49,477: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x74"; args=None; alias=default
[2024-10-06 13:40:49,477: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x74"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 13:40:49,478: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 13:40:49,478: WARNING/ForkPoolWorker-15] No trades found for asset LDOUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x74"; args=None; alias=default
[2024-10-06 13:40:49,478: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x74"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
[2024-10-06 13:40:49,479: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
[2024-10-06 13:40:49,480: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:49,480: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:49,480: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[da9ffcdd-b790-4bfd-909f-4e83ced98a7c] succeeded in 0.003915098997822497s: None
[2024-10-06 13:40:49,533: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[e9d8e35c-994b-472e-8409-60fefedabbaf] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:49,553: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:49,554: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:49,554: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:49,558: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[e9d8e35c-994b-472e-8409-60fefedabbaf] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:49,610: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[c73693a5-4aea-4c30-8771-2483b807eb30] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:49,630: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x75"; args=None; alias=default
[2024-10-06 13:40:49,630: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x75"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 13:40:49,631: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 13:40:49,631: WARNING/ForkPoolWorker-15] No trades found for asset LDOUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x75"; args=None; alias=default
[2024-10-06 13:40:49,631: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x75"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
[2024-10-06 13:40:49,632: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
[2024-10-06 13:40:49,633: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:49,633: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:49,634: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[c73693a5-4aea-4c30-8771-2483b807eb30] succeeded in 0.004314899000746664s: None
[2024-10-06 13:40:49,686: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[7fbfb580-8ac4-44e1-a0a5-3377e01f8d6e] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:49,725: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:49,727: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:49,727: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:49,730: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[7fbfb580-8ac4-44e1-a0a5-3377e01f8d6e] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:49,782: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[bd47d08e-becd-452f-8b50-bdd4bad0d904] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:49,802: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:49,803: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:49,803: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:49,807: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[bd47d08e-becd-452f-8b50-bdd4bad0d904] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:49,859: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[5b91c441-050c-4a54-8dae-61ff3ad7aed1] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:49,878: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x76"; args=None; alias=default
[2024-10-06 13:40:49,878: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x76"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 13:40:49,880: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 13:40:49,880: WARNING/ForkPoolWorker-15] No trades found for asset LDOUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x76"; args=None; alias=default
[2024-10-06 13:40:49,880: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x76"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
[2024-10-06 13:40:49,881: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
[2024-10-06 13:40:49,881: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:49,881: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:49,882: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[5b91c441-050c-4a54-8dae-61ff3ad7aed1] succeeded in 0.003740668995305896s: None
[2024-10-06 13:40:49,935: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[c9feb094-c06a-45c8-ac78-2f4e1bd5d3e4] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:49,954: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:40:49,956: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:49,956: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:49,960: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[c9feb094-c06a-45c8-ac78-2f4e1bd5d3e4] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:40:50,011: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[d3e8856b-38b9-464d-b71e-f48f34519fe4] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:40:50,032: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x77"; args=None; alias=default
[2024-10-06 13:40:50,032: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x77"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT') LIMIT 1; args=(1, 1, 'RUNEUSDT'); alias=default
[2024-10-06 13:40:50,033: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT') LIMIT 1; args=(1, 1, 'RUNEUSDT'); alias=default
[2024-10-06 13:40:50,033: WARNING/ForkPoolWorker-15] No trades found for asset RUNEUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x77"; args=None; alias=default
[2024-10-06 13:40:50,033: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x77"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Buy'); alias=default
[2024-10-06 13:40:50,034: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Sell'); alias=default
[2024-10-06 13:40:50,035: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:50,035: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:40:50,035: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[d3e8856b-38b9-464d-b71e-f48f34519fe4] succeeded in 0.004133538997848518s: None
[2024-10-06 13:42:12,658: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[ee4a0ab8-823a-4b2a-a2d1-6d8ee0fbd74e] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:42:12,678: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:42:12,679: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:42:12,680: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:42:12,684: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[ee4a0ab8-823a-4b2a-a2d1-6d8ee0fbd74e] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:42:12,736: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[34ea6b15-5b6a-40e5-82c8-eee946750789] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:42:12,756: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x78"; args=None; alias=default
[2024-10-06 13:42:12,756: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x78"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT') LIMIT 1; args=(1, 1, 'RUNEUSDT'); alias=default
[2024-10-06 13:42:12,757: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT') LIMIT 1; args=(1, 1, 'RUNEUSDT'); alias=default
[2024-10-06 13:42:12,757: WARNING/ForkPoolWorker-15] No trades found for asset RUNEUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x78"; args=None; alias=default
[2024-10-06 13:42:12,757: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x78"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Buy'); alias=default
[2024-10-06 13:42:12,758: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Sell'); alias=default
[2024-10-06 13:42:12,759: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:42:12,759: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:42:12,759: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[34ea6b15-5b6a-40e5-82c8-eee946750789] succeeded in 0.004202018993964884s: None
[2024-10-06 13:42:12,813: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[29b6f42f-cbe3-419b-8032-2863cb899240] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:42:12,833: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x79"; args=None; alias=default
[2024-10-06 13:42:12,833: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x79"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT') LIMIT 1; args=(1, 1, 'RUNEUSDT'); alias=default
[2024-10-06 13:42:12,834: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT') LIMIT 1; args=(1, 1, 'RUNEUSDT'); alias=default
[2024-10-06 13:42:12,834: WARNING/ForkPoolWorker-15] No trades found for asset RUNEUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x79"; args=None; alias=default
[2024-10-06 13:42:12,834: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x79"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Buy'); alias=default
[2024-10-06 13:42:12,835: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Sell'); alias=default
[2024-10-06 13:42:12,836: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:42:12,836: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:42:12,836: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[29b6f42f-cbe3-419b-8032-2863cb899240] succeeded in 0.004185660000075586s: None
[2024-10-06 13:42:12,891: INFO/MainProcess] Task upload_csv.tasks.process_csv_file_async[cae03e88-0e6e-4e52-83f2-135e906bcac5] received
(0.001) SELECT "auth_user"."id", "auth_user"."password", "auth_user"."last_login", "auth_user"."is_superuser", "auth_user"."username", "auth_user"."first_name", "auth_user"."last_name", "auth_user"."email", "auth_user"."is_staff", "auth_user"."is_active", "auth_user"."date_joined" FROM "auth_user" WHERE "auth_user"."id" = 1 LIMIT 21; args=(1,); alias=default
[2024-10-06 13:42:12,912: DEBUG/ForkPoolWorker-15] (0.001) SELECT "auth_user"."id", "auth_user"."password", "auth_user"."last_login", "auth_user"."is_superuser", "auth_user"."username", "auth_user"."first_name", "auth_user"."last_name", "auth_user"."email", "auth_user"."is_staff", "auth_user"."is_active", "auth_user"."date_joined" FROM "auth_user" WHERE "auth_user"."id" = 1 LIMIT 21; args=(1,); alias=default
(0.000) SELECT "upload_csv_filename"."id", "upload_csv_filename"."owner_id", "upload_csv_filename"."file_name", "upload_csv_filename"."trade_count" FROM "upload_csv_filename" WHERE "upload_csv_filename"."id" = 10 LIMIT 21; args=(10,); alias=default
[2024-10-06 13:42:12,913: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_filename"."id", "upload_csv_filename"."owner_id", "upload_csv_filename"."file_name", "upload_csv_filename"."trade_count" FROM "upload_csv_filename" WHERE "upload_csv_filename"."id" = 10 LIMIT 21; args=(10,); alias=default
[2024-10-06 13:42:12,913: ERROR/ForkPoolWorker-15] Error processing CSV file: FileName matching query does not exist.
[2024-10-06 13:42:12,913: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_csv_file_async[cae03e88-0e6e-4e52-83f2-135e906bcac5] succeeded in 0.0032539789972361177s: None
[2024-10-06 13:42:12,967: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[1b2f1379-e8cd-40d0-9a18-2ffe8b34a9ef] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:42:12,987: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x80"; args=None; alias=default
[2024-10-06 13:42:12,988: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x80"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 13:42:12,989: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 13:42:12,989: WARNING/ForkPoolWorker-15] No trades found for asset LDOUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x80"; args=None; alias=default
[2024-10-06 13:42:12,989: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x80"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
[2024-10-06 13:42:12,990: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
[2024-10-06 13:42:12,991: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:42:12,991: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:42:12,991: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[1b2f1379-e8cd-40d0-9a18-2ffe8b34a9ef] succeeded in 0.004305110000132117s: None
[2024-10-06 13:42:13,044: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[138535c7-fe97-4753-89c9-281cdf837837] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:42:13,064: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:42:13,065: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:42:13,066: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:42:13,070: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[138535c7-fe97-4753-89c9-281cdf837837] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:42:13,122: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[51efd4d4-b28e-4d1a-aceb-f8755f362507] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:42:13,142: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x81"; args=None; alias=default
[2024-10-06 13:42:13,142: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x81"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT') LIMIT 1; args=(1, 1, 'ETHUSDT'); alias=default
[2024-10-06 13:42:13,143: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT') LIMIT 1; args=(1, 1, 'ETHUSDT'); alias=default
[2024-10-06 13:42:13,143: WARNING/ForkPoolWorker-15] No trades found for asset ETHUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x81"; args=None; alias=default
[2024-10-06 13:42:13,143: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x81"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Buy'); alias=default
[2024-10-06 13:42:13,144: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Sell'); alias=default
[2024-10-06 13:42:13,145: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:42:13,145: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:42:13,145: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[51efd4d4-b28e-4d1a-aceb-f8755f362507] succeeded in 0.0038204499942366965s: None
[2024-10-06 13:42:13,198: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[d17921da-291b-45ed-9432-2530efde4f21] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:42:13,219: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:42:13,220: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:42:13,221: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:42:13,225: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[d17921da-291b-45ed-9432-2530efde4f21] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:42:13,276: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[9c03b531-5a89-4987-9607-8ea3963b290a] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:42:13,296: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x82"; args=None; alias=default
[2024-10-06 13:42:13,297: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x82"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT') LIMIT 1; args=(1, 1, 'ETHUSDT'); alias=default
[2024-10-06 13:42:13,298: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT') LIMIT 1; args=(1, 1, 'ETHUSDT'); alias=default
[2024-10-06 13:42:13,298: WARNING/ForkPoolWorker-15] No trades found for asset ETHUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x82"; args=None; alias=default
[2024-10-06 13:42:13,299: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x82"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Buy'); alias=default
[2024-10-06 13:42:13,299: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Sell'); alias=default
[2024-10-06 13:42:13,300: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:42:13,300: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:42:13,300: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[9c03b531-5a89-4987-9607-8ea3963b290a] succeeded in 0.004674529998737853s: None
[2024-10-06 13:42:13,353: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[a35e9c01-2472-4453-881b-b8c6ac1da4a2] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:42:13,373: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:42:13,375: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:42:13,375: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:42:13,381: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[a35e9c01-2472-4453-881b-b8c6ac1da4a2] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:42:13,430: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[abe5c747-5c7b-4200-ae47-72da85da39aa] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:42:13,450: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:42:13,452: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:42:13,452: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:42:13,456: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[abe5c747-5c7b-4200-ae47-72da85da39aa] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:42:13,507: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[ac62eb7a-4a4b-42f8-b68f-124f40e14929] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:42:13,527: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x83"; args=None; alias=default
[2024-10-06 13:42:13,528: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x83"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT') LIMIT 1; args=(1, 1, 'RUNEUSDT'); alias=default
[2024-10-06 13:42:13,529: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT') LIMIT 1; args=(1, 1, 'RUNEUSDT'); alias=default
[2024-10-06 13:42:13,529: WARNING/ForkPoolWorker-15] No trades found for asset RUNEUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x83"; args=None; alias=default
[2024-10-06 13:42:13,529: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x83"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Buy'); alias=default
[2024-10-06 13:42:13,530: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Sell'); alias=default
[2024-10-06 13:42:13,531: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:42:13,531: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:42:13,531: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[ac62eb7a-4a4b-42f8-b68f-124f40e14929] succeeded in 0.004167279999819584s: None
[2024-10-06 13:42:13,584: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[efcfe279-2868-4a3d-88b0-531a396afc9a] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:42:13,605: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:42:13,607: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:42:13,607: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:42:13,612: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[efcfe279-2868-4a3d-88b0-531a396afc9a] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:42:13,663: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[e6a1ebce-1931-48a6-8d86-1b9552e12ae6] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:42:13,683: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x84"; args=None; alias=default
[2024-10-06 13:42:13,683: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x84"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'WIFUSDT') LIMIT 1; args=(1, 1, 'WIFUSDT'); alias=default
[2024-10-06 13:42:13,685: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'WIFUSDT') LIMIT 1; args=(1, 1, 'WIFUSDT'); alias=default
[2024-10-06 13:42:13,685: WARNING/ForkPoolWorker-15] No trades found for asset WIFUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x84"; args=None; alias=default
[2024-10-06 13:42:13,685: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x84"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'WIFUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'WIFUSDT', 'Buy'); alias=default
[2024-10-06 13:42:13,686: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'WIFUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'WIFUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'WIFUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'WIFUSDT', 'Sell'); alias=default
[2024-10-06 13:42:13,686: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'WIFUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'WIFUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:42:13,686: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:42:13,687: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[e6a1ebce-1931-48a6-8d86-1b9552e12ae6] succeeded in 0.004113409995625261s: None
[2024-10-06 13:42:13,740: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[e34111dc-63b1-40ec-b794-6819679faede] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:42:13,760: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:42:13,762: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:42:13,762: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:42:13,766: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[e34111dc-63b1-40ec-b794-6819679faede] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:42:13,817: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[5cf354e8-d6c6-4e3b-b77b-a556d77ee576] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:42:13,837: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x85"; args=None; alias=default
[2024-10-06 13:42:13,837: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x85"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:42:13,838: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:42:13,839: WARNING/ForkPoolWorker-15] No trades found for asset BTCUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x85"; args=None; alias=default
[2024-10-06 13:42:13,839: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x85"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
[2024-10-06 13:42:13,840: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
[2024-10-06 13:42:13,841: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:42:13,841: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:42:13,841: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[5cf354e8-d6c6-4e3b-b77b-a556d77ee576] succeeded in 0.004930158997012768s: None
[2024-10-06 13:42:13,893: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[fde01910-068f-49c0-be3b-61c7ce38c76a] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:42:13,913: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:42:13,914: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:42:13,915: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:42:13,919: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[fde01910-068f-49c0-be3b-61c7ce38c76a] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:42:13,970: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[764eb975-6131-4e42-b163-e28b7bd1cc5b] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:42:13,990: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x86"; args=None; alias=default
[2024-10-06 13:42:13,990: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x86"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SEIUSDT') LIMIT 1; args=(1, 1, 'SEIUSDT'); alias=default
[2024-10-06 13:42:13,991: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SEIUSDT') LIMIT 1; args=(1, 1, 'SEIUSDT'); alias=default
[2024-10-06 13:42:13,991: WARNING/ForkPoolWorker-15] No trades found for asset SEIUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x86"; args=None; alias=default
[2024-10-06 13:42:13,991: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x86"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SEIUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'SEIUSDT', 'Buy'); alias=default
[2024-10-06 13:42:13,992: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SEIUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'SEIUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SEIUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'SEIUSDT', 'Sell'); alias=default
[2024-10-06 13:42:13,993: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SEIUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'SEIUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:42:13,993: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:42:13,994: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[764eb975-6131-4e42-b163-e28b7bd1cc5b] succeeded in 0.004439919997821562s: None
[2024-10-06 13:42:14,047: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[679fbdf9-a234-45dd-874f-6563dc38f942] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:42:14,067: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:42:14,069: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:42:14,069: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:42:14,073: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[679fbdf9-a234-45dd-874f-6563dc38f942] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:42:14,124: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[e5fff7f2-dc0c-4863-8ce5-0124b1b45524] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:42:14,145: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x87"; args=None; alias=default
[2024-10-06 13:42:14,145: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x87"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT') LIMIT 1; args=(1, 1, 'ARBUSDT'); alias=default
[2024-10-06 13:42:14,146: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT') LIMIT 1; args=(1, 1, 'ARBUSDT'); alias=default
[2024-10-06 13:42:14,147: WARNING/ForkPoolWorker-15] No trades found for asset ARBUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x87"; args=None; alias=default
[2024-10-06 13:42:14,147: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x87"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ARBUSDT', 'Buy'); alias=default
[2024-10-06 13:42:14,148: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ARBUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ARBUSDT', 'Sell'); alias=default
[2024-10-06 13:42:14,148: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ARBUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:42:14,149: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:42:14,149: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[e5fff7f2-dc0c-4863-8ce5-0124b1b45524] succeeded in 0.00456654899608111s: None
[2024-10-06 13:42:14,202: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[194b9c6d-9e8d-4844-9e98-b434be72b96b] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:42:14,222: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:42:14,224: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:42:14,224: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:42:14,228: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[194b9c6d-9e8d-4844-9e98-b434be72b96b] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:42:14,280: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[00b7768d-d56e-49c6-b0cb-d62950f8a7ef] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:42:14,300: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x88"; args=None; alias=default
[2024-10-06 13:42:14,300: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x88"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'INJUSDT') LIMIT 1; args=(1, 1, 'INJUSDT'); alias=default
[2024-10-06 13:42:14,301: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'INJUSDT') LIMIT 1; args=(1, 1, 'INJUSDT'); alias=default
[2024-10-06 13:42:14,302: WARNING/ForkPoolWorker-15] No trades found for asset INJUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x88"; args=None; alias=default
[2024-10-06 13:42:14,302: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x88"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'INJUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'INJUSDT', 'Buy'); alias=default
[2024-10-06 13:42:14,303: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'INJUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'INJUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'INJUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'INJUSDT', 'Sell'); alias=default
[2024-10-06 13:42:14,304: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'INJUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'INJUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:42:14,304: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:42:14,304: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[00b7768d-d56e-49c6-b0cb-d62950f8a7ef] succeeded in 0.004873079000390135s: None
[2024-10-06 13:42:21,091: INFO/MainProcess] sync with celery@c0d5da91-eb3b-4849-bfd4-fc1467b6fd2b
[2024-10-06 13:42:34,397: INFO/MainProcess] sync with celery@5ddc6088-f7e3-44ec-8dfe-80ac806872ff
[2024-10-06 13:43:03,245: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[a755f36f-30a7-4fee-9e2d-4ed953a913eb] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:43:03,265: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:43:03,267: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:43:03,267: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:43:03,271: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[a755f36f-30a7-4fee-9e2d-4ed953a913eb] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:44:54,070: INFO/MainProcess] Task upload_csv.tasks.process_csv_file_async[eef81c57-782a-4a4a-8539-8a30ded01737] received
(0.001) SELECT "auth_user"."id", "auth_user"."password", "auth_user"."last_login", "auth_user"."is_superuser", "auth_user"."username", "auth_user"."first_name", "auth_user"."last_name", "auth_user"."email", "auth_user"."is_staff", "auth_user"."is_active", "auth_user"."date_joined" FROM "auth_user" WHERE "auth_user"."id" = 1 LIMIT 21; args=(1,); alias=default
[2024-10-06 13:44:54,092: DEBUG/ForkPoolWorker-15] (0.001) SELECT "auth_user"."id", "auth_user"."password", "auth_user"."last_login", "auth_user"."is_superuser", "auth_user"."username", "auth_user"."first_name", "auth_user"."last_name", "auth_user"."email", "auth_user"."is_staff", "auth_user"."is_active", "auth_user"."date_joined" FROM "auth_user" WHERE "auth_user"."id" = 1 LIMIT 21; args=(1,); alias=default
(0.000) SELECT "upload_csv_filename"."id", "upload_csv_filename"."owner_id", "upload_csv_filename"."file_name", "upload_csv_filename"."trade_count" FROM "upload_csv_filename" WHERE "upload_csv_filename"."id" = 11 LIMIT 21; args=(11,); alias=default
[2024-10-06 13:44:54,093: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_filename"."id", "upload_csv_filename"."owner_id", "upload_csv_filename"."file_name", "upload_csv_filename"."trade_count" FROM "upload_csv_filename" WHERE "upload_csv_filename"."id" = 11 LIMIT 21; args=(11,); alias=default
[2024-10-06 13:44:54,093: ERROR/ForkPoolWorker-15] Error processing CSV file: FileName matching query does not exist.
[2024-10-06 13:44:54,094: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_csv_file_async[eef81c57-782a-4a4a-8539-8a30ded01737] succeeded in 0.002816399995936081s: None
[2024-10-06 13:45:28,736: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[0b79893a-2cad-404f-86da-7dfbeeae3591] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:28,758: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:45:28,760: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:28,761: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:28,770: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[0b79893a-2cad-404f-86da-7dfbeeae3591] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:45:28,816: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[51f103dc-7cac-4012-a56d-b396a46f675f] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:28,838: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:45:28,840: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:28,841: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:28,848: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[51f103dc-7cac-4012-a56d-b396a46f675f] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:45:28,900: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[0f370915-004a-40a6-80b6-758330de0d8f] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:28,921: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x89"; args=None; alias=default
[2024-10-06 13:45:28,921: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x89"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT') LIMIT 1; args=(1, 1, 'RUNEUSDT'); alias=default
[2024-10-06 13:45:28,923: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT') LIMIT 1; args=(1, 1, 'RUNEUSDT'); alias=default
[2024-10-06 13:45:28,923: WARNING/ForkPoolWorker-15] No trades found for asset RUNEUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x89"; args=None; alias=default
[2024-10-06 13:45:28,923: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x89"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Buy'); alias=default
[2024-10-06 13:45:28,925: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Sell'); alias=default
[2024-10-06 13:45:28,926: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:28,926: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:28,926: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[0f370915-004a-40a6-80b6-758330de0d8f] succeeded in 0.005457218998344615s: None
[2024-10-06 13:45:28,978: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[e9dac392-f8d1-4fd1-b56f-1b5487457c53] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:29,000: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x90"; args=None; alias=default
[2024-10-06 13:45:29,001: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x90"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'NEARUSDT') LIMIT 1; args=(1, 1, 'NEARUSDT'); alias=default
[2024-10-06 13:45:29,002: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'NEARUSDT') LIMIT 1; args=(1, 1, 'NEARUSDT'); alias=default
[2024-10-06 13:45:29,003: WARNING/ForkPoolWorker-15] No trades found for asset NEARUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x90"; args=None; alias=default
[2024-10-06 13:45:29,003: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x90"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'NEARUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'NEARUSDT', 'Buy'); alias=default
[2024-10-06 13:45:29,004: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'NEARUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'NEARUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'NEARUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'NEARUSDT', 'Sell'); alias=default
[2024-10-06 13:45:29,006: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'NEARUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'NEARUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:29,006: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:29,006: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[e9dac392-f8d1-4fd1-b56f-1b5487457c53] succeeded in 0.007221010004286654s: None
[2024-10-06 13:45:29,058: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[a414a6ab-ec63-4f64-84fc-99a4e48614b4] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:29,079: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:45:29,082: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:29,083: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:29,090: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[a414a6ab-ec63-4f64-84fc-99a4e48614b4] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:45:29,137: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[0bdfb0bc-cbaa-4630-88ce-a5ec35562699] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:29,159: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x91"; args=None; alias=default
[2024-10-06 13:45:29,159: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x91"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'NEARUSDT') LIMIT 1; args=(1, 1, 'NEARUSDT'); alias=default
[2024-10-06 13:45:29,161: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'NEARUSDT') LIMIT 1; args=(1, 1, 'NEARUSDT'); alias=default
[2024-10-06 13:45:29,162: WARNING/ForkPoolWorker-15] No trades found for asset NEARUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x91"; args=None; alias=default
[2024-10-06 13:45:29,162: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x91"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'NEARUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'NEARUSDT', 'Buy'); alias=default
[2024-10-06 13:45:29,163: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'NEARUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'NEARUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'NEARUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'NEARUSDT', 'Sell'); alias=default
[2024-10-06 13:45:29,164: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'NEARUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'NEARUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:29,165: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:29,165: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[0bdfb0bc-cbaa-4630-88ce-a5ec35562699] succeeded in 0.0069206990010570735s: None
[2024-10-06 13:45:29,218: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[40091cd7-6339-4995-bca4-ada32043beb7] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:29,239: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:45:29,241: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:29,242: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:29,247: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[40091cd7-6339-4995-bca4-ada32043beb7] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:45:29,297: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[48632ed5-248d-4e70-8335-24e93ac50c7e] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:29,319: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x92"; args=None; alias=default
[2024-10-06 13:45:29,319: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x92"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT') LIMIT 1; args=(1, 1, 'RUNEUSDT'); alias=default
[2024-10-06 13:45:29,321: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT') LIMIT 1; args=(1, 1, 'RUNEUSDT'); alias=default
[2024-10-06 13:45:29,322: WARNING/ForkPoolWorker-15] No trades found for asset RUNEUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x92"; args=None; alias=default
[2024-10-06 13:45:29,322: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x92"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Buy'); alias=default
[2024-10-06 13:45:29,323: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Sell'); alias=default
[2024-10-06 13:45:29,324: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:29,325: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:29,325: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[48632ed5-248d-4e70-8335-24e93ac50c7e] succeeded in 0.00670887999876868s: None
[2024-10-06 13:45:29,377: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[8d5c5244-a09b-4c63-a4fc-0a941b5e4e04] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:29,398: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:45:29,401: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:29,402: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:29,409: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[8d5c5244-a09b-4c63-a4fc-0a941b5e4e04] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:45:29,457: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[c8ebc5e5-a1b4-42eb-a114-4b66597659be] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:29,479: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x93"; args=None; alias=default
[2024-10-06 13:45:29,479: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x93"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 13:45:29,482: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 13:45:29,482: WARNING/ForkPoolWorker-15] No trades found for asset LDOUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x93"; args=None; alias=default
[2024-10-06 13:45:29,482: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x93"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
[2024-10-06 13:45:29,484: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
[2024-10-06 13:45:29,485: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:29,485: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:29,486: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[c8ebc5e5-a1b4-42eb-a114-4b66597659be] succeeded in 0.007442808993801009s: None
[2024-10-06 13:45:29,537: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[21b2e743-5711-4176-afb7-1c7b7018ec6a] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:29,559: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:45:29,561: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:29,562: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:29,569: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[21b2e743-5711-4176-afb7-1c7b7018ec6a] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:45:29,617: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[d944ac25-edb4-4154-8eda-3ab5f94f86ce] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:29,638: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x94"; args=None; alias=default
[2024-10-06 13:45:29,639: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x94"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'INJUSDT') LIMIT 1; args=(1, 1, 'INJUSDT'); alias=default
[2024-10-06 13:45:29,641: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'INJUSDT') LIMIT 1; args=(1, 1, 'INJUSDT'); alias=default
[2024-10-06 13:45:29,641: WARNING/ForkPoolWorker-15] No trades found for asset INJUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x94"; args=None; alias=default
[2024-10-06 13:45:29,641: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x94"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'INJUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'INJUSDT', 'Buy'); alias=default
[2024-10-06 13:45:29,643: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'INJUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'INJUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'INJUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'INJUSDT', 'Sell'); alias=default
[2024-10-06 13:45:29,644: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'INJUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'INJUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:29,644: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:29,645: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[d944ac25-edb4-4154-8eda-3ab5f94f86ce] succeeded in 0.007049820000247564s: None
[2024-10-06 13:45:29,696: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[b430fefc-e152-43fc-bc08-9e47d8792c63] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:29,717: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:45:29,720: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:29,721: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:29,729: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[b430fefc-e152-43fc-bc08-9e47d8792c63] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:45:29,776: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[ebbe5756-27b6-4442-9d9b-fb37c2e435ba] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:29,798: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x95"; args=None; alias=default
[2024-10-06 13:45:29,799: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x95"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT') LIMIT 1; args=(1, 1, 'RUNEUSDT'); alias=default
[2024-10-06 13:45:29,801: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT') LIMIT 1; args=(1, 1, 'RUNEUSDT'); alias=default
[2024-10-06 13:45:29,801: WARNING/ForkPoolWorker-15] No trades found for asset RUNEUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x95"; args=None; alias=default
[2024-10-06 13:45:29,802: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x95"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Buy'); alias=default
[2024-10-06 13:45:29,803: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Sell'); alias=default
[2024-10-06 13:45:29,805: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:29,805: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:29,805: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[ebbe5756-27b6-4442-9d9b-fb37c2e435ba] succeeded in 0.007949849001306575s: None
[2024-10-06 13:45:29,856: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[95a956b3-6614-47a5-b4fb-a6dc321d5b5c] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:29,878: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:45:29,880: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:29,881: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:29,886: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[95a956b3-6614-47a5-b4fb-a6dc321d5b5c] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:45:29,937: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[7d2fe0e7-6bbc-4fc0-a39a-eb8e526093d3] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:29,959: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x96"; args=None; alias=default
[2024-10-06 13:45:29,959: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x96"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 13:45:29,961: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 13:45:29,961: WARNING/ForkPoolWorker-15] No trades found for asset LDOUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x96"; args=None; alias=default
[2024-10-06 13:45:29,961: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x96"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
[2024-10-06 13:45:29,962: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
[2024-10-06 13:45:29,963: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:29,964: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:29,964: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[7d2fe0e7-6bbc-4fc0-a39a-eb8e526093d3] succeeded in 0.0057243799965363s: None
[2024-10-06 13:45:30,017: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[0793bb00-1d8a-49ff-aa7d-1444f6ef6a9c] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:30,039: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:45:30,041: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:30,041: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:30,047: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[0793bb00-1d8a-49ff-aa7d-1444f6ef6a9c] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:45:30,097: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[7151d64d-9e88-456b-80ca-84302d6c310e] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:30,118: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x97"; args=None; alias=default
[2024-10-06 13:45:30,119: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x97"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'WIFUSDT') LIMIT 1; args=(1, 1, 'WIFUSDT'); alias=default
[2024-10-06 13:45:30,120: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'WIFUSDT') LIMIT 1; args=(1, 1, 'WIFUSDT'); alias=default
[2024-10-06 13:45:30,120: WARNING/ForkPoolWorker-15] No trades found for asset WIFUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x97"; args=None; alias=default
[2024-10-06 13:45:30,121: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x97"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'WIFUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'WIFUSDT', 'Buy'); alias=default
[2024-10-06 13:45:30,122: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'WIFUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'WIFUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'WIFUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'WIFUSDT', 'Sell'); alias=default
[2024-10-06 13:45:30,123: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'WIFUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'WIFUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:30,123: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:30,123: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[7151d64d-9e88-456b-80ca-84302d6c310e] succeeded in 0.0051772189981420524s: None
[2024-10-06 13:45:30,176: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[3fb5230b-e74c-4fe4-9760-7f77f6955c7a] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:30,197: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:45:30,200: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:30,200: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:30,208: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[3fb5230b-e74c-4fe4-9760-7f77f6955c7a] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:45:30,256: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[20527c9b-9a4b-4765-b15e-8173cff3a193] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:30,278: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x98"; args=None; alias=default
[2024-10-06 13:45:30,278: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x98"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'WIFUSDT') LIMIT 1; args=(1, 1, 'WIFUSDT'); alias=default
[2024-10-06 13:45:30,280: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'WIFUSDT') LIMIT 1; args=(1, 1, 'WIFUSDT'); alias=default
[2024-10-06 13:45:30,281: WARNING/ForkPoolWorker-15] No trades found for asset WIFUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x98"; args=None; alias=default
[2024-10-06 13:45:30,281: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x98"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'WIFUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'WIFUSDT', 'Buy'); alias=default
[2024-10-06 13:45:30,282: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'WIFUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'WIFUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'WIFUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'WIFUSDT', 'Sell'); alias=default
[2024-10-06 13:45:30,283: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'WIFUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'WIFUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:30,284: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:30,284: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[20527c9b-9a4b-4765-b15e-8173cff3a193] succeeded in 0.007184738999058027s: None
[2024-10-06 13:45:30,336: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[2e5264f3-8127-4caa-a760-65e9ff696049] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:30,358: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:45:30,361: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:30,362: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:30,367: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[2e5264f3-8127-4caa-a760-65e9ff696049] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:45:30,417: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[233229db-a1ca-48dd-8f13-0d96ca5ae2cd] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:30,439: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x99"; args=None; alias=default
[2024-10-06 13:45:30,440: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x99"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT') LIMIT 1; args=(1, 1, 'ARBUSDT'); alias=default
[2024-10-06 13:45:30,442: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT') LIMIT 1; args=(1, 1, 'ARBUSDT'); alias=default
[2024-10-06 13:45:30,442: WARNING/ForkPoolWorker-15] No trades found for asset ARBUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x99"; args=None; alias=default
[2024-10-06 13:45:30,442: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x99"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ARBUSDT', 'Buy'); alias=default
[2024-10-06 13:45:30,443: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ARBUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ARBUSDT', 'Sell'); alias=default
[2024-10-06 13:45:30,445: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ARBUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:30,445: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:30,445: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[233229db-a1ca-48dd-8f13-0d96ca5ae2cd] succeeded in 0.006641259002208244s: None
[2024-10-06 13:45:30,497: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[c74588f9-31cc-41ce-97b1-ee37f47953f6] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:30,517: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:45:30,519: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:30,520: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:30,526: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[c74588f9-31cc-41ce-97b1-ee37f47953f6] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:45:30,576: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[2c660cdd-45ba-42c3-a8e7-653da6bfd3c9] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:30,619: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x100"; args=None; alias=default
[2024-10-06 13:45:30,619: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x100"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SEIUSDT') LIMIT 1; args=(1, 1, 'SEIUSDT'); alias=default
[2024-10-06 13:45:30,621: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SEIUSDT') LIMIT 1; args=(1, 1, 'SEIUSDT'); alias=default
[2024-10-06 13:45:30,621: WARNING/ForkPoolWorker-15] No trades found for asset SEIUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x100"; args=None; alias=default
[2024-10-06 13:45:30,621: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x100"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SEIUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'SEIUSDT', 'Buy'); alias=default
[2024-10-06 13:45:30,622: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SEIUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'SEIUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SEIUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'SEIUSDT', 'Sell'); alias=default
[2024-10-06 13:45:30,623: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SEIUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'SEIUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:30,623: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:30,623: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[2c660cdd-45ba-42c3-a8e7-653da6bfd3c9] succeeded in 0.0055689590008114465s: None
[2024-10-06 13:45:30,678: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[e2330455-6cbe-41fc-a893-467dc8f3c170] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:30,699: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x101"; args=None; alias=default
[2024-10-06 13:45:30,699: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x101"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'INJUSDT') LIMIT 1; args=(1, 1, 'INJUSDT'); alias=default
[2024-10-06 13:45:30,700: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'INJUSDT') LIMIT 1; args=(1, 1, 'INJUSDT'); alias=default
[2024-10-06 13:45:30,701: WARNING/ForkPoolWorker-15] No trades found for asset INJUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x101"; args=None; alias=default
[2024-10-06 13:45:30,701: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x101"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'INJUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'INJUSDT', 'Buy'); alias=default
[2024-10-06 13:45:30,701: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'INJUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'INJUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'INJUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'INJUSDT', 'Sell'); alias=default
[2024-10-06 13:45:30,702: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'INJUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'INJUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:30,702: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:30,702: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[e2330455-6cbe-41fc-a893-467dc8f3c170] succeeded in 0.004160858996328898s: None
[2024-10-06 13:45:30,756: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[11e36091-d5e0-499f-8b73-91eae27d6388] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:30,777: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:45:30,779: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:30,779: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:30,783: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[11e36091-d5e0-499f-8b73-91eae27d6388] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:45:30,835: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[17bf55b1-01b4-416d-b632-d1aa97980a2c] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:30,857: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x102"; args=None; alias=default
[2024-10-06 13:45:30,857: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x102"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'INJUSDT') LIMIT 1; args=(1, 1, 'INJUSDT'); alias=default
[2024-10-06 13:45:30,859: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'INJUSDT') LIMIT 1; args=(1, 1, 'INJUSDT'); alias=default
[2024-10-06 13:45:30,859: WARNING/ForkPoolWorker-15] No trades found for asset INJUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x102"; args=None; alias=default
[2024-10-06 13:45:30,859: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x102"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'INJUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'INJUSDT', 'Buy'); alias=default
[2024-10-06 13:45:30,860: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'INJUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'INJUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'INJUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'INJUSDT', 'Sell'); alias=default
[2024-10-06 13:45:30,861: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'INJUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'INJUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:30,861: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:30,861: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[17bf55b1-01b4-416d-b632-d1aa97980a2c] succeeded in 0.005419939996500034s: None
[2024-10-06 13:45:30,915: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[37946fb2-a742-417b-b295-422e49008e66] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:30,936: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:45:30,938: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:30,939: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:30,945: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[37946fb2-a742-417b-b295-422e49008e66] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:45:30,995: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[a71a3048-6699-48a6-964f-b1a56248b037] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:31,016: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x103"; args=None; alias=default
[2024-10-06 13:45:31,016: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x103"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 13:45:31,018: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 13:45:31,018: WARNING/ForkPoolWorker-15] No trades found for asset LDOUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x103"; args=None; alias=default
[2024-10-06 13:45:31,018: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x103"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
[2024-10-06 13:45:31,019: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
[2024-10-06 13:45:31,020: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:31,020: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:31,021: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[a71a3048-6699-48a6-964f-b1a56248b037] succeeded in 0.005061479001597036s: None
[2024-10-06 13:45:31,074: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[465b246a-b2e7-4a7e-84df-93ffac82a5c8] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:31,095: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:45:31,097: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:31,097: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:31,103: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[465b246a-b2e7-4a7e-84df-93ffac82a5c8] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:45:31,154: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[45677c02-da92-42ac-8916-1ce60b32cfdb] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:31,175: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x104"; args=None; alias=default
[2024-10-06 13:45:31,175: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x104"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 13:45:31,177: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 13:45:31,177: WARNING/ForkPoolWorker-15] No trades found for asset LDOUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x104"; args=None; alias=default
[2024-10-06 13:45:31,177: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x104"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
[2024-10-06 13:45:31,178: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
[2024-10-06 13:45:31,179: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:31,179: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:31,179: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[45677c02-da92-42ac-8916-1ce60b32cfdb] succeeded in 0.0048614689949317835s: None
[2024-10-06 13:45:31,234: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[7d326a15-8a94-4851-8cf7-a936a4f9f366] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:31,256: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:45:31,258: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:31,259: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:31,265: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[7d326a15-8a94-4851-8cf7-a936a4f9f366] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:45:31,314: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[95ff1b0b-6979-4c12-b4d9-04e18c432ea0] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:31,335: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:45:31,337: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:31,338: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:31,345: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[95ff1b0b-6979-4c12-b4d9-04e18c432ea0] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:45:31,394: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[5d6f1efd-e47c-4d13-88b0-bb8e864a7588] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:31,415: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x105"; args=None; alias=default
[2024-10-06 13:45:31,416: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x105"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SEIUSDT') LIMIT 1; args=(1, 1, 'SEIUSDT'); alias=default
[2024-10-06 13:45:31,417: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SEIUSDT') LIMIT 1; args=(1, 1, 'SEIUSDT'); alias=default
[2024-10-06 13:45:31,418: WARNING/ForkPoolWorker-15] No trades found for asset SEIUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x105"; args=None; alias=default
[2024-10-06 13:45:31,418: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x105"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SEIUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'SEIUSDT', 'Buy'); alias=default
[2024-10-06 13:45:31,419: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SEIUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'SEIUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SEIUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'SEIUSDT', 'Sell'); alias=default
[2024-10-06 13:45:31,420: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SEIUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'SEIUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:31,420: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:31,420: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[5d6f1efd-e47c-4d13-88b0-bb8e864a7588] succeeded in 0.005407390002801549s: None
[2024-10-06 13:45:31,474: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[5ee48fbc-f265-4553-b6b0-c129d37ed8aa] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:31,495: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:45:31,497: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:31,497: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:31,501: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[5ee48fbc-f265-4553-b6b0-c129d37ed8aa] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:45:31,554: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[4250e80f-3735-4f7e-9274-4e93bc09dc0a] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:31,575: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x106"; args=None; alias=default
[2024-10-06 13:45:31,575: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x106"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT') LIMIT 1; args=(1, 1, 'BLURUSDT'); alias=default
[2024-10-06 13:45:31,577: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT') LIMIT 1; args=(1, 1, 'BLURUSDT'); alias=default
[2024-10-06 13:45:31,577: WARNING/ForkPoolWorker-15] No trades found for asset BLURUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x106"; args=None; alias=default
[2024-10-06 13:45:31,577: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x106"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Buy'); alias=default
[2024-10-06 13:45:31,578: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Sell'); alias=default
[2024-10-06 13:45:31,579: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:31,579: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:31,580: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[4250e80f-3735-4f7e-9274-4e93bc09dc0a] succeeded in 0.005097569002828095s: None
[2024-10-06 13:45:31,633: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[0aca4881-0ddd-49c0-b655-3b1fb9247623] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:31,654: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:45:31,656: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:31,657: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:31,664: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[0aca4881-0ddd-49c0-b655-3b1fb9247623] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:45:31,713: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[d7223d27-267b-47f8-a1d3-8ab5f1b66c18] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:31,738: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:45:31,741: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:31,741: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:31,747: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[d7223d27-267b-47f8-a1d3-8ab5f1b66c18] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:45:31,797: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[3d55f908-7948-402f-bec6-057b30cad8e3] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:31,818: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x107"; args=None; alias=default
[2024-10-06 13:45:31,818: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x107"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT') LIMIT 1; args=(1, 1, 'RUNEUSDT'); alias=default
[2024-10-06 13:45:31,820: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT') LIMIT 1; args=(1, 1, 'RUNEUSDT'); alias=default
[2024-10-06 13:45:31,820: WARNING/ForkPoolWorker-15] No trades found for asset RUNEUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x107"; args=None; alias=default
[2024-10-06 13:45:31,820: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x107"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Buy'); alias=default
[2024-10-06 13:45:31,822: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Sell'); alias=default
[2024-10-06 13:45:31,822: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:31,823: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:31,823: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[3d55f908-7948-402f-bec6-057b30cad8e3] succeeded in 0.005217270001594443s: None
[2024-10-06 13:45:31,876: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[b4a0f33e-1618-4cf0-8fb4-50a3945c31bd] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:31,897: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:45:31,899: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:31,900: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:31,906: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[b4a0f33e-1618-4cf0-8fb4-50a3945c31bd] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:45:31,957: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[0944412e-952d-4fab-ad41-6c9f85299261] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:31,978: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x108"; args=None; alias=default
[2024-10-06 13:45:31,978: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x108"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT') LIMIT 1; args=(1, 1, 'RUNEUSDT'); alias=default
[2024-10-06 13:45:31,980: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT') LIMIT 1; args=(1, 1, 'RUNEUSDT'); alias=default
[2024-10-06 13:45:31,980: WARNING/ForkPoolWorker-15] No trades found for asset RUNEUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x108"; args=None; alias=default
[2024-10-06 13:45:31,980: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x108"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Buy'); alias=default
[2024-10-06 13:45:31,981: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Sell'); alias=default
[2024-10-06 13:45:31,982: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:31,982: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:31,983: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[0944412e-952d-4fab-ad41-6c9f85299261] succeeded in 0.005345999001292512s: None
[2024-10-06 13:45:32,035: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[73207ea3-bc7f-473d-a19c-89b518171810] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:32,056: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:45:32,058: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:32,059: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:32,065: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[73207ea3-bc7f-473d-a19c-89b518171810] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:45:32,113: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[63ad597a-29b6-4be5-8860-83166922da5e] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:32,135: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x109"; args=None; alias=default
[2024-10-06 13:45:32,135: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x109"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 13:45:32,137: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 13:45:32,137: WARNING/ForkPoolWorker-15] No trades found for asset LDOUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x109"; args=None; alias=default
[2024-10-06 13:45:32,137: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x109"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
[2024-10-06 13:45:32,138: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
[2024-10-06 13:45:32,139: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:32,140: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:32,140: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[63ad597a-29b6-4be5-8860-83166922da5e] succeeded in 0.006000759000016842s: None
[2024-10-06 13:45:32,192: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[2dd2c7f1-a7b5-470f-874a-b810da88d348] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:32,213: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:45:32,215: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:32,215: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:32,220: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[2dd2c7f1-a7b5-470f-874a-b810da88d348] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:45:32,272: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[94d6a601-7c2d-4e1f-9a16-2357c45e8262] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:32,293: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x110"; args=None; alias=default
[2024-10-06 13:45:32,294: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x110"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'NEARUSDT') LIMIT 1; args=(1, 1, 'NEARUSDT'); alias=default
[2024-10-06 13:45:32,295: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'NEARUSDT') LIMIT 1; args=(1, 1, 'NEARUSDT'); alias=default
[2024-10-06 13:45:32,295: WARNING/ForkPoolWorker-15] No trades found for asset NEARUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x110"; args=None; alias=default
[2024-10-06 13:45:32,296: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x110"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'NEARUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'NEARUSDT', 'Buy'); alias=default
[2024-10-06 13:45:32,297: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'NEARUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'NEARUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'NEARUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'NEARUSDT', 'Sell'); alias=default
[2024-10-06 13:45:32,298: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'NEARUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'NEARUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:32,298: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:32,299: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[94d6a601-7c2d-4e1f-9a16-2357c45e8262] succeeded in 0.006141428995761089s: None
[2024-10-06 13:45:32,351: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[31851062-19e8-46ff-9e6c-085365704d79] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:32,372: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:45:32,375: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:32,375: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:32,381: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[31851062-19e8-46ff-9e6c-085365704d79] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:45:32,431: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[7a9f4135-a5f1-4586-941c-c5e434d1b117] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:32,452: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x111"; args=None; alias=default
[2024-10-06 13:45:32,452: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x111"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SEIUSDT') LIMIT 1; args=(1, 1, 'SEIUSDT'); alias=default
[2024-10-06 13:45:32,454: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SEIUSDT') LIMIT 1; args=(1, 1, 'SEIUSDT'); alias=default
[2024-10-06 13:45:32,455: WARNING/ForkPoolWorker-15] No trades found for asset SEIUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x111"; args=None; alias=default
[2024-10-06 13:45:32,455: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x111"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SEIUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'SEIUSDT', 'Buy'); alias=default
[2024-10-06 13:45:32,456: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SEIUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'SEIUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SEIUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'SEIUSDT', 'Sell'); alias=default
[2024-10-06 13:45:32,457: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SEIUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'SEIUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:32,457: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:32,457: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[7a9f4135-a5f1-4586-941c-c5e434d1b117] succeeded in 0.0061903989990241826s: None
[2024-10-06 13:45:32,509: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[ee20f25d-e9a8-4e03-9a42-ea0717c6f6ab] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:32,530: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:45:32,533: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:32,533: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:32,539: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[ee20f25d-e9a8-4e03-9a42-ea0717c6f6ab] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:45:32,589: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[ada49a14-4466-495b-bdd8-72cfd50da502] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:32,611: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x112"; args=None; alias=default
[2024-10-06 13:45:32,611: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x112"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:45:32,612: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:45:32,613: WARNING/ForkPoolWorker-15] No trades found for asset BTCUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x112"; args=None; alias=default
[2024-10-06 13:45:32,613: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x112"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
[2024-10-06 13:45:32,614: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
[2024-10-06 13:45:32,615: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:32,615: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:32,615: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[ada49a14-4466-495b-bdd8-72cfd50da502] succeeded in 0.005375809996621683s: None
[2024-10-06 13:45:32,690: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[4c0dc8d2-d299-4ce8-80c2-6de649d442da] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:32,712: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:45:32,714: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:32,715: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:32,722: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[4c0dc8d2-d299-4ce8-80c2-6de649d442da] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:45:32,770: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[67cf0419-9ba7-4bc7-8b7e-4ed5072f263e] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:32,791: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x113"; args=None; alias=default
[2024-10-06 13:45:32,791: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x113"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'WIFUSDT') LIMIT 1; args=(1, 1, 'WIFUSDT'); alias=default
[2024-10-06 13:45:32,793: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'WIFUSDT') LIMIT 1; args=(1, 1, 'WIFUSDT'); alias=default
[2024-10-06 13:45:32,793: WARNING/ForkPoolWorker-15] No trades found for asset WIFUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x113"; args=None; alias=default
[2024-10-06 13:45:32,793: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x113"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'WIFUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'WIFUSDT', 'Buy'); alias=default
[2024-10-06 13:45:32,795: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'WIFUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'WIFUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'WIFUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'WIFUSDT', 'Sell'); alias=default
[2024-10-06 13:45:32,796: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'WIFUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'WIFUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:32,796: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:32,796: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[67cf0419-9ba7-4bc7-8b7e-4ed5072f263e] succeeded in 0.005900828997255303s: None
[2024-10-06 13:45:32,848: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[efda0ba8-5f1f-4f12-a258-04a6a1b738ee] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:32,869: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:45:32,872: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:32,872: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:32,878: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[efda0ba8-5f1f-4f12-a258-04a6a1b738ee] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:45:32,927: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[5701808e-1b43-4106-8d5d-811903693a42] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:32,948: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x114"; args=None; alias=default
[2024-10-06 13:45:32,948: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x114"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:45:32,950: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:45:32,950: WARNING/ForkPoolWorker-15] No trades found for asset BTCUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x114"; args=None; alias=default
[2024-10-06 13:45:32,950: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x114"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
[2024-10-06 13:45:32,951: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
[2024-10-06 13:45:32,952: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:32,952: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:32,953: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[5701808e-1b43-4106-8d5d-811903693a42] succeeded in 0.005422238995379303s: None
[2024-10-06 13:45:33,006: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[d244a26a-1359-4685-8f6d-f1949f1c952f] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:33,027: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:45:33,029: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:33,029: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:33,034: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[d244a26a-1359-4685-8f6d-f1949f1c952f] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:45:33,084: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[abfed218-1f83-42c7-8626-89a6ba1b2d08] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:33,105: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x115"; args=None; alias=default
[2024-10-06 13:45:33,105: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x115"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:45:33,107: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:45:33,107: WARNING/ForkPoolWorker-15] No trades found for asset BTCUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x115"; args=None; alias=default
[2024-10-06 13:45:33,107: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x115"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
[2024-10-06 13:45:33,108: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
[2024-10-06 13:45:33,109: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:33,109: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:33,110: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[abfed218-1f83-42c7-8626-89a6ba1b2d08] succeeded in 0.005105279000417795s: None
[2024-10-06 13:45:33,163: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[ae2c4bbf-31f5-4096-86a7-37520b0e6310] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:33,184: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:45:33,188: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:33,188: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:33,197: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[ae2c4bbf-31f5-4096-86a7-37520b0e6310] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:45:33,242: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[811a87aa-52a9-4af7-93cd-07fb58fe3470] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:33,262: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x116"; args=None; alias=default
[2024-10-06 13:45:33,263: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x116"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'MATICUSDT') LIMIT 1; args=(1, 1, 'MATICUSDT'); alias=default
[2024-10-06 13:45:33,264: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'MATICUSDT') LIMIT 1; args=(1, 1, 'MATICUSDT'); alias=default
[2024-10-06 13:45:33,264: WARNING/ForkPoolWorker-15] No trades found for asset MATICUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x116"; args=None; alias=default
[2024-10-06 13:45:33,264: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x116"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'MATICUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'MATICUSDT', 'Buy'); alias=default
[2024-10-06 13:45:33,265: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'MATICUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'MATICUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'MATICUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'MATICUSDT', 'Sell'); alias=default
[2024-10-06 13:45:33,266: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'MATICUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'MATICUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:33,266: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:33,266: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[811a87aa-52a9-4af7-93cd-07fb58fe3470] succeeded in 0.003957749999244697s: None
[2024-10-06 13:45:33,319: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[563c5029-9dac-427c-b83d-652736a52284] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:33,342: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:45:33,343: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:33,343: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:33,348: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[563c5029-9dac-427c-b83d-652736a52284] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:45:33,400: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[cdc67513-0d2a-484b-962c-66d7a2f89b58] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:33,421: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x117"; args=None; alias=default
[2024-10-06 13:45:33,421: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x117"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'MATICUSDT') LIMIT 1; args=(1, 1, 'MATICUSDT'); alias=default
[2024-10-06 13:45:33,422: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'MATICUSDT') LIMIT 1; args=(1, 1, 'MATICUSDT'); alias=default
[2024-10-06 13:45:33,422: WARNING/ForkPoolWorker-15] No trades found for asset MATICUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x117"; args=None; alias=default
[2024-10-06 13:45:33,423: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x117"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'MATICUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'MATICUSDT', 'Buy'); alias=default
[2024-10-06 13:45:33,423: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'MATICUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'MATICUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'MATICUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'MATICUSDT', 'Sell'); alias=default
[2024-10-06 13:45:33,424: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'MATICUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'MATICUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:33,424: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:33,425: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[cdc67513-0d2a-484b-962c-66d7a2f89b58] succeeded in 0.004554389000986703s: None
[2024-10-06 13:45:33,479: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[fc408080-eec3-4843-9f48-aa796770874f] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:33,499: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:45:33,501: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:33,501: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:33,505: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[fc408080-eec3-4843-9f48-aa796770874f] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:45:33,557: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[f33bfee8-80c3-436c-9842-6aee6d1777d6] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:33,577: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:45:33,579: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:33,579: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:33,585: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[f33bfee8-80c3-436c-9842-6aee6d1777d6] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:45:33,635: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[50802c4c-f9e9-400b-9c69-f526721c1307] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:33,656: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x118"; args=None; alias=default
[2024-10-06 13:45:33,656: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x118"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:45:33,658: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:45:33,658: WARNING/ForkPoolWorker-15] No trades found for asset BTCUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x118"; args=None; alias=default
[2024-10-06 13:45:33,658: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x118"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
[2024-10-06 13:45:33,659: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
[2024-10-06 13:45:33,659: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:33,660: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:33,660: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[50802c4c-f9e9-400b-9c69-f526721c1307] succeeded in 0.003971739002736285s: None
[2024-10-06 13:45:33,713: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[7431a4a6-e645-4ce8-bc02-a850f4280733] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:33,734: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:45:33,735: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:33,735: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:33,739: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[7431a4a6-e645-4ce8-bc02-a850f4280733] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:45:33,792: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[e730648d-bad6-44e7-b8df-598e1bd485fe] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:33,812: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x119"; args=None; alias=default
[2024-10-06 13:45:33,812: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x119"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT') LIMIT 1; args=(1, 1, 'ARBUSDT'); alias=default
[2024-10-06 13:45:33,813: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT') LIMIT 1; args=(1, 1, 'ARBUSDT'); alias=default
[2024-10-06 13:45:33,814: WARNING/ForkPoolWorker-15] No trades found for asset ARBUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x119"; args=None; alias=default
[2024-10-06 13:45:33,814: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x119"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ARBUSDT', 'Buy'); alias=default
[2024-10-06 13:45:33,814: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ARBUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ARBUSDT', 'Sell'); alias=default
[2024-10-06 13:45:33,815: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ARBUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:33,815: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:33,815: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[e730648d-bad6-44e7-b8df-598e1bd485fe] succeeded in 0.0038998200034257025s: None
[2024-10-06 13:45:33,869: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[262e202c-2705-46cf-882c-23d17bec2543] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:33,890: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:45:33,891: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:33,892: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:33,895: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[262e202c-2705-46cf-882c-23d17bec2543] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:45:33,948: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[e34f28f7-2fda-4448-9eed-219e696522ef] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:33,968: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x120"; args=None; alias=default
[2024-10-06 13:45:33,969: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x120"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT') LIMIT 1; args=(1, 1, 'RUNEUSDT'); alias=default
[2024-10-06 13:45:33,970: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT') LIMIT 1; args=(1, 1, 'RUNEUSDT'); alias=default
[2024-10-06 13:45:33,970: WARNING/ForkPoolWorker-15] No trades found for asset RUNEUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x120"; args=None; alias=default
[2024-10-06 13:45:33,970: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x120"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Buy'); alias=default
[2024-10-06 13:45:33,971: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Sell'); alias=default
[2024-10-06 13:45:33,972: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:33,972: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:33,972: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[e34f28f7-2fda-4448-9eed-219e696522ef] succeeded in 0.004341170002589934s: None
[2024-10-06 13:45:34,026: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[7cf7d253-621e-4731-8d3a-92e79e1e534e] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:34,046: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:45:34,048: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:34,048: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:34,052: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[7cf7d253-621e-4731-8d3a-92e79e1e534e] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:45:34,105: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[bfea3572-4a58-427f-956c-3e86d08f0e8b] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:34,127: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x121"; args=None; alias=default
[2024-10-06 13:45:34,127: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x121"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT') LIMIT 1; args=(1, 1, 'ETHUSDT'); alias=default
[2024-10-06 13:45:34,128: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT') LIMIT 1; args=(1, 1, 'ETHUSDT'); alias=default
[2024-10-06 13:45:34,128: WARNING/ForkPoolWorker-15] No trades found for asset ETHUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x121"; args=None; alias=default
[2024-10-06 13:45:34,128: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x121"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Buy'); alias=default
[2024-10-06 13:45:34,129: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Sell'); alias=default
[2024-10-06 13:45:34,130: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:34,130: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:34,130: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[bfea3572-4a58-427f-956c-3e86d08f0e8b] succeeded in 0.004110118999960832s: None
[2024-10-06 13:45:34,186: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[067e275c-47b3-48c0-a83a-a324c0627f62] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:34,207: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x122"; args=None; alias=default
[2024-10-06 13:45:34,207: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x122"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:45:34,208: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:45:34,209: WARNING/ForkPoolWorker-15] No trades found for asset BTCUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x122"; args=None; alias=default
[2024-10-06 13:45:34,209: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x122"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
[2024-10-06 13:45:34,209: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
[2024-10-06 13:45:34,210: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:34,210: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:34,210: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[067e275c-47b3-48c0-a83a-a324c0627f62] succeeded in 0.004164988997217733s: None
[2024-10-06 13:45:34,264: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[33d77e1b-8234-4a1b-9711-6a014a63c3d9] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:34,285: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:45:34,286: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:34,287: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:34,290: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[33d77e1b-8234-4a1b-9711-6a014a63c3d9] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:45:34,343: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[9adb7993-0e17-4623-870c-5b43e42ad479] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:34,363: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x123"; args=None; alias=default
[2024-10-06 13:45:34,364: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x123"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 13:45:34,365: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 13:45:34,365: WARNING/ForkPoolWorker-15] No trades found for asset LDOUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x123"; args=None; alias=default
[2024-10-06 13:45:34,365: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x123"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
[2024-10-06 13:45:34,366: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
[2024-10-06 13:45:34,367: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:34,367: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:34,367: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[9adb7993-0e17-4623-870c-5b43e42ad479] succeeded in 0.0038719590011169203s: None
[2024-10-06 13:45:34,421: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[a8275a0a-bd44-475c-8c2b-f68a0f3f8a07] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:34,441: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:45:34,443: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:34,443: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:34,447: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[a8275a0a-bd44-475c-8c2b-f68a0f3f8a07] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:45:34,500: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[b7d48550-7782-4791-8cfc-13eb0a2b57e3] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:34,520: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x124"; args=None; alias=default
[2024-10-06 13:45:34,521: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x124"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT') LIMIT 1; args=(1, 1, 'BLURUSDT'); alias=default
[2024-10-06 13:45:34,522: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT') LIMIT 1; args=(1, 1, 'BLURUSDT'); alias=default
[2024-10-06 13:45:34,522: WARNING/ForkPoolWorker-15] No trades found for asset BLURUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x124"; args=None; alias=default
[2024-10-06 13:45:34,522: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x124"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Buy'); alias=default
[2024-10-06 13:45:34,523: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Sell'); alias=default
[2024-10-06 13:45:34,524: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:34,524: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:34,524: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[b7d48550-7782-4791-8cfc-13eb0a2b57e3] succeeded in 0.004018499996163882s: None
[2024-10-06 13:45:34,578: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[abb45588-82a9-47a2-b9b2-72d7dacabaae] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:34,598: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:45:34,600: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:34,601: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:34,604: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[abb45588-82a9-47a2-b9b2-72d7dacabaae] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:45:34,656: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[aee7281c-bd58-4562-bf78-2812d4d46682] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:34,697: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x125"; args=None; alias=default
[2024-10-06 13:45:34,697: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x125"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT') LIMIT 1; args=(1, 1, 'ETHUSDT'); alias=default
[2024-10-06 13:45:34,698: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT') LIMIT 1; args=(1, 1, 'ETHUSDT'); alias=default
[2024-10-06 13:45:34,698: WARNING/ForkPoolWorker-15] No trades found for asset ETHUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x125"; args=None; alias=default
[2024-10-06 13:45:34,698: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x125"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Buy'); alias=default
[2024-10-06 13:45:34,699: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Sell'); alias=default
[2024-10-06 13:45:34,699: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:34,700: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:34,700: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[aee7281c-bd58-4562-bf78-2812d4d46682] succeeded in 0.003940599999623373s: None
[2024-10-06 13:45:34,756: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[ddbe88a1-023d-4193-9964-ea794d7de642] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:34,777: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:45:34,778: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:34,779: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:34,783: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[ddbe88a1-023d-4193-9964-ea794d7de642] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:45:34,835: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[4cd59543-96f5-45be-9be9-b820d888dd7f] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:34,855: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x126"; args=None; alias=default
[2024-10-06 13:45:34,855: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x126"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:45:34,857: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:45:34,857: WARNING/ForkPoolWorker-15] No trades found for asset BTCUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x126"; args=None; alias=default
[2024-10-06 13:45:34,857: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x126"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
[2024-10-06 13:45:34,858: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
[2024-10-06 13:45:34,858: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:34,859: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:34,859: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[4cd59543-96f5-45be-9be9-b820d888dd7f] succeeded in 0.004422468999109697s: None
[2024-10-06 13:45:34,912: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[e689453c-5c10-4008-8e6b-316f89c6b080] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:34,933: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:45:34,935: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:34,935: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:34,939: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[e689453c-5c10-4008-8e6b-316f89c6b080] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:45:34,991: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[d5e7f7f4-1338-458a-8bfa-791c62b177b0] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:35,016: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x127"; args=None; alias=default
[2024-10-06 13:45:35,017: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x127"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT') LIMIT 1; args=(1, 1, 'ETHUSDT'); alias=default
[2024-10-06 13:45:35,018: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT') LIMIT 1; args=(1, 1, 'ETHUSDT'); alias=default
[2024-10-06 13:45:35,018: WARNING/ForkPoolWorker-15] No trades found for asset ETHUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x127"; args=None; alias=default
[2024-10-06 13:45:35,018: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x127"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Buy'); alias=default
[2024-10-06 13:45:35,019: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Sell'); alias=default
[2024-10-06 13:45:35,020: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:35,020: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:35,021: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[d5e7f7f4-1338-458a-8bfa-791c62b177b0] succeeded in 0.00475212000310421s: None
[2024-10-06 13:45:35,074: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[c89e2e90-fd42-433c-bb8d-5f9499479f10] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:35,094: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:45:35,096: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:35,096: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:35,102: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[c89e2e90-fd42-433c-bb8d-5f9499479f10] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:45:35,154: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[fc5c8be0-a2a6-4256-8421-7b83ea5eab0a] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:35,174: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x128"; args=None; alias=default
[2024-10-06 13:45:35,175: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x128"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:45:35,176: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:45:35,176: WARNING/ForkPoolWorker-15] No trades found for asset BTCUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x128"; args=None; alias=default
[2024-10-06 13:45:35,176: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x128"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
[2024-10-06 13:45:35,177: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
[2024-10-06 13:45:35,178: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:35,178: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:35,178: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[fc5c8be0-a2a6-4256-8421-7b83ea5eab0a] succeeded in 0.004281900000933092s: None
[2024-10-06 13:45:35,232: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[9f9c8945-763e-48cb-a2fe-faeea12381a0] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:35,253: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:45:35,255: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:35,255: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:35,259: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[9f9c8945-763e-48cb-a2fe-faeea12381a0] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:45:35,311: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[e488298f-5b9e-416f-b214-23ac84bbb57c] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:35,332: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x129"; args=None; alias=default
[2024-10-06 13:45:35,333: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x129"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:45:35,334: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:45:35,334: WARNING/ForkPoolWorker-15] No trades found for asset BTCUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x129"; args=None; alias=default
[2024-10-06 13:45:35,334: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x129"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
[2024-10-06 13:45:35,335: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
[2024-10-06 13:45:35,336: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:35,336: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:35,336: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[e488298f-5b9e-416f-b214-23ac84bbb57c] succeeded in 0.004380428996228147s: None
[2024-10-06 13:45:35,390: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[c8d03a0b-7ec6-4e0c-ab74-8fd4fc255cf8] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:35,411: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:45:35,412: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:35,413: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:35,416: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[c8d03a0b-7ec6-4e0c-ab74-8fd4fc255cf8] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:45:35,469: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[09521bd8-cfd6-4af9-aa96-ba3487ee9508] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:35,490: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x130"; args=None; alias=default
[2024-10-06 13:45:35,490: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x130"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT') LIMIT 1; args=(1, 1, 'BLURUSDT'); alias=default
[2024-10-06 13:45:35,491: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT') LIMIT 1; args=(1, 1, 'BLURUSDT'); alias=default
[2024-10-06 13:45:35,491: WARNING/ForkPoolWorker-15] No trades found for asset BLURUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x130"; args=None; alias=default
[2024-10-06 13:45:35,491: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x130"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Buy'); alias=default
[2024-10-06 13:45:35,492: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Sell'); alias=default
[2024-10-06 13:45:35,493: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:35,493: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:35,493: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[09521bd8-cfd6-4af9-aa96-ba3487ee9508] succeeded in 0.003755879995878786s: None
[2024-10-06 13:45:35,547: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[043bbe66-dcac-48cf-915c-b4e7bc23a09d] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:35,568: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:45:35,570: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:35,570: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:35,574: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[043bbe66-dcac-48cf-915c-b4e7bc23a09d] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:45:35,627: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[a4476143-8dc7-4b66-880d-dd80727f7d13] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:35,648: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x131"; args=None; alias=default
[2024-10-06 13:45:35,648: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x131"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT') LIMIT 1; args=(1, 1, 'BLURUSDT'); alias=default
[2024-10-06 13:45:35,650: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT') LIMIT 1; args=(1, 1, 'BLURUSDT'); alias=default
[2024-10-06 13:45:35,650: WARNING/ForkPoolWorker-15] No trades found for asset BLURUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x131"; args=None; alias=default
[2024-10-06 13:45:35,650: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x131"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Buy'); alias=default
[2024-10-06 13:45:35,651: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Sell'); alias=default
[2024-10-06 13:45:35,652: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:35,652: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:35,652: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[a4476143-8dc7-4b66-880d-dd80727f7d13] succeeded in 0.005089739999675658s: None
[2024-10-06 13:45:35,706: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[53c85881-5c10-4791-be7b-7360302b91db] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:35,727: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:45:35,729: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:35,729: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:35,733: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[53c85881-5c10-4791-be7b-7360302b91db] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:45:35,785: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[7c389795-6e2f-4aa3-8ac4-9252ff2e067e] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:35,808: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x132"; args=None; alias=default
[2024-10-06 13:45:35,808: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x132"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:45:35,809: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:45:35,809: WARNING/ForkPoolWorker-15] No trades found for asset BTCUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x132"; args=None; alias=default
[2024-10-06 13:45:35,810: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x132"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
[2024-10-06 13:45:35,810: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
[2024-10-06 13:45:35,811: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:35,811: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:35,811: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[7c389795-6e2f-4aa3-8ac4-9252ff2e067e] succeeded in 0.004454438996617682s: None
[2024-10-06 13:45:35,865: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[54467400-578d-44e2-9919-00a39d7c1dd0] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:35,887: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:45:35,888: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:35,889: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:35,892: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[54467400-578d-44e2-9919-00a39d7c1dd0] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:45:35,946: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[c67194f3-68b3-470e-80cb-7b15345c6f8e] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:35,966: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x133"; args=None; alias=default
[2024-10-06 13:45:35,967: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x133"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:45:35,968: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:45:35,968: WARNING/ForkPoolWorker-15] No trades found for asset BTCUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x133"; args=None; alias=default
[2024-10-06 13:45:35,968: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x133"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
[2024-10-06 13:45:35,969: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
[2024-10-06 13:45:35,970: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:35,970: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:35,970: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[c67194f3-68b3-470e-80cb-7b15345c6f8e] succeeded in 0.0040625600013299845s: None
[2024-10-06 13:45:36,024: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[8f353320-a4d7-4b57-818a-ce8d342e9fad] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:36,045: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:45:36,047: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:36,047: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:36,052: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[8f353320-a4d7-4b57-818a-ce8d342e9fad] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:45:36,105: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[2c54a131-3c0c-49d0-b716-7b14d92f294b] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:36,126: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x134"; args=None; alias=default
[2024-10-06 13:45:36,126: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x134"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:45:36,127: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:45:36,127: WARNING/ForkPoolWorker-15] No trades found for asset BTCUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x134"; args=None; alias=default
[2024-10-06 13:45:36,128: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x134"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
[2024-10-06 13:45:36,129: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
[2024-10-06 13:45:36,129: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:36,130: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:36,130: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[2c54a131-3c0c-49d0-b716-7b14d92f294b] succeeded in 0.004688378998253029s: None
[2024-10-06 13:45:36,183: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[556de57a-8f8c-4e4f-b8ed-f8f58dd1ba32] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:36,203: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:45:36,205: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:36,205: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:36,209: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[556de57a-8f8c-4e4f-b8ed-f8f58dd1ba32] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:45:36,261: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[ab6e2299-69ab-49aa-9b46-b33214c61333] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:36,282: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x135"; args=None; alias=default
[2024-10-06 13:45:36,282: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x135"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:45:36,283: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:45:36,284: WARNING/ForkPoolWorker-15] No trades found for asset BTCUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x135"; args=None; alias=default
[2024-10-06 13:45:36,284: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x135"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
[2024-10-06 13:45:36,285: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
[2024-10-06 13:45:36,286: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:36,286: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:36,286: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[ab6e2299-69ab-49aa-9b46-b33214c61333] succeeded in 0.004752429005748127s: None
[2024-10-06 13:45:36,340: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[11952095-5b3c-4b3b-a3ee-c69731ec30c6] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:36,360: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:45:36,362: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:36,362: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:36,366: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[11952095-5b3c-4b3b-a3ee-c69731ec30c6] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:45:36,418: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[bf7b7319-df51-4652-a634-14ab41fe574b] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:36,439: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x136"; args=None; alias=default
[2024-10-06 13:45:36,440: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x136"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 13:45:36,441: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 13:45:36,441: WARNING/ForkPoolWorker-15] No trades found for asset LDOUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x136"; args=None; alias=default
[2024-10-06 13:45:36,442: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x136"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
[2024-10-06 13:45:36,442: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
[2024-10-06 13:45:36,444: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:36,444: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:36,444: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[bf7b7319-df51-4652-a634-14ab41fe574b] succeeded in 0.005164229005458765s: None
[2024-10-06 13:45:36,497: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[3405abb7-bcbd-422b-99c4-9c24c5ea4e2c] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:36,518: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:45:36,519: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:36,520: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:36,523: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[3405abb7-bcbd-422b-99c4-9c24c5ea4e2c] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:45:36,576: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[b0ffb0c3-5b10-4713-b0b6-8a67c279dd57] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:36,597: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x137"; args=None; alias=default
[2024-10-06 13:45:36,598: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x137"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT') LIMIT 1; args=(1, 1, 'BLURUSDT'); alias=default
[2024-10-06 13:45:36,599: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT') LIMIT 1; args=(1, 1, 'BLURUSDT'); alias=default
[2024-10-06 13:45:36,599: WARNING/ForkPoolWorker-15] No trades found for asset BLURUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x137"; args=None; alias=default
[2024-10-06 13:45:36,599: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x137"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Buy'); alias=default
[2024-10-06 13:45:36,600: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Sell'); alias=default
[2024-10-06 13:45:36,601: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:36,601: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:36,601: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[b0ffb0c3-5b10-4713-b0b6-8a67c279dd57] succeeded in 0.004114700001082383s: None
[2024-10-06 13:45:36,655: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[81d994f3-34b1-44e4-98ab-17fc1caa58fc] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:36,676: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:45:36,678: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:36,678: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:36,682: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[81d994f3-34b1-44e4-98ab-17fc1caa58fc] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:45:36,754: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[b6c4bce8-544d-4736-912f-2e60b8f8068c] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:36,774: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x138"; args=None; alias=default
[2024-10-06 13:45:36,775: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x138"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT') LIMIT 1; args=(1, 1, 'ARBUSDT'); alias=default
[2024-10-06 13:45:36,776: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT') LIMIT 1; args=(1, 1, 'ARBUSDT'); alias=default
[2024-10-06 13:45:36,776: WARNING/ForkPoolWorker-15] No trades found for asset ARBUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x138"; args=None; alias=default
[2024-10-06 13:45:36,776: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x138"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ARBUSDT', 'Buy'); alias=default
[2024-10-06 13:45:36,777: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ARBUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ARBUSDT', 'Sell'); alias=default
[2024-10-06 13:45:36,777: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ARBUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:36,778: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:36,778: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[b6c4bce8-544d-4736-912f-2e60b8f8068c] succeeded in 0.003916870002285577s: None
[2024-10-06 13:45:36,831: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[081bb10b-4db9-42a0-9a85-787e1adf458e] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:36,852: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:45:36,854: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:36,855: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:36,859: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[081bb10b-4db9-42a0-9a85-787e1adf458e] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:45:36,911: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[91ff0aaa-80cf-443a-b918-caad4652ab46] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:36,932: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x139"; args=None; alias=default
[2024-10-06 13:45:36,933: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x139"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT') LIMIT 1; args=(1, 1, 'ETHUSDT'); alias=default
[2024-10-06 13:45:36,934: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT') LIMIT 1; args=(1, 1, 'ETHUSDT'); alias=default
[2024-10-06 13:45:36,934: WARNING/ForkPoolWorker-15] No trades found for asset ETHUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x139"; args=None; alias=default
[2024-10-06 13:45:36,934: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x139"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Buy'); alias=default
[2024-10-06 13:45:36,935: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Sell'); alias=default
[2024-10-06 13:45:36,936: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:36,936: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:36,936: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[91ff0aaa-80cf-443a-b918-caad4652ab46] succeeded in 0.004666868997446727s: None
[2024-10-06 13:45:36,990: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[e4f5f5ee-4e2d-4244-a6f8-b9bc21da9e44] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:37,011: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x140"; args=None; alias=default
[2024-10-06 13:45:37,011: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x140"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT') LIMIT 1; args=(1, 1, 'ETHUSDT'); alias=default
[2024-10-06 13:45:37,013: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT') LIMIT 1; args=(1, 1, 'ETHUSDT'); alias=default
[2024-10-06 13:45:37,013: WARNING/ForkPoolWorker-15] No trades found for asset ETHUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x140"; args=None; alias=default
[2024-10-06 13:45:37,013: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x140"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Buy'); alias=default
[2024-10-06 13:45:37,014: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Sell'); alias=default
[2024-10-06 13:45:37,015: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:37,015: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:37,015: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[e4f5f5ee-4e2d-4244-a6f8-b9bc21da9e44] succeeded in 0.004628520000551362s: None
[2024-10-06 13:45:37,069: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[4d93653a-6486-480e-9276-994984eb9c3e] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:37,090: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:45:37,091: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:37,092: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:37,096: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[4d93653a-6486-480e-9276-994984eb9c3e] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:45:37,148: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[0e9ee219-cc72-4d3b-bf82-dc86f312e09c] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:37,169: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x141"; args=None; alias=default
[2024-10-06 13:45:37,169: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x141"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:45:37,170: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:45:37,171: WARNING/ForkPoolWorker-15] No trades found for asset BTCUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x141"; args=None; alias=default
[2024-10-06 13:45:37,171: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x141"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
[2024-10-06 13:45:37,172: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
[2024-10-06 13:45:37,173: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:37,173: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:37,173: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[0e9ee219-cc72-4d3b-bf82-dc86f312e09c] succeeded in 0.0045865400024922565s: None
[2024-10-06 13:45:37,227: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[a7e3308f-a1d6-4828-abc7-933c2aa7a972] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:37,248: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:45:37,250: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:37,250: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:37,253: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[a7e3308f-a1d6-4828-abc7-933c2aa7a972] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:45:37,306: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[78b3b843-24cb-4bc0-bb01-b4f168d0468f] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:37,327: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x142"; args=None; alias=default
[2024-10-06 13:45:37,327: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x142"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:45:37,328: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:45:37,328: WARNING/ForkPoolWorker-15] No trades found for asset BTCUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x142"; args=None; alias=default
[2024-10-06 13:45:37,329: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x142"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
[2024-10-06 13:45:37,329: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
[2024-10-06 13:45:37,330: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:37,330: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:37,330: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[78b3b843-24cb-4bc0-bb01-b4f168d0468f] succeeded in 0.004375639000500087s: None
[2024-10-06 13:45:37,384: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[f803c97f-9f80-41cd-9547-b2a714d9970a] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:37,405: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:45:37,407: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:37,407: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:37,411: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[f803c97f-9f80-41cd-9547-b2a714d9970a] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:45:37,463: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[e8248430-2746-4450-b9e5-e215f662cafa] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:37,484: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x143"; args=None; alias=default
[2024-10-06 13:45:37,484: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x143"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT') LIMIT 1; args=(1, 1, 'RUNEUSDT'); alias=default
[2024-10-06 13:45:37,486: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT') LIMIT 1; args=(1, 1, 'RUNEUSDT'); alias=default
[2024-10-06 13:45:37,486: WARNING/ForkPoolWorker-15] No trades found for asset RUNEUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x143"; args=None; alias=default
[2024-10-06 13:45:37,486: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x143"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Buy'); alias=default
[2024-10-06 13:45:37,487: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Sell'); alias=default
[2024-10-06 13:45:37,488: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:37,489: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:37,489: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[e8248430-2746-4450-b9e5-e215f662cafa] succeeded in 0.005847430002177134s: None
[2024-10-06 13:45:37,541: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[559e7437-1875-48a2-9242-a6a91b8cb14a] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:37,563: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:45:37,565: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:37,565: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:37,572: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[559e7437-1875-48a2-9242-a6a91b8cb14a] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:45:37,621: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[12e5ba59-0b14-4b17-ab53-02c9be4670f3] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:37,642: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x144"; args=None; alias=default
[2024-10-06 13:45:37,642: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x144"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SOLUSDT') LIMIT 1; args=(1, 1, 'SOLUSDT'); alias=default
[2024-10-06 13:45:37,644: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SOLUSDT') LIMIT 1; args=(1, 1, 'SOLUSDT'); alias=default
[2024-10-06 13:45:37,644: WARNING/ForkPoolWorker-15] No trades found for asset SOLUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x144"; args=None; alias=default
[2024-10-06 13:45:37,644: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x144"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SOLUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'SOLUSDT', 'Buy'); alias=default
[2024-10-06 13:45:37,646: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SOLUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'SOLUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SOLUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'SOLUSDT', 'Sell'); alias=default
[2024-10-06 13:45:37,647: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SOLUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'SOLUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:37,647: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:37,647: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[12e5ba59-0b14-4b17-ab53-02c9be4670f3] succeeded in 0.005720588997064624s: None
[2024-10-06 13:45:37,699: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[a8cbe8e9-4077-472e-a10f-a3e27110c1fb] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:37,720: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:45:37,722: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:37,723: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:37,730: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[a8cbe8e9-4077-472e-a10f-a3e27110c1fb] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:45:37,778: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[e0c5c4b7-7873-4608-8184-ef5ab0da8c50] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:37,799: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x145"; args=None; alias=default
[2024-10-06 13:45:37,799: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x145"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT') LIMIT 1; args=(1, 1, 'RUNEUSDT'); alias=default
[2024-10-06 13:45:37,801: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT') LIMIT 1; args=(1, 1, 'RUNEUSDT'); alias=default
[2024-10-06 13:45:37,801: WARNING/ForkPoolWorker-15] No trades found for asset RUNEUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x145"; args=None; alias=default
[2024-10-06 13:45:37,801: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x145"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Buy'); alias=default
[2024-10-06 13:45:37,802: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Sell'); alias=default
[2024-10-06 13:45:37,803: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:37,803: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:37,803: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[e0c5c4b7-7873-4608-8184-ef5ab0da8c50] succeeded in 0.005493249002029188s: None
[2024-10-06 13:45:37,855: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[74c1a065-0b99-429a-a4ac-5763cd2536d3] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:37,876: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:45:37,878: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:37,878: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:37,882: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[74c1a065-0b99-429a-a4ac-5763cd2536d3] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:45:37,934: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[e6c41a25-50f5-4e87-ab2f-d3bbb71700f7] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:37,955: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x146"; args=None; alias=default
[2024-10-06 13:45:37,955: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x146"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:45:37,956: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:45:37,956: WARNING/ForkPoolWorker-15] No trades found for asset BTCUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x146"; args=None; alias=default
[2024-10-06 13:45:37,956: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x146"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
[2024-10-06 13:45:37,957: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
[2024-10-06 13:45:37,958: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:37,958: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:37,958: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[e6c41a25-50f5-4e87-ab2f-d3bbb71700f7] succeeded in 0.004179088995442726s: None
[2024-10-06 13:45:38,011: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[5cbd76ff-bcfe-4bee-9656-6513c7493722] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:38,032: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:45:38,080: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:38,081: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:38,088: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[5cbd76ff-bcfe-4bee-9656-6513c7493722] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:45:38,090: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[0f6e841b-fddc-4d73-94ad-007e9c6cad76] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:38,113: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x147"; args=None; alias=default
[2024-10-06 13:45:38,113: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x147"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:45:38,115: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:45:38,115: WARNING/ForkPoolWorker-15] No trades found for asset BTCUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x147"; args=None; alias=default
[2024-10-06 13:45:38,115: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x147"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
[2024-10-06 13:45:38,116: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
[2024-10-06 13:45:38,117: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:38,117: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:38,118: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[0f6e841b-fddc-4d73-94ad-007e9c6cad76] succeeded in 0.005838188997586258s: None
[2024-10-06 13:45:38,151: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[4b91a4c5-e73c-4a8d-9de8-3340aeae766c] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:38,191: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:45:38,193: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:38,193: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:38,197: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[4b91a4c5-e73c-4a8d-9de8-3340aeae766c] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:45:38,229: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[4c7b9fe6-9f83-45fc-beab-bc1676747603] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:38,270: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x148"; args=None; alias=default
[2024-10-06 13:45:38,270: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x148"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT') LIMIT 1; args=(1, 1, 'ARBUSDT'); alias=default
[2024-10-06 13:45:38,271: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT') LIMIT 1; args=(1, 1, 'ARBUSDT'); alias=default
[2024-10-06 13:45:38,271: WARNING/ForkPoolWorker-15] No trades found for asset ARBUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x148"; args=None; alias=default
[2024-10-06 13:45:38,272: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x148"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ARBUSDT', 'Buy'); alias=default
[2024-10-06 13:45:38,272: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ARBUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ARBUSDT', 'Sell'); alias=default
[2024-10-06 13:45:38,273: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ARBUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:38,273: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:38,274: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[4c7b9fe6-9f83-45fc-beab-bc1676747603] succeeded in 0.004346018999058288s: None
[2024-10-06 13:45:38,308: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[53f0f7e9-8958-42ab-ad6d-169ec34cb399] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:38,348: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:45:38,350: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:38,350: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:38,354: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[53f0f7e9-8958-42ab-ad6d-169ec34cb399] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:45:38,386: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[e34cd26e-3c98-4f8a-b49a-ab93128c5795] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:38,426: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x149"; args=None; alias=default
[2024-10-06 13:45:38,426: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x149"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT') LIMIT 1; args=(1, 1, 'BLURUSDT'); alias=default
[2024-10-06 13:45:38,427: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT') LIMIT 1; args=(1, 1, 'BLURUSDT'); alias=default
[2024-10-06 13:45:38,428: WARNING/ForkPoolWorker-15] No trades found for asset BLURUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x149"; args=None; alias=default
[2024-10-06 13:45:38,428: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x149"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Buy'); alias=default
[2024-10-06 13:45:38,429: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Sell'); alias=default
[2024-10-06 13:45:38,429: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:38,429: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:38,430: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[e34cd26e-3c98-4f8a-b49a-ab93128c5795] succeeded in 0.0041651700012153015s: None
[2024-10-06 13:45:38,464: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[662c814b-6a83-4233-a9ba-27fe906217ee] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:38,503: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:45:38,505: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:38,505: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:38,509: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[662c814b-6a83-4233-a9ba-27fe906217ee] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:45:38,541: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[0919e607-238a-46da-bdb1-f762796d2295] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:38,582: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x150"; args=None; alias=default
[2024-10-06 13:45:38,583: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x150"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT') LIMIT 1; args=(1, 1, 'BLURUSDT'); alias=default
[2024-10-06 13:45:38,584: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT') LIMIT 1; args=(1, 1, 'BLURUSDT'); alias=default
[2024-10-06 13:45:38,584: WARNING/ForkPoolWorker-15] No trades found for asset BLURUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x150"; args=None; alias=default
[2024-10-06 13:45:38,584: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x150"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Buy'); alias=default
[2024-10-06 13:45:38,585: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Sell'); alias=default
[2024-10-06 13:45:38,585: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:38,586: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:38,586: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[0919e607-238a-46da-bdb1-f762796d2295] succeeded in 0.003978720000304747s: None
[2024-10-06 13:45:38,620: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[4a4ec9c3-09be-42b6-89f0-78afefa51f93] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:38,660: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:45:38,662: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:38,662: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:38,666: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[4a4ec9c3-09be-42b6-89f0-78afefa51f93] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:45:38,698: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[247a832f-4c1e-4965-818e-ec095c20357d] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:38,758: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x151"; args=None; alias=default
[2024-10-06 13:45:38,758: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x151"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SOLUSDT') LIMIT 1; args=(1, 1, 'SOLUSDT'); alias=default
[2024-10-06 13:45:38,760: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SOLUSDT') LIMIT 1; args=(1, 1, 'SOLUSDT'); alias=default
[2024-10-06 13:45:38,760: WARNING/ForkPoolWorker-15] No trades found for asset SOLUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x151"; args=None; alias=default
[2024-10-06 13:45:38,760: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x151"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SOLUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'SOLUSDT', 'Buy'); alias=default
[2024-10-06 13:45:38,761: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SOLUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'SOLUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SOLUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'SOLUSDT', 'Sell'); alias=default
[2024-10-06 13:45:38,761: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SOLUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'SOLUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:38,761: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:38,762: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[247a832f-4c1e-4965-818e-ec095c20357d] succeeded in 0.0038356599980033934s: None
[2024-10-06 13:45:38,796: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[684ede80-1982-47bd-9a36-29d85dc0d306] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:38,835: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:45:38,836: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:38,837: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:38,840: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[684ede80-1982-47bd-9a36-29d85dc0d306] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:45:38,873: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[f4387880-4afa-4506-a867-d03b58e0c456] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:38,913: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x152"; args=None; alias=default
[2024-10-06 13:45:38,913: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x152"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT') LIMIT 1; args=(1, 1, 'BLURUSDT'); alias=default
[2024-10-06 13:45:38,915: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT') LIMIT 1; args=(1, 1, 'BLURUSDT'); alias=default
[2024-10-06 13:45:38,915: WARNING/ForkPoolWorker-15] No trades found for asset BLURUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x152"; args=None; alias=default
[2024-10-06 13:45:38,915: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x152"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Buy'); alias=default
[2024-10-06 13:45:38,916: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Sell'); alias=default
[2024-10-06 13:45:38,916: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:38,916: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:38,917: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[f4387880-4afa-4506-a867-d03b58e0c456] succeeded in 0.003919799994037021s: None
[2024-10-06 13:45:38,951: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[4e5f78ad-4c0a-4893-95a4-1cb0ec3b4c34] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:38,990: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:45:38,992: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:38,992: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:38,998: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[4e5f78ad-4c0a-4893-95a4-1cb0ec3b4c34] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:45:39,033: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[7afee3b9-ad6a-494c-a813-d84134161543] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:39,073: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x153"; args=None; alias=default
[2024-10-06 13:45:39,073: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x153"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT') LIMIT 1; args=(1, 1, 'RUNEUSDT'); alias=default
[2024-10-06 13:45:39,074: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT') LIMIT 1; args=(1, 1, 'RUNEUSDT'); alias=default
[2024-10-06 13:45:39,074: WARNING/ForkPoolWorker-15] No trades found for asset RUNEUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x153"; args=None; alias=default
[2024-10-06 13:45:39,074: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x153"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Buy'); alias=default
[2024-10-06 13:45:39,075: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Sell'); alias=default
[2024-10-06 13:45:39,076: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:39,076: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:39,076: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[7afee3b9-ad6a-494c-a813-d84134161543] succeeded in 0.003898700000718236s: None
[2024-10-06 13:45:39,111: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[0a350c5e-635a-493e-89d3-c158b18d7f46] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:39,151: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:45:39,152: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:39,153: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:39,156: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[0a350c5e-635a-493e-89d3-c158b18d7f46] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:45:39,189: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[6a274591-e258-49ed-853a-179682c07168] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:39,228: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x154"; args=None; alias=default
[2024-10-06 13:45:39,229: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x154"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 13:45:39,230: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 13:45:39,230: WARNING/ForkPoolWorker-15] No trades found for asset LDOUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x154"; args=None; alias=default
[2024-10-06 13:45:39,230: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x154"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
[2024-10-06 13:45:39,231: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
[2024-10-06 13:45:39,231: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:39,231: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:39,232: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[6a274591-e258-49ed-853a-179682c07168] succeeded in 0.0033251999993808568s: None
[2024-10-06 13:45:39,266: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[f7ae8ca7-a38f-47dd-b152-7953ac15c04b] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:39,306: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:45:39,307: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:39,307: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:39,311: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[f7ae8ca7-a38f-47dd-b152-7953ac15c04b] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:45:39,383: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[535e4c34-df24-4bba-b582-439372ad40f9] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:39,403: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x155"; args=None; alias=default
[2024-10-06 13:45:39,403: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x155"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 13:45:39,405: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 13:45:39,405: WARNING/ForkPoolWorker-15] No trades found for asset LDOUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x155"; args=None; alias=default
[2024-10-06 13:45:39,405: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x155"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
[2024-10-06 13:45:39,406: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
[2024-10-06 13:45:39,406: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:39,406: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:39,407: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[535e4c34-df24-4bba-b582-439372ad40f9] succeeded in 0.003844129001663532s: None
[2024-10-06 13:45:39,460: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[c958aa10-5bb8-49d1-8a20-5eefdde6af45] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:39,481: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:45:39,482: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:39,483: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:39,486: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[c958aa10-5bb8-49d1-8a20-5eefdde6af45] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:45:39,539: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[458bf9ae-6161-4011-98af-c980e6a732e7] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:39,559: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x156"; args=None; alias=default
[2024-10-06 13:45:39,559: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x156"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 13:45:39,560: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 13:45:39,561: WARNING/ForkPoolWorker-15] No trades found for asset LDOUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x156"; args=None; alias=default
[2024-10-06 13:45:39,561: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x156"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
[2024-10-06 13:45:39,561: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
[2024-10-06 13:45:39,562: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:39,562: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:39,562: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[458bf9ae-6161-4011-98af-c980e6a732e7] succeeded in 0.003717459003382828s: None
[2024-10-06 13:45:39,616: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[c08afe05-7aaa-4f70-bd19-a0981f73efea] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:39,637: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:45:39,639: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:39,639: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:39,643: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[c08afe05-7aaa-4f70-bd19-a0981f73efea] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:45:39,696: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[c604f0a2-11be-4da5-b815-bb9683463d37] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:39,716: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x157"; args=None; alias=default
[2024-10-06 13:45:39,717: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x157"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 13:45:39,718: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 13:45:39,718: WARNING/ForkPoolWorker-15] No trades found for asset LDOUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x157"; args=None; alias=default
[2024-10-06 13:45:39,718: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x157"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
[2024-10-06 13:45:39,719: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
[2024-10-06 13:45:39,720: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:39,720: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:39,720: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[c604f0a2-11be-4da5-b815-bb9683463d37] succeeded in 0.004167589999269694s: None
[2024-10-06 13:45:39,773: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[1e3e6050-6289-4faa-a43d-3890ba942490] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:39,794: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:45:39,795: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:39,795: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:39,799: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[1e3e6050-6289-4faa-a43d-3890ba942490] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:45:39,851: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[210269c7-528a-43d9-bef2-cb0dc19234b5] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:45:39,873: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x158"; args=None; alias=default
[2024-10-06 13:45:39,873: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x158"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT') LIMIT 1; args=(1, 1, 'RUNEUSDT'); alias=default
[2024-10-06 13:45:39,874: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT') LIMIT 1; args=(1, 1, 'RUNEUSDT'); alias=default
[2024-10-06 13:45:39,874: WARNING/ForkPoolWorker-15] No trades found for asset RUNEUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x158"; args=None; alias=default
[2024-10-06 13:45:39,874: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x158"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Buy'); alias=default
[2024-10-06 13:45:39,875: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Sell'); alias=default
[2024-10-06 13:45:39,876: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:39,876: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:45:39,876: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[210269c7-528a-43d9-bef2-cb0dc19234b5] succeeded in 0.003956300002755597s: None
[2024-10-06 13:49:42,415: INFO/MainProcess] Task upload_csv.tasks.process_csv_file_async[e4afd81b-d416-4880-9e12-dbf7c44b4502] received
(0.000) SELECT "auth_user"."id", "auth_user"."password", "auth_user"."last_login", "auth_user"."is_superuser", "auth_user"."username", "auth_user"."first_name", "auth_user"."last_name", "auth_user"."email", "auth_user"."is_staff", "auth_user"."is_active", "auth_user"."date_joined" FROM "auth_user" WHERE "auth_user"."id" = 1 LIMIT 21; args=(1,); alias=default
[2024-10-06 13:49:42,437: DEBUG/ForkPoolWorker-15] (0.000) SELECT "auth_user"."id", "auth_user"."password", "auth_user"."last_login", "auth_user"."is_superuser", "auth_user"."username", "auth_user"."first_name", "auth_user"."last_name", "auth_user"."email", "auth_user"."is_staff", "auth_user"."is_active", "auth_user"."date_joined" FROM "auth_user" WHERE "auth_user"."id" = 1 LIMIT 21; args=(1,); alias=default
(0.000) SELECT "upload_csv_filename"."id", "upload_csv_filename"."owner_id", "upload_csv_filename"."file_name", "upload_csv_filename"."trade_count" FROM "upload_csv_filename" WHERE "upload_csv_filename"."id" = 13 LIMIT 21; args=(13,); alias=default
[2024-10-06 13:49:42,438: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_filename"."id", "upload_csv_filename"."owner_id", "upload_csv_filename"."file_name", "upload_csv_filename"."trade_count" FROM "upload_csv_filename" WHERE "upload_csv_filename"."id" = 13 LIMIT 21; args=(13,); alias=default
[2024-10-06 13:49:42,438: ERROR/ForkPoolWorker-15] Error processing CSV file: FileName matching query does not exist.
[2024-10-06 13:49:42,438: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_csv_file_async[e4afd81b-d416-4880-9e12-dbf7c44b4502] succeeded in 0.00273596999613801s: None
[2024-10-06 13:56:23,127: INFO/MainProcess] Task upload_csv.tasks.process_csv_file_async[51ddffc4-0f3b-40cf-8023-e8e3b73a244d] received
(0.000) SELECT "auth_user"."id", "auth_user"."password", "auth_user"."last_login", "auth_user"."is_superuser", "auth_user"."username", "auth_user"."first_name", "auth_user"."last_name", "auth_user"."email", "auth_user"."is_staff", "auth_user"."is_active", "auth_user"."date_joined" FROM "auth_user" WHERE "auth_user"."id" = 1 LIMIT 21; args=(1,); alias=default
[2024-10-06 13:56:23,149: DEBUG/ForkPoolWorker-15] (0.000) SELECT "auth_user"."id", "auth_user"."password", "auth_user"."last_login", "auth_user"."is_superuser", "auth_user"."username", "auth_user"."first_name", "auth_user"."last_name", "auth_user"."email", "auth_user"."is_staff", "auth_user"."is_active", "auth_user"."date_joined" FROM "auth_user" WHERE "auth_user"."id" = 1 LIMIT 21; args=(1,); alias=default
(0.000) SELECT "upload_csv_filename"."id", "upload_csv_filename"."owner_id", "upload_csv_filename"."file_name", "upload_csv_filename"."trade_count" FROM "upload_csv_filename" WHERE "upload_csv_filename"."id" = 14 LIMIT 21; args=(14,); alias=default
[2024-10-06 13:56:23,150: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_filename"."id", "upload_csv_filename"."owner_id", "upload_csv_filename"."file_name", "upload_csv_filename"."trade_count" FROM "upload_csv_filename" WHERE "upload_csv_filename"."id" = 14 LIMIT 21; args=(14,); alias=default
[2024-10-06 13:56:23,150: ERROR/ForkPoolWorker-15] Error processing CSV file: FileName matching query does not exist.
[2024-10-06 13:56:23,151: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_csv_file_async[51ddffc4-0f3b-40cf-8023-e8e3b73a244d] succeeded in 0.002736119000473991s: None
[2024-10-06 13:57:47,685: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[d1f3e4c5-28b4-4607-bed8-1af4735c101f] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:57:47,708: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:57:47,709: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:57:47,710: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:57:47,716: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[d1f3e4c5-28b4-4607-bed8-1af4735c101f] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:59:28,240: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[8996af78-5ef6-4dc2-8c7f-3781d56090ff] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:28,261: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:59:28,263: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:28,263: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:28,267: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[8996af78-5ef6-4dc2-8c7f-3781d56090ff] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:59:52,337: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[bb0b9141-1a8d-48d1-9c5c-ba5e734a8da6] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:52,358: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:59:52,360: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:52,360: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:52,367: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[bb0b9141-1a8d-48d1-9c5c-ba5e734a8da6] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:59:52,416: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[e9db5a8e-8498-4a27-8915-9e5e4cddabe8] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:52,437: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:59:52,440: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:52,440: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:52,446: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[e9db5a8e-8498-4a27-8915-9e5e4cddabe8] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:59:52,496: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[ffc969ca-4565-43d3-a663-83f60b9fc12f] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:52,518: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x159"; args=None; alias=default
[2024-10-06 13:59:52,518: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x159"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT') LIMIT 1; args=(1, 1, 'ETHUSDT'); alias=default
[2024-10-06 13:59:52,519: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT') LIMIT 1; args=(1, 1, 'ETHUSDT'); alias=default
[2024-10-06 13:59:52,520: WARNING/ForkPoolWorker-15] No trades found for asset ETHUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x159"; args=None; alias=default
[2024-10-06 13:59:52,520: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x159"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Buy'); alias=default
[2024-10-06 13:59:52,521: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Sell'); alias=default
[2024-10-06 13:59:52,522: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:52,522: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:52,522: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[ffc969ca-4565-43d3-a663-83f60b9fc12f] succeeded in 0.005195329002162907s: None
[2024-10-06 13:59:52,576: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[9285257f-ce3f-43ba-a989-e3617e4e4a0c] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:52,597: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x160"; args=None; alias=default
[2024-10-06 13:59:52,598: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x160"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT') LIMIT 1; args=(1, 1, 'ETHUSDT'); alias=default
[2024-10-06 13:59:52,599: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT') LIMIT 1; args=(1, 1, 'ETHUSDT'); alias=default
[2024-10-06 13:59:52,599: WARNING/ForkPoolWorker-15] No trades found for asset ETHUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x160"; args=None; alias=default
[2024-10-06 13:59:52,599: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x160"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Buy'); alias=default
[2024-10-06 13:59:52,601: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Sell'); alias=default
[2024-10-06 13:59:52,601: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:52,602: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:52,602: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[9285257f-ce3f-43ba-a989-e3617e4e4a0c] succeeded in 0.005254969000816345s: None
[2024-10-06 13:59:52,656: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[76d3cdd9-4390-49bb-b09a-053272cac26f] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:52,677: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:59:52,679: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:52,680: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:52,686: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[76d3cdd9-4390-49bb-b09a-053272cac26f] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:59:52,736: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[531e7f30-043f-4983-b7b1-be3176cc3416] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:52,757: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x161"; args=None; alias=default
[2024-10-06 13:59:52,758: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x161"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 13:59:52,759: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 13:59:52,760: WARNING/ForkPoolWorker-15] No trades found for asset LDOUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x161"; args=None; alias=default
[2024-10-06 13:59:52,760: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x161"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
[2024-10-06 13:59:52,761: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
[2024-10-06 13:59:52,762: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:52,762: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:52,762: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[531e7f30-043f-4983-b7b1-be3176cc3416] succeeded in 0.005281499994453043s: None
[2024-10-06 13:59:52,815: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[920ba6e0-4607-4fec-8e1f-bada1d32877e] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:52,836: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:59:52,838: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:52,839: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:52,845: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[920ba6e0-4607-4fec-8e1f-bada1d32877e] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:59:52,895: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[dbf5b7ea-e86e-4b56-90aa-cbcec5ed102e] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:52,917: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x162"; args=None; alias=default
[2024-10-06 13:59:52,917: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x162"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT') LIMIT 1; args=(1, 1, 'RUNEUSDT'); alias=default
[2024-10-06 13:59:52,919: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT') LIMIT 1; args=(1, 1, 'RUNEUSDT'); alias=default
[2024-10-06 13:59:52,919: WARNING/ForkPoolWorker-15] No trades found for asset RUNEUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x162"; args=None; alias=default
[2024-10-06 13:59:52,919: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x162"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Buy'); alias=default
[2024-10-06 13:59:52,920: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Sell'); alias=default
[2024-10-06 13:59:52,921: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:52,922: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:52,922: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[dbf5b7ea-e86e-4b56-90aa-cbcec5ed102e] succeeded in 0.005373639003664721s: None
[2024-10-06 13:59:52,975: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[3183884a-dca3-4778-9a01-925d203bf31a] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:52,997: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:59:52,999: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:53,000: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:53,006: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[3183884a-dca3-4778-9a01-925d203bf31a] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:59:53,056: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[f18c7433-3431-48cd-9f32-7b107a2f974e] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:53,078: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x163"; args=None; alias=default
[2024-10-06 13:59:53,078: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x163"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'NEARUSDT') LIMIT 1; args=(1, 1, 'NEARUSDT'); alias=default
[2024-10-06 13:59:53,080: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'NEARUSDT') LIMIT 1; args=(1, 1, 'NEARUSDT'); alias=default
[2024-10-06 13:59:53,080: WARNING/ForkPoolWorker-15] No trades found for asset NEARUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x163"; args=None; alias=default
[2024-10-06 13:59:53,080: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x163"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'NEARUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'NEARUSDT', 'Buy'); alias=default
[2024-10-06 13:59:53,081: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'NEARUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'NEARUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'NEARUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'NEARUSDT', 'Sell'); alias=default
[2024-10-06 13:59:53,082: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'NEARUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'NEARUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:53,082: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:53,082: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[f18c7433-3431-48cd-9f32-7b107a2f974e] succeeded in 0.005245100001047831s: None
[2024-10-06 13:59:53,136: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[d63055a4-994c-4fc6-af26-69b50a7fdf32] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:53,157: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:59:53,160: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:53,160: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:53,166: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[d63055a4-994c-4fc6-af26-69b50a7fdf32] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:59:53,217: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[88eeb0c6-8f17-43cf-afe3-df4e50dca3ab] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:53,238: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x164"; args=None; alias=default
[2024-10-06 13:59:53,239: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x164"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'NEARUSDT') LIMIT 1; args=(1, 1, 'NEARUSDT'); alias=default
[2024-10-06 13:59:53,240: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'NEARUSDT') LIMIT 1; args=(1, 1, 'NEARUSDT'); alias=default
[2024-10-06 13:59:53,241: WARNING/ForkPoolWorker-15] No trades found for asset NEARUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x164"; args=None; alias=default
[2024-10-06 13:59:53,241: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x164"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'NEARUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'NEARUSDT', 'Buy'); alias=default
[2024-10-06 13:59:53,242: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'NEARUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'NEARUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'NEARUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'NEARUSDT', 'Sell'); alias=default
[2024-10-06 13:59:53,243: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'NEARUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'NEARUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:53,243: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:53,243: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[88eeb0c6-8f17-43cf-afe3-df4e50dca3ab] succeeded in 0.005346689002180938s: None
[2024-10-06 13:59:53,296: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[4deb5627-fbbe-491b-baa1-37de52c327b8] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:53,318: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:59:53,320: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:53,321: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:53,327: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[4deb5627-fbbe-491b-baa1-37de52c327b8] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:59:53,377: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[592533ac-1b40-442e-99bb-53759e405d4e] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:53,399: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x165"; args=None; alias=default
[2024-10-06 13:59:53,399: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x165"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT') LIMIT 1; args=(1, 1, 'RUNEUSDT'); alias=default
[2024-10-06 13:59:53,401: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT') LIMIT 1; args=(1, 1, 'RUNEUSDT'); alias=default
[2024-10-06 13:59:53,401: WARNING/ForkPoolWorker-15] No trades found for asset RUNEUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x165"; args=None; alias=default
[2024-10-06 13:59:53,402: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x165"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Buy'); alias=default
[2024-10-06 13:59:53,403: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Sell'); alias=default
[2024-10-06 13:59:53,404: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:53,404: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:53,404: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[592533ac-1b40-442e-99bb-53759e405d4e] succeeded in 0.005597369003226049s: None
[2024-10-06 13:59:53,457: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[c98caa36-fb36-4a4e-93bb-c435c8c84845] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:53,478: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:59:53,481: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:53,481: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:53,488: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[c98caa36-fb36-4a4e-93bb-c435c8c84845] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:59:53,538: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[5f53f438-a1b4-4af8-9a51-335010b6f93b] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:53,560: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x166"; args=None; alias=default
[2024-10-06 13:59:53,560: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x166"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 13:59:53,562: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 13:59:53,562: WARNING/ForkPoolWorker-15] No trades found for asset LDOUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x166"; args=None; alias=default
[2024-10-06 13:59:53,562: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x166"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
[2024-10-06 13:59:53,563: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
[2024-10-06 13:59:53,564: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:53,565: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:53,565: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[5f53f438-a1b4-4af8-9a51-335010b6f93b] succeeded in 0.005972119004582055s: None
[2024-10-06 13:59:53,618: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[5b41329b-599e-42de-a7c1-47823d23986f] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:53,640: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:59:53,642: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:53,643: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:53,653: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[5b41329b-599e-42de-a7c1-47823d23986f] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:59:53,699: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[05f06020-931e-4a21-82d2-7571c55f0364] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:53,720: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x167"; args=None; alias=default
[2024-10-06 13:59:53,721: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x167"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'INJUSDT') LIMIT 1; args=(1, 1, 'INJUSDT'); alias=default
[2024-10-06 13:59:53,723: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'INJUSDT') LIMIT 1; args=(1, 1, 'INJUSDT'); alias=default
[2024-10-06 13:59:53,723: WARNING/ForkPoolWorker-15] No trades found for asset INJUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x167"; args=None; alias=default
[2024-10-06 13:59:53,723: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x167"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'INJUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'INJUSDT', 'Buy'); alias=default
[2024-10-06 13:59:53,724: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'INJUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'INJUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'INJUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'INJUSDT', 'Sell'); alias=default
[2024-10-06 13:59:53,725: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'INJUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'INJUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:53,725: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:53,726: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[05f06020-931e-4a21-82d2-7571c55f0364] succeeded in 0.005801318999147043s: None
[2024-10-06 13:59:53,778: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[e7a125ae-0097-4bcf-9e3a-f17bfe34b07e] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:53,819: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:59:53,821: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:53,822: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:53,828: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[e7a125ae-0097-4bcf-9e3a-f17bfe34b07e] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:59:53,878: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[e8a11297-3cb8-45ab-9abc-189517c26028] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:53,899: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x168"; args=None; alias=default
[2024-10-06 13:59:53,900: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x168"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT') LIMIT 1; args=(1, 1, 'RUNEUSDT'); alias=default
[2024-10-06 13:59:53,901: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT') LIMIT 1; args=(1, 1, 'RUNEUSDT'); alias=default
[2024-10-06 13:59:53,902: WARNING/ForkPoolWorker-15] No trades found for asset RUNEUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x168"; args=None; alias=default
[2024-10-06 13:59:53,902: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x168"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Buy'); alias=default
[2024-10-06 13:59:53,903: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Sell'); alias=default
[2024-10-06 13:59:53,904: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:53,904: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:53,904: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[e8a11297-3cb8-45ab-9abc-189517c26028] succeeded in 0.005408828998042736s: None
[2024-10-06 13:59:53,957: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[fd2bf8b5-1418-4405-982b-80d52d541be3] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:53,979: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:59:53,981: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:53,981: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:53,988: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[fd2bf8b5-1418-4405-982b-80d52d541be3] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:59:54,037: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[c7276adb-f83d-4743-964e-f16157f4c4e5] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:54,059: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x169"; args=None; alias=default
[2024-10-06 13:59:54,059: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x169"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 13:59:54,061: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 13:59:54,061: WARNING/ForkPoolWorker-15] No trades found for asset LDOUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x169"; args=None; alias=default
[2024-10-06 13:59:54,061: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x169"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
[2024-10-06 13:59:54,062: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
[2024-10-06 13:59:54,063: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:54,063: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:54,064: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[c7276adb-f83d-4743-964e-f16157f4c4e5] succeeded in 0.005411950005509425s: None
[2024-10-06 13:59:54,117: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[8d43be89-3722-4281-8f8b-6389dcdec141] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:54,138: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:59:54,140: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:54,141: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:54,147: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[8d43be89-3722-4281-8f8b-6389dcdec141] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:59:54,196: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[53d82c52-4a96-47c5-81cb-fa72b24f8750] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:54,217: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x170"; args=None; alias=default
[2024-10-06 13:59:54,218: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x170"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'WIFUSDT') LIMIT 1; args=(1, 1, 'WIFUSDT'); alias=default
[2024-10-06 13:59:54,219: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'WIFUSDT') LIMIT 1; args=(1, 1, 'WIFUSDT'); alias=default
[2024-10-06 13:59:54,220: WARNING/ForkPoolWorker-15] No trades found for asset WIFUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x170"; args=None; alias=default
[2024-10-06 13:59:54,220: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x170"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'WIFUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'WIFUSDT', 'Buy'); alias=default
[2024-10-06 13:59:54,221: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'WIFUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'WIFUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'WIFUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'WIFUSDT', 'Sell'); alias=default
[2024-10-06 13:59:54,222: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'WIFUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'WIFUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:54,222: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:54,222: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[53d82c52-4a96-47c5-81cb-fa72b24f8750] succeeded in 0.0055521989997942s: None
[2024-10-06 13:59:54,275: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[b1649de1-c9e6-4935-a3ba-9c589f5db30d] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:54,297: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:59:54,299: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:54,299: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:54,306: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[b1649de1-c9e6-4935-a3ba-9c589f5db30d] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:59:54,356: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[15196a59-cf7a-410b-983e-337d988bf6cd] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:54,377: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:59:54,379: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:54,380: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:54,386: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[15196a59-cf7a-410b-983e-337d988bf6cd] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:59:54,436: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[0a869d33-294d-457f-b2db-777f6b2e1b44] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:54,458: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x171"; args=None; alias=default
[2024-10-06 13:59:54,459: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x171"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT') LIMIT 1; args=(1, 1, 'ARBUSDT'); alias=default
[2024-10-06 13:59:54,460: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT') LIMIT 1; args=(1, 1, 'ARBUSDT'); alias=default
[2024-10-06 13:59:54,461: WARNING/ForkPoolWorker-15] No trades found for asset ARBUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x171"; args=None; alias=default
[2024-10-06 13:59:54,461: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x171"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ARBUSDT', 'Buy'); alias=default
[2024-10-06 13:59:54,462: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ARBUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ARBUSDT', 'Sell'); alias=default
[2024-10-06 13:59:54,463: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ARBUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:54,463: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:54,463: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[0a869d33-294d-457f-b2db-777f6b2e1b44] succeeded in 0.00559639999846695s: None
[2024-10-06 13:59:54,516: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[b3127f25-6cac-406c-942a-52d16cfa9648] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:54,538: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:59:54,540: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:54,540: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:54,547: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[b3127f25-6cac-406c-942a-52d16cfa9648] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:59:54,597: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[b56c8d78-2b65-4384-9ba8-13e4699cfc39] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:54,618: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x172"; args=None; alias=default
[2024-10-06 13:59:54,619: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x172"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SEIUSDT') LIMIT 1; args=(1, 1, 'SEIUSDT'); alias=default
[2024-10-06 13:59:54,620: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SEIUSDT') LIMIT 1; args=(1, 1, 'SEIUSDT'); alias=default
[2024-10-06 13:59:54,621: WARNING/ForkPoolWorker-15] No trades found for asset SEIUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x172"; args=None; alias=default
[2024-10-06 13:59:54,621: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x172"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SEIUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'SEIUSDT', 'Buy'); alias=default
[2024-10-06 13:59:54,622: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SEIUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'SEIUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SEIUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'SEIUSDT', 'Sell'); alias=default
[2024-10-06 13:59:54,623: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SEIUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'SEIUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:54,623: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:54,623: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[b56c8d78-2b65-4384-9ba8-13e4699cfc39] succeeded in 0.005608709005173296s: None
[2024-10-06 13:59:54,676: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[42461c5f-3727-45fc-91a3-d7258f9cda35] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:54,698: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:59:54,700: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:54,700: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:54,706: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[42461c5f-3727-45fc-91a3-d7258f9cda35] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:59:54,757: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[2b9397ff-33bd-41f6-9d8f-dfb7678e63c1] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:54,778: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x173"; args=None; alias=default
[2024-10-06 13:59:54,778: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x173"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'INJUSDT') LIMIT 1; args=(1, 1, 'INJUSDT'); alias=default
[2024-10-06 13:59:54,780: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'INJUSDT') LIMIT 1; args=(1, 1, 'INJUSDT'); alias=default
[2024-10-06 13:59:54,780: WARNING/ForkPoolWorker-15] No trades found for asset INJUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x173"; args=None; alias=default
[2024-10-06 13:59:54,780: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x173"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'INJUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'INJUSDT', 'Buy'); alias=default
[2024-10-06 13:59:54,781: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'INJUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'INJUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'INJUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'INJUSDT', 'Sell'); alias=default
[2024-10-06 13:59:54,782: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'INJUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'INJUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:54,782: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:54,782: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[2b9397ff-33bd-41f6-9d8f-dfb7678e63c1] succeeded in 0.0049167800025315955s: None
[2024-10-06 13:59:54,836: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[992c2825-37cd-4fc7-9078-a61d09e41202] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:54,858: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:59:54,860: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:54,861: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:54,867: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[992c2825-37cd-4fc7-9078-a61d09e41202] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:59:54,917: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[29820eb3-6b62-41c0-9afa-6c432e5bd778] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:54,938: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x174"; args=None; alias=default
[2024-10-06 13:59:54,939: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x174"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'INJUSDT') LIMIT 1; args=(1, 1, 'INJUSDT'); alias=default
[2024-10-06 13:59:54,940: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'INJUSDT') LIMIT 1; args=(1, 1, 'INJUSDT'); alias=default
[2024-10-06 13:59:54,941: WARNING/ForkPoolWorker-15] No trades found for asset INJUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x174"; args=None; alias=default
[2024-10-06 13:59:54,941: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x174"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'INJUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'INJUSDT', 'Buy'); alias=default
[2024-10-06 13:59:54,942: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'INJUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'INJUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'INJUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'INJUSDT', 'Sell'); alias=default
[2024-10-06 13:59:54,942: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'INJUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'INJUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:54,943: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:54,943: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[29820eb3-6b62-41c0-9afa-6c432e5bd778] succeeded in 0.004937398996844422s: None
[2024-10-06 13:59:54,997: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[cdf05454-ca46-4815-b5cb-e5e2bb14a9dd] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:55,018: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:59:55,020: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:55,021: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:55,027: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[cdf05454-ca46-4815-b5cb-e5e2bb14a9dd] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:59:55,077: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[ab28caf7-028f-4ab7-9e49-971ebf8a241d] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:55,099: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x175"; args=None; alias=default
[2024-10-06 13:59:55,099: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x175"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 13:59:55,101: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 13:59:55,101: WARNING/ForkPoolWorker-15] No trades found for asset LDOUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x175"; args=None; alias=default
[2024-10-06 13:59:55,101: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x175"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
[2024-10-06 13:59:55,102: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
[2024-10-06 13:59:55,103: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:55,103: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:55,104: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[ab28caf7-028f-4ab7-9e49-971ebf8a241d] succeeded in 0.005325600002834108s: None
[2024-10-06 13:59:55,157: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[59ab6075-b599-4746-adf3-997e02e30305] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:55,178: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:59:55,180: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:55,180: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:55,184: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[59ab6075-b599-4746-adf3-997e02e30305] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:59:55,238: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[528463dc-cd47-4f0d-b12f-5d7581f56e5e] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:55,259: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x176"; args=None; alias=default
[2024-10-06 13:59:55,259: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x176"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 13:59:55,260: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 13:59:55,260: WARNING/ForkPoolWorker-15] No trades found for asset LDOUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x176"; args=None; alias=default
[2024-10-06 13:59:55,260: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x176"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
[2024-10-06 13:59:55,261: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
[2024-10-06 13:59:55,262: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:55,262: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:55,262: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[528463dc-cd47-4f0d-b12f-5d7581f56e5e] succeeded in 0.003976969004725106s: None
[2024-10-06 13:59:55,317: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[52582e83-2a27-4cc3-9c24-822141c09711] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:55,338: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:59:55,340: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:55,340: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:55,347: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[52582e83-2a27-4cc3-9c24-822141c09711] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:59:55,397: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[ca59e2e1-acb7-4491-9bc3-8442f0a23bcd] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:55,418: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x177"; args=None; alias=default
[2024-10-06 13:59:55,419: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x177"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 13:59:55,420: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 13:59:55,420: WARNING/ForkPoolWorker-15] No trades found for asset LDOUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x177"; args=None; alias=default
[2024-10-06 13:59:55,421: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x177"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
[2024-10-06 13:59:55,422: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
[2024-10-06 13:59:55,422: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:55,423: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:55,423: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[ca59e2e1-acb7-4491-9bc3-8442f0a23bcd] succeeded in 0.0050701400032266974s: None
[2024-10-06 13:59:55,476: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[7c8db76c-8721-474e-acef-bce11b674bc4] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:55,498: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:59:55,500: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:55,501: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:55,507: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[7c8db76c-8721-474e-acef-bce11b674bc4] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:59:55,557: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[feb63ad6-fefb-4eed-8715-49dda1b936d7] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:55,579: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x178"; args=None; alias=default
[2024-10-06 13:59:55,579: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x178"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SEIUSDT') LIMIT 1; args=(1, 1, 'SEIUSDT'); alias=default
[2024-10-06 13:59:55,581: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SEIUSDT') LIMIT 1; args=(1, 1, 'SEIUSDT'); alias=default
[2024-10-06 13:59:55,581: WARNING/ForkPoolWorker-15] No trades found for asset SEIUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x178"; args=None; alias=default
[2024-10-06 13:59:55,581: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x178"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SEIUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'SEIUSDT', 'Buy'); alias=default
[2024-10-06 13:59:55,582: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SEIUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'SEIUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SEIUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'SEIUSDT', 'Sell'); alias=default
[2024-10-06 13:59:55,583: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SEIUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'SEIUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:55,583: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:55,583: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[feb63ad6-fefb-4eed-8715-49dda1b936d7] succeeded in 0.005356679001124576s: None
[2024-10-06 13:59:55,637: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[aac8fc08-b88c-4cfb-8918-6513758fb24c] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:55,659: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:59:55,661: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:55,661: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:55,667: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[aac8fc08-b88c-4cfb-8918-6513758fb24c] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:59:55,718: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[0720d3e4-8ca4-421e-97b6-8172acb96360] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:55,738: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x179"; args=None; alias=default
[2024-10-06 13:59:55,739: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x179"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT') LIMIT 1; args=(1, 1, 'BLURUSDT'); alias=default
[2024-10-06 13:59:55,740: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT') LIMIT 1; args=(1, 1, 'BLURUSDT'); alias=default
[2024-10-06 13:59:55,740: WARNING/ForkPoolWorker-15] No trades found for asset BLURUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x179"; args=None; alias=default
[2024-10-06 13:59:55,740: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x179"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Buy'); alias=default
[2024-10-06 13:59:55,741: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Sell'); alias=default
[2024-10-06 13:59:55,742: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:55,742: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:55,742: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[0720d3e4-8ca4-421e-97b6-8172acb96360] succeeded in 0.004064979999384377s: None
[2024-10-06 13:59:55,796: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[859009a2-78db-4f3d-950f-e9a2c4e2c9f5] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:55,817: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:59:55,819: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:55,819: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:55,825: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[859009a2-78db-4f3d-950f-e9a2c4e2c9f5] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:59:55,896: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[65679666-1c31-4463-87f8-8c8127be9f7f] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:55,917: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x180"; args=None; alias=default
[2024-10-06 13:59:55,917: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x180"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 13:59:55,919: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 13:59:55,919: WARNING/ForkPoolWorker-15] No trades found for asset LDOUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x180"; args=None; alias=default
[2024-10-06 13:59:55,919: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x180"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
[2024-10-06 13:59:55,920: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
[2024-10-06 13:59:55,921: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:55,921: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:55,921: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[65679666-1c31-4463-87f8-8c8127be9f7f] succeeded in 0.004938569007208571s: None
[2024-10-06 13:59:55,974: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[61853f3a-3cf0-4a86-9703-55dc63bd0327] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:55,996: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:59:55,998: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:55,998: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:56,004: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[61853f3a-3cf0-4a86-9703-55dc63bd0327] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:59:56,054: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[5391a6fb-7283-4540-be2f-f967e76eba0f] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:56,075: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x181"; args=None; alias=default
[2024-10-06 13:59:56,075: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x181"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT') LIMIT 1; args=(1, 1, 'RUNEUSDT'); alias=default
[2024-10-06 13:59:56,077: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT') LIMIT 1; args=(1, 1, 'RUNEUSDT'); alias=default
[2024-10-06 13:59:56,077: WARNING/ForkPoolWorker-15] No trades found for asset RUNEUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x181"; args=None; alias=default
[2024-10-06 13:59:56,077: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x181"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Buy'); alias=default
[2024-10-06 13:59:56,078: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Sell'); alias=default
[2024-10-06 13:59:56,079: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:56,079: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:56,079: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[5391a6fb-7283-4540-be2f-f967e76eba0f] succeeded in 0.004927338995912578s: None
[2024-10-06 13:59:56,133: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[1a4de232-4e49-4315-a362-33bafac87fbb] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:56,154: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:59:56,156: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:56,156: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:56,163: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[1a4de232-4e49-4315-a362-33bafac87fbb] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:59:56,212: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[417f9b36-e05d-4824-a801-6925c84770b2] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:56,233: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x182"; args=None; alias=default
[2024-10-06 13:59:56,234: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x182"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT') LIMIT 1; args=(1, 1, 'RUNEUSDT'); alias=default
[2024-10-06 13:59:56,235: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT') LIMIT 1; args=(1, 1, 'RUNEUSDT'); alias=default
[2024-10-06 13:59:56,235: WARNING/ForkPoolWorker-15] No trades found for asset RUNEUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x182"; args=None; alias=default
[2024-10-06 13:59:56,235: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x182"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Buy'); alias=default
[2024-10-06 13:59:56,237: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Sell'); alias=default
[2024-10-06 13:59:56,237: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:56,238: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:56,238: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[417f9b36-e05d-4824-a801-6925c84770b2] succeeded in 0.004986469997675158s: None
[2024-10-06 13:59:56,291: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[f38c41c7-08fe-4483-9178-bd0694fa2b40] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:56,312: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:59:56,314: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:56,314: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:56,318: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[f38c41c7-08fe-4483-9178-bd0694fa2b40] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:59:56,370: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[0e10113a-5b65-4b70-8a77-3b529906db6b] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:56,391: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x183"; args=None; alias=default
[2024-10-06 13:59:56,392: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x183"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 13:59:56,393: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 13:59:56,393: WARNING/ForkPoolWorker-15] No trades found for asset LDOUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x183"; args=None; alias=default
[2024-10-06 13:59:56,393: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x183"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
[2024-10-06 13:59:56,394: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
[2024-10-06 13:59:56,395: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:56,395: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:56,395: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[0e10113a-5b65-4b70-8a77-3b529906db6b] succeeded in 0.00424590000329772s: None
[2024-10-06 13:59:56,449: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[f2898991-bde1-44cc-822b-1e9f408f4cf8] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:56,469: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:59:56,471: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:56,471: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:56,476: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[f2898991-bde1-44cc-822b-1e9f408f4cf8] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:59:56,528: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[295335d6-e64d-489e-9a1c-c9db450129fb] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:56,548: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x184"; args=None; alias=default
[2024-10-06 13:59:56,549: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x184"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'NEARUSDT') LIMIT 1; args=(1, 1, 'NEARUSDT'); alias=default
[2024-10-06 13:59:56,550: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'NEARUSDT') LIMIT 1; args=(1, 1, 'NEARUSDT'); alias=default
[2024-10-06 13:59:56,550: WARNING/ForkPoolWorker-15] No trades found for asset NEARUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x184"; args=None; alias=default
[2024-10-06 13:59:56,550: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x184"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'NEARUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'NEARUSDT', 'Buy'); alias=default
[2024-10-06 13:59:56,551: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'NEARUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'NEARUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'NEARUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'NEARUSDT', 'Sell'); alias=default
[2024-10-06 13:59:56,552: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'NEARUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'NEARUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:56,552: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:56,552: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[295335d6-e64d-489e-9a1c-c9db450129fb] succeeded in 0.003994780003267806s: None
[2024-10-06 13:59:56,606: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[032db919-c3d0-4109-911b-003845c40eb8] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:56,626: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:59:56,627: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:56,628: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:56,631: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[032db919-c3d0-4109-911b-003845c40eb8] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:59:56,684: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[039a5f28-0c72-4859-95d0-6d85f5964fb0] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:56,705: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x185"; args=None; alias=default
[2024-10-06 13:59:56,705: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x185"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SEIUSDT') LIMIT 1; args=(1, 1, 'SEIUSDT'); alias=default
[2024-10-06 13:59:56,707: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SEIUSDT') LIMIT 1; args=(1, 1, 'SEIUSDT'); alias=default
[2024-10-06 13:59:56,707: WARNING/ForkPoolWorker-15] No trades found for asset SEIUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x185"; args=None; alias=default
[2024-10-06 13:59:56,707: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x185"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SEIUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'SEIUSDT', 'Buy'); alias=default
[2024-10-06 13:59:56,708: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SEIUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'SEIUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SEIUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'SEIUSDT', 'Sell'); alias=default
[2024-10-06 13:59:56,708: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SEIUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'SEIUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:56,709: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:56,709: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[039a5f28-0c72-4859-95d0-6d85f5964fb0] succeeded in 0.0040629899958730675s: None
[2024-10-06 13:59:56,763: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[5ab82a19-c892-4e56-865e-da4716f1c52a] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:56,784: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x186"; args=None; alias=default
[2024-10-06 13:59:56,784: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x186"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:59:56,785: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:59:56,785: WARNING/ForkPoolWorker-15] No trades found for asset BTCUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x186"; args=None; alias=default
[2024-10-06 13:59:56,785: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x186"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
[2024-10-06 13:59:56,786: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
[2024-10-06 13:59:56,787: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:56,787: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:56,787: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[5ab82a19-c892-4e56-865e-da4716f1c52a] succeeded in 0.003786369001318235s: None
[2024-10-06 13:59:56,843: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[9df04b38-903f-49c1-bd44-e02408e1e826] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:56,863: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:59:56,865: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:56,865: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:56,869: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[9df04b38-903f-49c1-bd44-e02408e1e826] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:59:56,922: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[bfb8cb66-b648-40dc-a0a4-fdfe60c487da] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:56,943: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x187"; args=None; alias=default
[2024-10-06 13:59:56,943: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x187"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'WIFUSDT') LIMIT 1; args=(1, 1, 'WIFUSDT'); alias=default
[2024-10-06 13:59:56,944: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'WIFUSDT') LIMIT 1; args=(1, 1, 'WIFUSDT'); alias=default
[2024-10-06 13:59:56,944: WARNING/ForkPoolWorker-15] No trades found for asset WIFUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x187"; args=None; alias=default
[2024-10-06 13:59:56,944: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x187"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'WIFUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'WIFUSDT', 'Buy'); alias=default
[2024-10-06 13:59:56,945: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'WIFUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'WIFUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'WIFUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'WIFUSDT', 'Sell'); alias=default
[2024-10-06 13:59:56,946: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'WIFUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'WIFUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:56,946: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:56,946: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[bfb8cb66-b648-40dc-a0a4-fdfe60c487da] succeeded in 0.0036570500014931895s: None
[2024-10-06 13:59:57,000: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[8e4190d7-72fc-4996-8278-1ac8514160fc] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:57,020: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:59:57,022: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:57,022: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:57,025: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[8e4190d7-72fc-4996-8278-1ac8514160fc] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:59:57,078: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[f2c51b81-7ca1-48a2-9552-bc43ee29358d] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:57,098: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x188"; args=None; alias=default
[2024-10-06 13:59:57,099: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x188"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:59:57,100: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:59:57,100: WARNING/ForkPoolWorker-15] No trades found for asset BTCUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x188"; args=None; alias=default
[2024-10-06 13:59:57,100: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x188"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
[2024-10-06 13:59:57,101: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
[2024-10-06 13:59:57,101: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:57,101: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:57,102: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[f2c51b81-7ca1-48a2-9552-bc43ee29358d] succeeded in 0.0036984589969506487s: None
[2024-10-06 13:59:57,155: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[ae0fad73-ce0a-4022-9953-81a06c07be39] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:57,176: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:59:57,178: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:57,178: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:57,182: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[ae0fad73-ce0a-4022-9953-81a06c07be39] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:59:57,234: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[1fc0ae34-01fa-4335-b309-c3145cdc8b17] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:57,255: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x189"; args=None; alias=default
[2024-10-06 13:59:57,255: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x189"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:59:57,256: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:59:57,256: WARNING/ForkPoolWorker-15] No trades found for asset BTCUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x189"; args=None; alias=default
[2024-10-06 13:59:57,256: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x189"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
[2024-10-06 13:59:57,257: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
[2024-10-06 13:59:57,258: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:57,258: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:57,258: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[1fc0ae34-01fa-4335-b309-c3145cdc8b17] succeeded in 0.003940000002330635s: None
[2024-10-06 13:59:57,312: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[a22f16c6-aad3-4ac4-9d04-d09608d50727] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:57,332: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:59:57,333: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:57,334: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:57,337: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[a22f16c6-aad3-4ac4-9d04-d09608d50727] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:59:57,390: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[4de9b845-3089-415a-801a-2f9c2fe16911] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:57,411: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x190"; args=None; alias=default
[2024-10-06 13:59:57,411: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x190"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'MATICUSDT') LIMIT 1; args=(1, 1, 'MATICUSDT'); alias=default
[2024-10-06 13:59:57,413: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'MATICUSDT') LIMIT 1; args=(1, 1, 'MATICUSDT'); alias=default
[2024-10-06 13:59:57,413: WARNING/ForkPoolWorker-15] No trades found for asset MATICUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x190"; args=None; alias=default
[2024-10-06 13:59:57,413: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x190"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'MATICUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'MATICUSDT', 'Buy'); alias=default
[2024-10-06 13:59:57,414: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'MATICUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'MATICUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'MATICUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'MATICUSDT', 'Sell'); alias=default
[2024-10-06 13:59:57,414: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'MATICUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'MATICUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:57,414: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:57,414: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[4de9b845-3089-415a-801a-2f9c2fe16911] succeeded in 0.0038965000057942234s: None
[2024-10-06 13:59:57,468: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[9b9dc26e-3f93-47db-8d8c-e836adc486b3] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:57,489: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:59:57,490: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:57,490: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:57,496: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[9b9dc26e-3f93-47db-8d8c-e836adc486b3] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:59:57,546: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[b596d410-9e56-429b-a777-840fb2103caf] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:57,567: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x191"; args=None; alias=default
[2024-10-06 13:59:57,567: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x191"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'MATICUSDT') LIMIT 1; args=(1, 1, 'MATICUSDT'); alias=default
[2024-10-06 13:59:57,568: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'MATICUSDT') LIMIT 1; args=(1, 1, 'MATICUSDT'); alias=default
[2024-10-06 13:59:57,568: WARNING/ForkPoolWorker-15] No trades found for asset MATICUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x191"; args=None; alias=default
[2024-10-06 13:59:57,568: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x191"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'MATICUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'MATICUSDT', 'Buy'); alias=default
[2024-10-06 13:59:57,569: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'MATICUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'MATICUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'MATICUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'MATICUSDT', 'Sell'); alias=default
[2024-10-06 13:59:57,570: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'MATICUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'MATICUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:57,570: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:57,570: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[b596d410-9e56-429b-a777-840fb2103caf] succeeded in 0.003999630003818311s: None
[2024-10-06 13:59:57,624: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[4a2dd314-4350-4905-a683-51a0c711e414] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:57,644: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:59:57,646: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:57,646: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:57,650: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[4a2dd314-4350-4905-a683-51a0c711e414] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:59:57,702: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[114a904e-bf6e-41a1-95ed-cefb43bddc9c] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:57,723: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x192"; args=None; alias=default
[2024-10-06 13:59:57,723: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x192"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'WIFUSDT') LIMIT 1; args=(1, 1, 'WIFUSDT'); alias=default
[2024-10-06 13:59:57,724: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'WIFUSDT') LIMIT 1; args=(1, 1, 'WIFUSDT'); alias=default
[2024-10-06 13:59:57,724: WARNING/ForkPoolWorker-15] No trades found for asset WIFUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x192"; args=None; alias=default
[2024-10-06 13:59:57,724: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x192"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'WIFUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'WIFUSDT', 'Buy'); alias=default
[2024-10-06 13:59:57,725: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'WIFUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'WIFUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'WIFUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'WIFUSDT', 'Sell'); alias=default
[2024-10-06 13:59:57,726: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'WIFUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'WIFUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:57,726: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:57,726: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[114a904e-bf6e-41a1-95ed-cefb43bddc9c] succeeded in 0.0039041089985403232s: None
[2024-10-06 13:59:57,780: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[a10094a0-e13a-4c8f-a09a-92b2bf1a87aa] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:57,800: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:59:57,802: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:57,802: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:57,806: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[a10094a0-e13a-4c8f-a09a-92b2bf1a87aa] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:59:57,858: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[872ba4ce-6a25-460d-9341-9912cc40f2fc] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:57,898: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x193"; args=None; alias=default
[2024-10-06 13:59:57,898: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x193"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:59:57,899: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:59:57,899: WARNING/ForkPoolWorker-15] No trades found for asset BTCUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x193"; args=None; alias=default
[2024-10-06 13:59:57,899: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x193"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
[2024-10-06 13:59:57,900: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
[2024-10-06 13:59:57,901: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:57,901: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:57,901: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[872ba4ce-6a25-460d-9341-9912cc40f2fc] succeeded in 0.00395682999806013s: None
[2024-10-06 13:59:57,955: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[929eddc2-6299-4f75-b235-4dabc6d79069] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:57,976: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:59:57,978: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:57,978: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:57,982: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[929eddc2-6299-4f75-b235-4dabc6d79069] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:59:58,034: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[33141aaf-2c89-4213-89c6-a6c61f4b9aba] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:58,055: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x194"; args=None; alias=default
[2024-10-06 13:59:58,055: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x194"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT') LIMIT 1; args=(1, 1, 'ARBUSDT'); alias=default
[2024-10-06 13:59:58,056: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT') LIMIT 1; args=(1, 1, 'ARBUSDT'); alias=default
[2024-10-06 13:59:58,056: WARNING/ForkPoolWorker-15] No trades found for asset ARBUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x194"; args=None; alias=default
[2024-10-06 13:59:58,056: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x194"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ARBUSDT', 'Buy'); alias=default
[2024-10-06 13:59:58,057: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ARBUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ARBUSDT', 'Sell'); alias=default
[2024-10-06 13:59:58,058: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ARBUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:58,058: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:58,058: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[33141aaf-2c89-4213-89c6-a6c61f4b9aba] succeeded in 0.0039743789966451s: None
[2024-10-06 13:59:58,112: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[2cdc2366-eb8c-472b-859a-d646c8cfee9f] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:58,132: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:59:58,134: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:58,134: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:58,138: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[2cdc2366-eb8c-472b-859a-d646c8cfee9f] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:59:58,191: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[47a04691-0b4b-4a42-beee-a5b0c02724ad] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:58,211: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x195"; args=None; alias=default
[2024-10-06 13:59:58,211: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x195"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT') LIMIT 1; args=(1, 1, 'RUNEUSDT'); alias=default
[2024-10-06 13:59:58,213: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT') LIMIT 1; args=(1, 1, 'RUNEUSDT'); alias=default
[2024-10-06 13:59:58,213: WARNING/ForkPoolWorker-15] No trades found for asset RUNEUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x195"; args=None; alias=default
[2024-10-06 13:59:58,213: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x195"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Buy'); alias=default
[2024-10-06 13:59:58,214: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Sell'); alias=default
[2024-10-06 13:59:58,214: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:58,214: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:58,214: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[47a04691-0b4b-4a42-beee-a5b0c02724ad] succeeded in 0.003740150001249276s: None
[2024-10-06 13:59:58,268: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[037e960a-7b25-4b18-8c53-d291da3d082b] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:58,289: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:59:58,290: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:58,290: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:58,294: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[037e960a-7b25-4b18-8c53-d291da3d082b] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:59:58,346: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[8bc9f494-770a-48f9-b08b-e99fc530a6c2] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:58,367: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x196"; args=None; alias=default
[2024-10-06 13:59:58,367: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x196"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT') LIMIT 1; args=(1, 1, 'ETHUSDT'); alias=default
[2024-10-06 13:59:58,369: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT') LIMIT 1; args=(1, 1, 'ETHUSDT'); alias=default
[2024-10-06 13:59:58,369: WARNING/ForkPoolWorker-15] No trades found for asset ETHUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x196"; args=None; alias=default
[2024-10-06 13:59:58,369: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x196"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Buy'); alias=default
[2024-10-06 13:59:58,370: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Sell'); alias=default
[2024-10-06 13:59:58,371: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:58,371: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:58,371: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[8bc9f494-770a-48f9-b08b-e99fc530a6c2] succeeded in 0.004312979996029753s: None
[2024-10-06 13:59:58,425: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[a216a254-df91-4c7e-902a-7097d762871f] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:58,446: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:59:58,447: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:58,448: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:58,453: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[a216a254-df91-4c7e-902a-7097d762871f] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:59:58,504: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[73536d44-fad6-4fd6-8ddd-2f9060536a57] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:58,524: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x197"; args=None; alias=default
[2024-10-06 13:59:58,525: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x197"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:59:58,526: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:59:58,526: WARNING/ForkPoolWorker-15] No trades found for asset BTCUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x197"; args=None; alias=default
[2024-10-06 13:59:58,526: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x197"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
[2024-10-06 13:59:58,527: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
[2024-10-06 13:59:58,529: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:58,529: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:58,529: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[73536d44-fad6-4fd6-8ddd-2f9060536a57] succeeded in 0.005408949000411667s: None
[2024-10-06 13:59:58,582: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[7713b1c5-02a9-4870-ac29-b20d594d00cd] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:58,602: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:59:58,604: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:58,604: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:58,608: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[7713b1c5-02a9-4870-ac29-b20d594d00cd] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:59:58,660: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[2dcf22a6-5cde-4692-a090-33613af15927] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:58,681: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x198"; args=None; alias=default
[2024-10-06 13:59:58,681: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x198"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 13:59:58,682: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 13:59:58,682: WARNING/ForkPoolWorker-15] No trades found for asset LDOUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x198"; args=None; alias=default
[2024-10-06 13:59:58,682: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x198"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
[2024-10-06 13:59:58,683: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
[2024-10-06 13:59:58,684: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:58,684: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:58,684: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[2dcf22a6-5cde-4692-a090-33613af15927] succeeded in 0.0037769600021420047s: None
[2024-10-06 13:59:58,738: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[b8a700af-e5f0-4bf8-96f9-520349ea5de4] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:58,759: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:59:58,761: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:58,761: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:58,765: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[b8a700af-e5f0-4bf8-96f9-520349ea5de4] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:59:58,817: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[6abd3c48-9634-4647-a755-4da046abd376] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:58,838: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x199"; args=None; alias=default
[2024-10-06 13:59:58,838: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x199"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT') LIMIT 1; args=(1, 1, 'BLURUSDT'); alias=default
[2024-10-06 13:59:58,839: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT') LIMIT 1; args=(1, 1, 'BLURUSDT'); alias=default
[2024-10-06 13:59:58,839: WARNING/ForkPoolWorker-15] No trades found for asset BLURUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x199"; args=None; alias=default
[2024-10-06 13:59:58,839: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x199"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Buy'); alias=default
[2024-10-06 13:59:58,840: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Sell'); alias=default
[2024-10-06 13:59:58,841: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:58,841: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:58,841: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[6abd3c48-9634-4647-a755-4da046abd376] succeeded in 0.003872479996061884s: None
[2024-10-06 13:59:58,895: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[ddf017fe-cdec-41ae-81f5-21b35244b7c8] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:58,915: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:59:58,917: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:58,917: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:58,921: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[ddf017fe-cdec-41ae-81f5-21b35244b7c8] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:59:58,973: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[06146455-66dd-4c0f-a965-a6e51365cce1] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:58,993: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x200"; args=None; alias=default
[2024-10-06 13:59:58,993: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x200"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT') LIMIT 1; args=(1, 1, 'ETHUSDT'); alias=default
[2024-10-06 13:59:58,995: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT') LIMIT 1; args=(1, 1, 'ETHUSDT'); alias=default
[2024-10-06 13:59:58,995: WARNING/ForkPoolWorker-15] No trades found for asset ETHUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x200"; args=None; alias=default
[2024-10-06 13:59:58,995: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x200"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Buy'); alias=default
[2024-10-06 13:59:58,996: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Sell'); alias=default
[2024-10-06 13:59:58,996: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:58,997: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:58,997: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[06146455-66dd-4c0f-a965-a6e51365cce1] succeeded in 0.004015760001493618s: None
[2024-10-06 13:59:59,051: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[cdd21083-1034-4a4c-8529-50c2201e37db] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:59,071: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:59:59,073: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:59,073: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:59,078: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[cdd21083-1034-4a4c-8529-50c2201e37db] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:59:59,130: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[b8db443d-deef-412e-b482-77f7249f1c11] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:59,151: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x201"; args=None; alias=default
[2024-10-06 13:59:59,151: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x201"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:59:59,152: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:59:59,152: WARNING/ForkPoolWorker-15] No trades found for asset BTCUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x201"; args=None; alias=default
[2024-10-06 13:59:59,153: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x201"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
[2024-10-06 13:59:59,154: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
[2024-10-06 13:59:59,154: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:59,154: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:59,155: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[b8db443d-deef-412e-b482-77f7249f1c11] succeeded in 0.004231099002936389s: None
[2024-10-06 13:59:59,208: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[6011a79b-ef86-4a22-b25e-d091ffe5cf4e] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:59,228: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:59:59,229: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:59,230: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:59,233: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[6011a79b-ef86-4a22-b25e-d091ffe5cf4e] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:59:59,286: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[1c804ceb-eb76-4b94-99e0-068d7ed621cd] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:59,306: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x202"; args=None; alias=default
[2024-10-06 13:59:59,306: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x202"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT') LIMIT 1; args=(1, 1, 'ETHUSDT'); alias=default
[2024-10-06 13:59:59,307: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT') LIMIT 1; args=(1, 1, 'ETHUSDT'); alias=default
[2024-10-06 13:59:59,307: WARNING/ForkPoolWorker-15] No trades found for asset ETHUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x202"; args=None; alias=default
[2024-10-06 13:59:59,307: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x202"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Buy'); alias=default
[2024-10-06 13:59:59,308: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Sell'); alias=default
[2024-10-06 13:59:59,309: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:59,309: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:59,309: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[1c804ceb-eb76-4b94-99e0-068d7ed621cd] succeeded in 0.0036579190054908395s: None
[2024-10-06 13:59:59,363: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[2d49e913-222e-4700-9fc0-4feebc391c2e] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:59,384: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:59:59,386: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:59,386: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:59,390: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[2d49e913-222e-4700-9fc0-4feebc391c2e] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:59:59,442: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[fb338481-625e-4010-ae98-eef2ccd30884] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:59,464: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x203"; args=None; alias=default
[2024-10-06 13:59:59,464: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x203"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:59:59,466: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:59:59,466: WARNING/ForkPoolWorker-15] No trades found for asset BTCUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x203"; args=None; alias=default
[2024-10-06 13:59:59,466: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x203"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
[2024-10-06 13:59:59,467: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
[2024-10-06 13:59:59,467: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:59,468: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:59,468: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[fb338481-625e-4010-ae98-eef2ccd30884] succeeded in 0.0045818889993825s: None
[2024-10-06 13:59:59,522: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[b2c4c350-ecda-4972-96b1-008e178ce151] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:59,542: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:59:59,544: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:59,544: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:59,548: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[b2c4c350-ecda-4972-96b1-008e178ce151] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:59:59,600: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[1d28e24a-0cd7-4c30-92d3-f922c3be82d0] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:59,621: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x204"; args=None; alias=default
[2024-10-06 13:59:59,621: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x204"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:59:59,622: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 13:59:59,623: WARNING/ForkPoolWorker-15] No trades found for asset BTCUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x204"; args=None; alias=default
[2024-10-06 13:59:59,623: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x204"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
[2024-10-06 13:59:59,623: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
[2024-10-06 13:59:59,624: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:59,624: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:59,624: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[1d28e24a-0cd7-4c30-92d3-f922c3be82d0] succeeded in 0.0039651789993513376s: None
[2024-10-06 13:59:59,678: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[03cbf115-1967-4470-9961-6ed48a2ee4ca] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:59,699: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:59:59,700: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:59,701: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:59,705: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[03cbf115-1967-4470-9961-6ed48a2ee4ca] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:59:59,757: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[e6a6099a-7a61-4068-8726-4f84b75bc56c] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:59,777: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x205"; args=None; alias=default
[2024-10-06 13:59:59,778: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x205"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT') LIMIT 1; args=(1, 1, 'BLURUSDT'); alias=default
[2024-10-06 13:59:59,779: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT') LIMIT 1; args=(1, 1, 'BLURUSDT'); alias=default
[2024-10-06 13:59:59,779: WARNING/ForkPoolWorker-15] No trades found for asset BLURUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x205"; args=None; alias=default
[2024-10-06 13:59:59,779: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x205"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Buy'); alias=default
[2024-10-06 13:59:59,780: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Sell'); alias=default
[2024-10-06 13:59:59,780: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:59,780: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:59,781: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[e6a6099a-7a61-4068-8726-4f84b75bc56c] succeeded in 0.003671639999083709s: None
[2024-10-06 13:59:59,835: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[2b0ad2fd-be4e-42ca-b1c8-c5d5efa401b3] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:59,855: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 13:59:59,857: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:59,857: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:59,861: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[2b0ad2fd-be4e-42ca-b1c8-c5d5efa401b3] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 13:59:59,913: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[b698b14e-db03-49ac-b7b2-4666182982b9] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 13:59:59,953: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x206"; args=None; alias=default
[2024-10-06 13:59:59,953: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x206"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT') LIMIT 1; args=(1, 1, 'BLURUSDT'); alias=default
[2024-10-06 13:59:59,955: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT') LIMIT 1; args=(1, 1, 'BLURUSDT'); alias=default
[2024-10-06 13:59:59,955: WARNING/ForkPoolWorker-15] No trades found for asset BLURUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x206"; args=None; alias=default
[2024-10-06 13:59:59,955: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x206"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Buy'); alias=default
[2024-10-06 13:59:59,956: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Sell'); alias=default
[2024-10-06 13:59:59,956: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:59,956: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 13:59:59,957: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[b698b14e-db03-49ac-b7b2-4666182982b9] succeeded in 0.003690860001370311s: None
[2024-10-06 14:00:00,012: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[7396ffb8-93fb-4d4c-9ea0-bc475520c99d] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 14:00:00,034: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 14:00:00,037: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:00,037: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:00,044: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[7396ffb8-93fb-4d4c-9ea0-bc475520c99d] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 14:00:00,093: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[009d3221-6be4-41cd-a52c-5c9113b6fed6] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 14:00:00,115: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x207"; args=None; alias=default
[2024-10-06 14:00:00,115: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x207"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 14:00:00,117: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 14:00:00,117: WARNING/ForkPoolWorker-15] No trades found for asset BTCUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x207"; args=None; alias=default
[2024-10-06 14:00:00,117: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x207"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
[2024-10-06 14:00:00,118: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
[2024-10-06 14:00:00,119: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:00,119: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:00,119: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[009d3221-6be4-41cd-a52c-5c9113b6fed6] succeeded in 0.005307239000103436s: None
[2024-10-06 14:00:00,174: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[c3d1fb45-51d3-412f-b822-28776191ec7e] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 14:00:00,196: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 14:00:00,198: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:00,198: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:00,205: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[c3d1fb45-51d3-412f-b822-28776191ec7e] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 14:00:00,255: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[d0b15d5e-7bc7-4dce-abc8-bfdccbcadf8c] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 14:00:00,276: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x208"; args=None; alias=default
[2024-10-06 14:00:00,277: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x208"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 14:00:00,279: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 14:00:00,279: WARNING/ForkPoolWorker-15] No trades found for asset BTCUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x208"; args=None; alias=default
[2024-10-06 14:00:00,279: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x208"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
[2024-10-06 14:00:00,280: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
[2024-10-06 14:00:00,281: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:00,281: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:00,281: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[d0b15d5e-7bc7-4dce-abc8-bfdccbcadf8c] succeeded in 0.005950279002718162s: None
[2024-10-06 14:00:00,335: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[3535fdd4-1ae8-43d8-a0dd-210b150f29e4] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 14:00:00,356: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 14:00:00,358: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:00,358: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:00,365: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[3535fdd4-1ae8-43d8-a0dd-210b150f29e4] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 14:00:00,415: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[56fde0e4-32bc-4309-85ff-3617cb855508] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 14:00:00,437: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x209"; args=None; alias=default
[2024-10-06 14:00:00,438: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x209"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 14:00:00,439: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 14:00:00,439: WARNING/ForkPoolWorker-15] No trades found for asset BTCUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x209"; args=None; alias=default
[2024-10-06 14:00:00,439: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x209"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
[2024-10-06 14:00:00,441: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
[2024-10-06 14:00:00,441: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:00,442: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:00,442: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[56fde0e4-32bc-4309-85ff-3617cb855508] succeeded in 0.005260019999695942s: None
[2024-10-06 14:00:00,495: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[e304e206-39e0-4012-8f2b-4359010b9282] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 14:00:00,516: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 14:00:00,518: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:00,519: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:00,522: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[e304e206-39e0-4012-8f2b-4359010b9282] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 14:00:00,575: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[29d91ed0-e307-450f-9209-173009f5f78d] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 14:00:00,597: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x210"; args=None; alias=default
[2024-10-06 14:00:00,597: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x210"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 14:00:00,598: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 14:00:00,599: WARNING/ForkPoolWorker-15] No trades found for asset BTCUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x210"; args=None; alias=default
[2024-10-06 14:00:00,599: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x210"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
[2024-10-06 14:00:00,600: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
[2024-10-06 14:00:00,601: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:00,601: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:00,601: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[29d91ed0-e307-450f-9209-173009f5f78d] succeeded in 0.004690809000749141s: None
[2024-10-06 14:00:00,655: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[11a14bec-dc78-4a57-8b09-7c6d63f6a502] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 14:00:00,678: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 14:00:00,680: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:00,681: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:00,688: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[11a14bec-dc78-4a57-8b09-7c6d63f6a502] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 14:00:00,737: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[5ba4b7f8-0e1b-4f7f-a54c-f65083c23e4d] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 14:00:00,759: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x211"; args=None; alias=default
[2024-10-06 14:00:00,759: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x211"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 14:00:00,761: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 14:00:00,761: WARNING/ForkPoolWorker-15] No trades found for asset LDOUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x211"; args=None; alias=default
[2024-10-06 14:00:00,761: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x211"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
[2024-10-06 14:00:00,762: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
[2024-10-06 14:00:00,763: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:00,763: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:00,764: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[5ba4b7f8-0e1b-4f7f-a54c-f65083c23e4d] succeeded in 0.005678768997313455s: None
[2024-10-06 14:00:00,818: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[3864e8e1-01eb-4dc9-a735-9bdb114e4927] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 14:00:00,839: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 14:00:00,842: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:00,842: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:00,848: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[3864e8e1-01eb-4dc9-a735-9bdb114e4927] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 14:00:00,898: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[797c0a88-956d-46aa-a717-a19630dbfbd1] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 14:00:00,919: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x212"; args=None; alias=default
[2024-10-06 14:00:00,920: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x212"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT') LIMIT 1; args=(1, 1, 'BLURUSDT'); alias=default
[2024-10-06 14:00:00,921: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT') LIMIT 1; args=(1, 1, 'BLURUSDT'); alias=default
[2024-10-06 14:00:00,921: WARNING/ForkPoolWorker-15] No trades found for asset BLURUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x212"; args=None; alias=default
[2024-10-06 14:00:00,922: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x212"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Buy'); alias=default
[2024-10-06 14:00:00,923: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Sell'); alias=default
[2024-10-06 14:00:00,923: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:00,924: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:00,924: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[797c0a88-956d-46aa-a717-a19630dbfbd1] succeeded in 0.005256910000753123s: None
[2024-10-06 14:00:00,977: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[95770005-0270-4ff5-92fc-cfb80e6c0aaf] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 14:00:00,999: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 14:00:01,001: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:01,001: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:01,008: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[95770005-0270-4ff5-92fc-cfb80e6c0aaf] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 14:00:01,058: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[84a742ff-0d05-4783-9fa6-122ddfaaffe5] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 14:00:01,078: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x213"; args=None; alias=default
[2024-10-06 14:00:01,079: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x213"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT') LIMIT 1; args=(1, 1, 'ARBUSDT'); alias=default
[2024-10-06 14:00:01,080: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT') LIMIT 1; args=(1, 1, 'ARBUSDT'); alias=default
[2024-10-06 14:00:01,080: WARNING/ForkPoolWorker-15] No trades found for asset ARBUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x213"; args=None; alias=default
[2024-10-06 14:00:01,080: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x213"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ARBUSDT', 'Buy'); alias=default
[2024-10-06 14:00:01,081: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ARBUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ARBUSDT', 'Sell'); alias=default
[2024-10-06 14:00:01,082: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ARBUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:01,082: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:01,083: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[84a742ff-0d05-4783-9fa6-122ddfaaffe5] succeeded in 0.004786809993674979s: None
[2024-10-06 14:00:01,137: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[5e74973e-c3b3-412c-8e39-012c563d7b40] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 14:00:01,158: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 14:00:01,160: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:01,160: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:01,167: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[5e74973e-c3b3-412c-8e39-012c563d7b40] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 14:00:01,217: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[01167c68-dd2c-4180-ba2f-bea5ac94d317] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 14:00:01,243: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x214"; args=None; alias=default
[2024-10-06 14:00:01,243: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x214"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT') LIMIT 1; args=(1, 1, 'ETHUSDT'); alias=default
[2024-10-06 14:00:01,245: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT') LIMIT 1; args=(1, 1, 'ETHUSDT'); alias=default
[2024-10-06 14:00:01,245: WARNING/ForkPoolWorker-15] No trades found for asset ETHUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x214"; args=None; alias=default
[2024-10-06 14:00:01,245: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x214"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Buy'); alias=default
[2024-10-06 14:00:01,246: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Sell'); alias=default
[2024-10-06 14:00:01,247: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:01,247: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:01,248: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[01167c68-dd2c-4180-ba2f-bea5ac94d317] succeeded in 0.005005550003261305s: None
[2024-10-06 14:00:01,305: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[3a92dcf1-cffc-49d9-81ac-4a80cad94c7e] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 14:00:01,329: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 14:00:01,331: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:01,331: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:01,341: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[3a92dcf1-cffc-49d9-81ac-4a80cad94c7e] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 14:00:01,388: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[997ccf92-204b-4aa9-b885-df6f7b9fe156] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 14:00:01,409: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x215"; args=None; alias=default
[2024-10-06 14:00:01,410: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x215"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT') LIMIT 1; args=(1, 1, 'ETHUSDT'); alias=default
[2024-10-06 14:00:01,411: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT') LIMIT 1; args=(1, 1, 'ETHUSDT'); alias=default
[2024-10-06 14:00:01,411: WARNING/ForkPoolWorker-15] No trades found for asset ETHUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x215"; args=None; alias=default
[2024-10-06 14:00:01,412: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x215"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Buy'); alias=default
[2024-10-06 14:00:01,413: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Sell'); alias=default
[2024-10-06 14:00:01,413: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ETHUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ETHUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:01,414: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:01,414: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[997ccf92-204b-4aa9-b885-df6f7b9fe156] succeeded in 0.004941959006828256s: None
[2024-10-06 14:00:01,470: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[d41be910-5338-4397-bf91-0862d4b69187] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 14:00:01,492: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 14:00:01,494: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:01,495: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:01,501: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[d41be910-5338-4397-bf91-0862d4b69187] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 14:00:01,553: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[30520bbf-c6cb-4a38-8a79-6dd929885b1a] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 14:00:01,574: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x216"; args=None; alias=default
[2024-10-06 14:00:01,574: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x216"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 14:00:01,576: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 14:00:01,576: WARNING/ForkPoolWorker-15] No trades found for asset BTCUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x216"; args=None; alias=default
[2024-10-06 14:00:01,576: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x216"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
[2024-10-06 14:00:01,577: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
[2024-10-06 14:00:01,578: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:01,578: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:01,578: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[30520bbf-c6cb-4a38-8a79-6dd929885b1a] succeeded in 0.004968760003976058s: None
[2024-10-06 14:00:01,633: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[b6745c97-2b9b-46dc-bdc3-3c077710cfdd] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 14:00:01,654: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 14:00:01,656: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:01,657: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:01,663: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[b6745c97-2b9b-46dc-bdc3-3c077710cfdd] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 14:00:01,713: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[58a22abd-f872-403c-9209-88fcb696dada] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 14:00:01,735: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x217"; args=None; alias=default
[2024-10-06 14:00:01,735: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x217"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 14:00:01,737: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 14:00:01,737: WARNING/ForkPoolWorker-15] No trades found for asset BTCUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x217"; args=None; alias=default
[2024-10-06 14:00:01,737: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x217"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
[2024-10-06 14:00:01,738: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
[2024-10-06 14:00:01,739: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:01,739: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:01,739: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[58a22abd-f872-403c-9209-88fcb696dada] succeeded in 0.004984598999726586s: None
[2024-10-06 14:00:01,794: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[47375051-85a2-4fb8-bc91-9356aac9d70d] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 14:00:01,816: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 14:00:01,819: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:01,819: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:01,825: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[47375051-85a2-4fb8-bc91-9356aac9d70d] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 14:00:01,876: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[1850bbed-5c1c-49b8-8850-64a88f8894a0] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 14:00:01,897: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x218"; args=None; alias=default
[2024-10-06 14:00:01,897: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x218"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT') LIMIT 1; args=(1, 1, 'RUNEUSDT'); alias=default
[2024-10-06 14:00:01,899: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT') LIMIT 1; args=(1, 1, 'RUNEUSDT'); alias=default
[2024-10-06 14:00:01,899: WARNING/ForkPoolWorker-15] No trades found for asset RUNEUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x218"; args=None; alias=default
[2024-10-06 14:00:01,899: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x218"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Buy'); alias=default
[2024-10-06 14:00:01,900: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Sell'); alias=default
[2024-10-06 14:00:01,901: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:01,901: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:01,901: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[1850bbed-5c1c-49b8-8850-64a88f8894a0] succeeded in 0.005108598998049274s: None
[2024-10-06 14:00:01,955: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[7f5f3b98-b7bc-4213-97cf-2467fbb4e073] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 14:00:01,997: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 14:00:01,999: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:01,999: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:02,006: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[7f5f3b98-b7bc-4213-97cf-2467fbb4e073] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 14:00:02,056: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[56e0c6cc-8801-4684-8777-9b6687e9f596] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 14:00:02,078: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x219"; args=None; alias=default
[2024-10-06 14:00:02,078: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x219"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SOLUSDT') LIMIT 1; args=(1, 1, 'SOLUSDT'); alias=default
[2024-10-06 14:00:02,080: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SOLUSDT') LIMIT 1; args=(1, 1, 'SOLUSDT'); alias=default
[2024-10-06 14:00:02,080: WARNING/ForkPoolWorker-15] No trades found for asset SOLUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x219"; args=None; alias=default
[2024-10-06 14:00:02,080: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x219"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SOLUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'SOLUSDT', 'Buy'); alias=default
[2024-10-06 14:00:02,081: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SOLUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'SOLUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SOLUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'SOLUSDT', 'Sell'); alias=default
[2024-10-06 14:00:02,082: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SOLUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'SOLUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:02,082: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:02,082: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[56e0c6cc-8801-4684-8777-9b6687e9f596] succeeded in 0.004911448995699175s: None
[2024-10-06 14:00:02,137: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[bf8dd3e7-37ac-4888-bc13-eb2619115237] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 14:00:02,159: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 14:00:02,162: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:02,162: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:02,168: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[bf8dd3e7-37ac-4888-bc13-eb2619115237] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 14:00:02,219: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[e7e58325-25a8-4ff1-b320-cbe17d3714ec] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 14:00:02,240: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x220"; args=None; alias=default
[2024-10-06 14:00:02,240: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x220"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT') LIMIT 1; args=(1, 1, 'RUNEUSDT'); alias=default
[2024-10-06 14:00:02,242: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT') LIMIT 1; args=(1, 1, 'RUNEUSDT'); alias=default
[2024-10-06 14:00:02,242: WARNING/ForkPoolWorker-15] No trades found for asset RUNEUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x220"; args=None; alias=default
[2024-10-06 14:00:02,242: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x220"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Buy'); alias=default
[2024-10-06 14:00:02,243: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Sell'); alias=default
[2024-10-06 14:00:02,244: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:02,244: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:02,244: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[e7e58325-25a8-4ff1-b320-cbe17d3714ec] succeeded in 0.004970428999513388s: None
[2024-10-06 14:00:02,298: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[15fb3651-62ff-4293-9378-b852e833c861] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 14:00:02,320: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 14:00:02,322: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:02,322: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:02,329: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[15fb3651-62ff-4293-9378-b852e833c861] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 14:00:02,386: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[6492e86a-2f33-4dc6-9b05-afe1d38d07da] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 14:00:02,411: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x221"; args=None; alias=default
[2024-10-06 14:00:02,411: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x221"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 14:00:02,413: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 14:00:02,413: WARNING/ForkPoolWorker-15] No trades found for asset BTCUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x221"; args=None; alias=default
[2024-10-06 14:00:02,413: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x221"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
[2024-10-06 14:00:02,414: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
[2024-10-06 14:00:02,415: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:02,415: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:02,415: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[6492e86a-2f33-4dc6-9b05-afe1d38d07da] succeeded in 0.004929588998493273s: None
[2024-10-06 14:00:02,471: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[b6283725-90d4-4f4a-8579-5f7b886f1052] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 14:00:02,492: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 14:00:02,494: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:02,495: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:02,501: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[b6283725-90d4-4f4a-8579-5f7b886f1052] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 14:00:02,564: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[833889d4-62a6-438d-95c2-e10cc4586137] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 14:00:02,586: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x222"; args=None; alias=default
[2024-10-06 14:00:02,587: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x222"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 14:00:02,588: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT') LIMIT 1; args=(1, 1, 'BTCUSDT'); alias=default
[2024-10-06 14:00:02,589: WARNING/ForkPoolWorker-15] No trades found for asset BTCUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x222"; args=None; alias=default
[2024-10-06 14:00:02,589: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x222"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
[2024-10-06 14:00:02,590: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
[2024-10-06 14:00:02,591: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BTCUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BTCUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:02,591: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:02,591: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[833889d4-62a6-438d-95c2-e10cc4586137] succeeded in 0.005489049006428104s: None
[2024-10-06 14:00:02,645: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[2b234d81-9e0a-4b18-92b9-0ea9129bad55] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 14:00:02,666: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x223"; args=None; alias=default
[2024-10-06 14:00:02,667: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x223"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT') LIMIT 1; args=(1, 1, 'ARBUSDT'); alias=default
[2024-10-06 14:00:02,668: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT') LIMIT 1; args=(1, 1, 'ARBUSDT'); alias=default
[2024-10-06 14:00:02,669: WARNING/ForkPoolWorker-15] No trades found for asset ARBUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x223"; args=None; alias=default
[2024-10-06 14:00:02,669: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x223"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ARBUSDT', 'Buy'); alias=default
[2024-10-06 14:00:02,670: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ARBUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ARBUSDT', 'Sell'); alias=default
[2024-10-06 14:00:02,671: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'ARBUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'ARBUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:02,671: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:02,671: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[2b234d81-9e0a-4b18-92b9-0ea9129bad55] succeeded in 0.005307879000611138s: None
[2024-10-06 14:00:02,730: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[db507bad-903f-4061-947d-9a88768a1a11] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 14:00:02,751: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 14:00:02,753: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:02,754: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:02,761: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[db507bad-903f-4061-947d-9a88768a1a11] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 14:00:02,817: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[515a04ee-317e-45c5-ab66-8d6943b20a35] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 14:00:02,840: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x224"; args=None; alias=default
[2024-10-06 14:00:02,841: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x224"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT') LIMIT 1; args=(1, 1, 'BLURUSDT'); alias=default
[2024-10-06 14:00:02,842: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT') LIMIT 1; args=(1, 1, 'BLURUSDT'); alias=default
[2024-10-06 14:00:02,843: WARNING/ForkPoolWorker-15] No trades found for asset BLURUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x224"; args=None; alias=default
[2024-10-06 14:00:02,843: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x224"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Buy'); alias=default
[2024-10-06 14:00:02,844: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Sell'); alias=default
[2024-10-06 14:00:02,845: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:02,845: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:02,845: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[515a04ee-317e-45c5-ab66-8d6943b20a35] succeeded in 0.005807980000099633s: None
[2024-10-06 14:00:02,899: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[464c6e03-5e58-4272-a295-5bd48eb0a734] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 14:00:02,920: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 14:00:02,922: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:02,922: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:02,926: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[464c6e03-5e58-4272-a295-5bd48eb0a734] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 14:00:02,979: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[fbba544a-f0a4-4d43-ab6b-61c80bd56b33] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 14:00:03,000: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x225"; args=None; alias=default
[2024-10-06 14:00:03,001: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x225"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT') LIMIT 1; args=(1, 1, 'BLURUSDT'); alias=default
[2024-10-06 14:00:03,002: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT') LIMIT 1; args=(1, 1, 'BLURUSDT'); alias=default
[2024-10-06 14:00:03,002: WARNING/ForkPoolWorker-15] No trades found for asset BLURUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x225"; args=None; alias=default
[2024-10-06 14:00:03,003: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x225"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Buy'); alias=default
[2024-10-06 14:00:03,004: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Sell'); alias=default
[2024-10-06 14:00:03,005: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:03,005: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:03,005: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[fbba544a-f0a4-4d43-ab6b-61c80bd56b33] succeeded in 0.005695168998499867s: None
[2024-10-06 14:00:03,061: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[23539c34-dda4-444f-bbac-d3a65f89b150] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 14:00:03,082: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 14:00:03,084: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:03,085: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:03,092: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[23539c34-dda4-444f-bbac-d3a65f89b150] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 14:00:03,141: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[0be41d42-b7f4-45a6-8cd3-70aeee7e782c] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 14:00:03,162: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x226"; args=None; alias=default
[2024-10-06 14:00:03,162: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x226"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SOLUSDT') LIMIT 1; args=(1, 1, 'SOLUSDT'); alias=default
[2024-10-06 14:00:03,164: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SOLUSDT') LIMIT 1; args=(1, 1, 'SOLUSDT'); alias=default
[2024-10-06 14:00:03,164: WARNING/ForkPoolWorker-15] No trades found for asset SOLUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x226"; args=None; alias=default
[2024-10-06 14:00:03,164: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x226"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SOLUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'SOLUSDT', 'Buy'); alias=default
[2024-10-06 14:00:03,166: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SOLUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'SOLUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SOLUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'SOLUSDT', 'Sell'); alias=default
[2024-10-06 14:00:03,166: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'SOLUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'SOLUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:03,167: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:03,167: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[0be41d42-b7f4-45a6-8cd3-70aeee7e782c] succeeded in 0.0055257799976971s: None
[2024-10-06 14:00:03,219: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[8b86e9b3-cc38-4ac8-a73a-9015637a3f3e] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 14:00:03,242: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 14:00:03,245: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:03,245: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:03,251: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[8b86e9b3-cc38-4ac8-a73a-9015637a3f3e] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 14:00:03,301: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[6b4d066b-d4a0-4054-8acd-784d84042c16] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 14:00:03,324: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x227"; args=None; alias=default
[2024-10-06 14:00:03,325: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x227"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT') LIMIT 1; args=(1, 1, 'BLURUSDT'); alias=default
[2024-10-06 14:00:03,326: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT') LIMIT 1; args=(1, 1, 'BLURUSDT'); alias=default
[2024-10-06 14:00:03,326: WARNING/ForkPoolWorker-15] No trades found for asset BLURUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x227"; args=None; alias=default
[2024-10-06 14:00:03,326: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x227"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Buy'); alias=default
[2024-10-06 14:00:03,327: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Sell'); alias=default
[2024-10-06 14:00:03,328: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'BLURUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'BLURUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:03,328: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:03,328: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[6b4d066b-d4a0-4054-8acd-784d84042c16] succeeded in 0.004831999001908116s: None
[2024-10-06 14:00:03,383: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[0d9c7f69-f068-4c1d-b8b1-825718485b47] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 14:00:03,404: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 14:00:03,406: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:03,406: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:03,410: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[0d9c7f69-f068-4c1d-b8b1-825718485b47] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 14:00:03,462: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[976a297d-5e52-47e9-b248-7a5326e71e16] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 14:00:03,483: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x228"; args=None; alias=default
[2024-10-06 14:00:03,483: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x228"; args=None; alias=default
(0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT') LIMIT 1; args=(1, 1, 'RUNEUSDT'); alias=default
[2024-10-06 14:00:03,484: DEBUG/ForkPoolWorker-15] (0.001) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT') LIMIT 1; args=(1, 1, 'RUNEUSDT'); alias=default
[2024-10-06 14:00:03,484: WARNING/ForkPoolWorker-15] No trades found for asset RUNEUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x228"; args=None; alias=default
[2024-10-06 14:00:03,485: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x228"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Buy'); alias=default
[2024-10-06 14:00:03,485: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Sell'); alias=default
[2024-10-06 14:00:03,486: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:03,486: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:03,486: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[976a297d-5e52-47e9-b248-7a5326e71e16] succeeded in 0.0038572400007979013s: None
[2024-10-06 14:00:03,544: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[2c9d8bfd-1053-4be6-b6a1-d863941fc9ac] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 14:00:03,565: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 14:00:03,567: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:03,567: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:03,571: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[2c9d8bfd-1053-4be6-b6a1-d863941fc9ac] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 14:00:03,623: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[f8693f19-ba43-4014-8310-225a84129cb6] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 14:00:03,644: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x229"; args=None; alias=default
[2024-10-06 14:00:03,644: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x229"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 14:00:03,646: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 14:00:03,646: WARNING/ForkPoolWorker-15] No trades found for asset LDOUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x229"; args=None; alias=default
[2024-10-06 14:00:03,646: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x229"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
[2024-10-06 14:00:03,647: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
[2024-10-06 14:00:03,647: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:03,647: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:03,648: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[f8693f19-ba43-4014-8310-225a84129cb6] succeeded in 0.004072070005349815s: None
[2024-10-06 14:00:03,701: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[14a6f0b5-bf00-4c39-9433-581ea3d6dfc6] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 14:00:03,722: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 14:00:03,723: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:03,723: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:03,727: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[14a6f0b5-bf00-4c39-9433-581ea3d6dfc6] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 14:00:03,779: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[788ae8bc-2694-4af2-b464-d264e46175a9] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 14:00:03,800: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x230"; args=None; alias=default
[2024-10-06 14:00:03,800: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x230"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 14:00:03,801: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 14:00:03,801: WARNING/ForkPoolWorker-15] No trades found for asset LDOUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x230"; args=None; alias=default
[2024-10-06 14:00:03,801: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x230"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
[2024-10-06 14:00:03,802: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
[2024-10-06 14:00:03,803: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:03,803: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:03,803: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[788ae8bc-2694-4af2-b464-d264e46175a9] succeeded in 0.003451019001659006s: None
[2024-10-06 14:00:03,857: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[978ad37e-49fb-4689-ab3f-b8ce44875b77] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 14:00:03,878: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x231"; args=None; alias=default
[2024-10-06 14:00:03,878: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x231"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 14:00:03,879: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 14:00:03,879: WARNING/ForkPoolWorker-15] No trades found for asset LDOUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x231"; args=None; alias=default
[2024-10-06 14:00:03,879: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x231"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
[2024-10-06 14:00:03,880: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
[2024-10-06 14:00:03,881: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:03,881: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:03,881: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[978ad37e-49fb-4689-ab3f-b8ce44875b77] succeeded in 0.0041156389997922815s: None
[2024-10-06 14:00:03,935: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[c830b954-9302-4d26-9a7c-17135483ab56] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 14:00:03,956: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 14:00:03,957: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:03,958: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:03,961: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[c830b954-9302-4d26-9a7c-17135483ab56] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 14:00:04,014: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[1a922a71-40c1-4be5-914d-620ebec456fc] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 14:00:04,054: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x232"; args=None; alias=default
[2024-10-06 14:00:04,054: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x232"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 14:00:04,055: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT') LIMIT 1; args=(1, 1, 'LDOUSDT'); alias=default
[2024-10-06 14:00:04,055: WARNING/ForkPoolWorker-15] No trades found for asset LDOUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x232"; args=None; alias=default
[2024-10-06 14:00:04,055: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x232"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
[2024-10-06 14:00:04,056: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
[2024-10-06 14:00:04,057: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'LDOUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'LDOUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:04,057: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:04,057: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[1a922a71-40c1-4be5-914d-620ebec456fc] succeeded in 0.004011288998299278s: None
[2024-10-06 14:00:04,111: INFO/MainProcess] Task upload_csv.tasks.process_trade_ids_in_background[b3079b80-3bf5-49e2-abc9-78e7e16f8214] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 14:00:04,132: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
[2024-10-06 14:00:04,134: DEBUG/ForkPoolWorker-15] (0.001) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."owner_id", "upload_csv_tradeuploadblofin"."file_name", "upload_csv_tradeuploadblofin"."underlying_asset", "upload_csv_tradeuploadblofin"."margin_mode", "upload_csv_tradeuploadblofin"."leverage", "upload_csv_tradeuploadblofin"."order_time", "upload_csv_tradeuploadblofin"."side", "upload_csv_tradeuploadblofin"."avg_fill", "upload_csv_tradeuploadblofin"."price", "upload_csv_tradeuploadblofin"."filled_quantity", "upload_csv_tradeuploadblofin"."original_filled_quantity", "upload_csv_tradeuploadblofin"."pnl", "upload_csv_tradeuploadblofin"."pnl_percentage", "upload_csv_tradeuploadblofin"."fee", "upload_csv_tradeuploadblofin"."reduce_only", "upload_csv_tradeuploadblofin"."trade_status", "upload_csv_tradeuploadblofin"."exchange", "upload_csv_tradeuploadblofin"."is_open", "upload_csv_tradeuploadblofin"."is_matched", "upload_csv_tradeuploadblofin"."is_partially_matched", "upload_csv_tradeuploadblofin"."last_updated" FROM "upload_csv_tradeuploadblofin" WHERE "upload_csv_tradeuploadblofin"."owner_id" = 1 ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1,); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:04,134: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:04,138: ERROR/ForkPoolWorker-15] Task upload_csv.tasks.process_trade_ids_in_background[b3079b80-3bf5-49e2-abc9-78e7e16f8214] raised unexpected: NameError("name 'connection' is not defined")
Traceback (most recent call last):
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/workspace/.pip-modules/lib/python3.12/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspace/doji-lite-api-v2/upload_csv/tasks.py", line 21, in process_trade_ids_in_background
    connection.close()  # Explicitly close the database connection
    ^^^^^^^^^^
NameError: name 'connection' is not defined
[2024-10-06 14:00:04,190: INFO/MainProcess] Task upload_csv.tasks.process_asset_in_background[74a965cf-2e66-4b97-929c-95251f86b008] received
(0.000) BEGIN; args=None; alias=default
[2024-10-06 14:00:04,211: DEBUG/ForkPoolWorker-15] (0.000) BEGIN; args=None; alias=default
(0.000) SAVEPOINT "s140623122828160_x233"; args=None; alias=default
[2024-10-06 14:00:04,211: DEBUG/ForkPoolWorker-15] (0.000) SAVEPOINT "s140623122828160_x233"; args=None; alias=default
(0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT') LIMIT 1; args=(1, 1, 'RUNEUSDT'); alias=default
[2024-10-06 14:00:04,212: DEBUG/ForkPoolWorker-15] (0.000) SELECT 1 AS "a" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT') LIMIT 1; args=(1, 1, 'RUNEUSDT'); alias=default
[2024-10-06 14:00:04,213: WARNING/ForkPoolWorker-15] No trades found for asset RUNEUSDT. Skipping revert.
(0.000) RELEASE SAVEPOINT "s140623122828160_x233"; args=None; alias=default
[2024-10-06 14:00:04,213: DEBUG/ForkPoolWorker-15] (0.000) RELEASE SAVEPOINT "s140623122828160_x233"; args=None; alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Buy'); alias=default
[2024-10-06 14:00:04,213: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Buy') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Buy'); alias=default
(0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Sell'); alias=default
[2024-10-06 14:00:04,214: DEBUG/ForkPoolWorker-15] (0.000) SELECT "upload_csv_tradeuploadblofin"."id", "upload_csv_tradeuploadblofin"."filled_quantity" FROM "upload_csv_tradeuploadblofin" WHERE ("upload_csv_tradeuploadblofin"."owner_id" = 1 AND "upload_csv_tradeuploadblofin"."underlying_asset" = 'RUNEUSDT' AND "upload_csv_tradeuploadblofin"."side" = 'Sell') ORDER BY "upload_csv_tradeuploadblofin"."order_time" DESC; args=(1, 'RUNEUSDT', 'Sell'); alias=default
(0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:04,214: DEBUG/ForkPoolWorker-15] (0.000) COMMIT; args=None; alias=default
[2024-10-06 14:00:04,214: INFO/ForkPoolWorker-15] Task upload_csv.tasks.process_asset_in_background[74a965cf-2e66-4b97-929c-95251f86b008] succeeded in 0.0038485189943457954s: None
